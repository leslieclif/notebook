<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/learning/ansible/security_testing/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.0.3"><title>Automating Web Application Security Testing Using OWASP ZAP - Leslie's Online Notebook</title><link rel=stylesheet href=../../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#automating-web-application-security-testing-using-owasp-zap class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Automating Web Application Security Testing Using OWASP ZAP </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ansible/ class=md-nav__link> Ansible </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../../docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../linux/linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../linux/security/ class=md-nav__link> Linux_Security </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/ class=md-nav__link> Index </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#automating-web-application-security-testing-using-owasp-zap class=md-nav__link> Automating Web Application Security Testing Using OWASP ZAP </a> <nav class=md-nav aria-label="Automating Web Application Security Testing Using OWASP ZAP"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installing-owasp-zap class=md-nav__link> Installing OWASP ZAP </a> </li> <li class=md-nav__item> <a href=#installing-docker-runtime class=md-nav__link> Installing Docker runtime </a> </li> <li class=md-nav__item> <a href=#owasp-zap-docker-container-setup class=md-nav__link> OWASP ZAP Docker container setup </a> </li> <li class=md-nav__item> <a href=#a-specialized-tool-for-working-with-containers---ansible-container class=md-nav__link> A specialized tool for working with Containers - Ansible Container </a> </li> <li class=md-nav__item> <a href=#running-an-owasp-zap-baseline-scan class=md-nav__link> Running an OWASP ZAP Baseline scan </a> </li> <li class=md-nav__item> <a href=#security-testing-against-web-applications-and-websites class=md-nav__link> Security testing against web applications and websites </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing-web-apis class=md-nav__link> Testing web APIs </a> </li> <li class=md-nav__item> <a href=#vulnerability-scanning-with-nessus class=md-nav__link> Vulnerability Scanning with Nessus </a> <nav class=md-nav aria-label="Vulnerability Scanning with Nessus"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#introduction-to-nessus class=md-nav__link> Introduction to Nessus </a> </li> <li class=md-nav__item> <a href=#installing-nessus-for-vulnerability-assessments class=md-nav__link> Installing Nessus for vulnerability assessments </a> </li> <li class=md-nav__item> <a href=#configuring-nessus-for-vulnerability-scanning class=md-nav__link> Configuring Nessus for vulnerability scanning </a> </li> <li class=md-nav__item> <a href=#basic-network-scanning class=md-nav__link> Basic network scanning </a> </li> <li class=md-nav__item> <a href=#running-a-scan-using-autonessus class=md-nav__link> Running a scan using AutoNessus </a> </li> <li class=md-nav__item> <a href=#setting-up-autonessus class=md-nav__link> Setting up AutoNessus </a> <nav class=md-nav aria-label="Setting up AutoNessus"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#listing-current-available-scans-and-ids class=md-nav__link> Listing current available scans and IDs </a> </li> <li class=md-nav__item> <a href=#starting-a-specified-scan-using-scan-id class=md-nav__link> Starting a specified scan using scan ID </a> </li> <li class=md-nav__item> <a href=#storing-results class=md-nav__link> Storing results </a> </li> <li class=md-nav__item> <a href=#installing-the-nessus-rest-api-python-client class=md-nav__link> Installing the Nessus REST API Python client </a> </li> <li class=md-nav__item> <a href=#downloading-reports-using-the-nessus-rest-api class=md-nav__link> Downloading reports using the Nessus REST API </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nessus-configuration class=md-nav__link> Nessus configuration </a> <nav class=md-nav aria-label="Nessus configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#summary class=md-nav__link> Summary </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#writing-an-ansible-module-for-security-testing class=md-nav__link> Writing an Ansible Module for Security Testing </a> <nav class=md-nav aria-label="Writing an Ansible Module for Security Testing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#getting-started-with-a-hello-world-ansible-module class=md-nav__link> Getting started with a hello world Ansible module </a> </li> <li class=md-nav__item> <a href=#setting-up-the-development-environment class=md-nav__link> Setting up the development environment </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Automating Web Application Security Testing Using OWASP ZAP</h1> <h2 id=automating-web-application-security-testing-using-owasp-zap>Automating Web Application Security Testing Using OWASP ZAP<a class=headerlink href=#automating-web-application-security-testing-using-owasp-zap title="Permanent link">&para;</a></h2> <ul> <li>The OWASP Zed Attack Proxy (commonly known as ZAP) is one of the most popular web application security testing tools. </li> <li>It has many features that allow it to be used for manual security testing; it also fits nicely into continuous integration/continuous delivery (CI/CD) environments after some tweaking and configuration. </li> <li>More details about the project can be found at <a href=https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project>https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project</a>.</li> <li>Open Web Application Security Project (OWASP) is a worldwide not-for-profit charitable organization focused on improving the security of software. </li> <li>OWASP ZAP includes many different tools and features in one package. </li> <li>For a pentester tasked with doing the security testing of web applications, the following features are invaluable</li> <li><strong>Feature: Use case</strong></li> <li>Intercepting proxy: This allows us to intercept requests and responses in the browser</li> <li>Active scanner: Automatically run web security scans against targets</li> <li>Passive scanner: Glean information about security issues from pages that get downloaded using spider tools and so on</li> <li>Spiders: Before ZAP can attack an application, it creates a site map of the application by crawling all the possible web pages on it</li> <li>REST API: Allows ZAP to be run in headless mode and to be controlled for running automated scanner, spider, and get the results</li> <li>ZAP is a Java-based software. The typical way of using it will involve the following:<ul> <li>Java Runtime Environment (JRE) 7 or more recent installed in the operating system of your choice (macOS, Windows, Linux)</li> <li>Install ZAP using package managers, installers from the official downloads page</li> </ul> </li> <li>The best way to achieve that is to use OWASP ZAP as a container. In fact, this is the kind of setup Mozilla uses ZAP in a CI/CD pipeline to verify the baseline security controls at every release. </li> </ul> <h3 id=installing-owasp-zap>Installing OWASP ZAP<a class=headerlink href=#installing-owasp-zap title="Permanent link">&para;</a></h3> <p>We are going to use OWASP ZAP as a container, which requires container runtime in the host operating system. The team behind OWASP ZAP releases ZAP Docker images on a weekly basis via Docker Hub. The approach of pulling Docker images based on tags is popular in modern DevOps environments and it makes sense that we talk about automation with respect to that.</p> <h3 id=installing-docker-runtime>Installing Docker runtime<a class=headerlink href=#installing-docker-runtime title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># The following playbook will install Docker Community Edition software in Ubuntu 16.04</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">installing docker on ubuntu</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">zap</span>
  <span class=nt>remote_user</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>remote_user_name</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>gather_facts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class=nt>become</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>remote_user_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class=nt>apt_repo_data</span><span class=p>:</span> <span class=s>&quot;deb</span><span class=nv> </span><span class=s>[arch=amd64]</span><span class=nv> </span><span class=s>https://download.docker.com/linux/ubuntu</span><span class=nv> </span><span class=s>xenial</span><span class=nv> </span><span class=s>stable&quot;</span>
    <span class=nt>apt_gpg_key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://download.docker.com/linux/ubuntu/gpg</span>

  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">adding docker gpg key</span>
      <span class=nt>apt_key</span><span class=p>:</span>
        <span class=nt>url</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>apt_gpg_key</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">add docker repository</span>
      <span class=nt>apt_repository</span><span class=p>:</span>
        <span class=nt>repo</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>apt_repo_data</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">installing docker-ce</span>
      <span class=nt>apt</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">docker-ce</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class=nt>update_cache</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">install python-pip</span>
      <span class=nt>apt</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">python-pip</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">install docker-py</span>
      <span class=nt>pip</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>item</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

      <span class=nt>with_items</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker-py</span>
</code></pre></div> <h3 id=owasp-zap-docker-container-setup>OWASP ZAP Docker container setup<a class=headerlink href=#owasp-zap-docker-container-setup title="Permanent link">&para;</a></h3> <ul> <li>The two new modules to deal with Docker containers that we will be using here are docker_image and docker_container. <div class=highlight><pre><span></span><code><span class=c1># The following playbook will take some time to complete as it has to download about 1 GB of data from the internet</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">setting up owasp zap container</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">zap</span>
  <span class=nt>remote_user</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>remote_user_name</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>gather_facts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class=nt>become</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>remote_user_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class=nt>owasp_zap_image_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp/zap2docker-weekly</span>

  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">pulling {{ owasp_zap_image_name }} container</span>
      <span class=nt>docker_image</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>owasp_zap_image_name</span><span class=nv> </span><span class=s>}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">running owasp zap container</span>
      <span class=nt>docker_container</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp-zap</span>
        <span class=nt>image</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>owasp_zap_image_name</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>interactive</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
        <span class=nt>user</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">zap</span>
        <span class=nt>command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">zap.sh -daemon -host 0.0.0.0 -port 8090 -config api.disablekey=true -config api.addrs.addr.name=.* -config api.addrs.addr.regex=true</span>
        <span class=nt>ports</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;8090:8090&quot;</span>
</code></pre></div></li> <li>You can access the ZAP API interface by navigating to <a href=http://ZAPSERVERIPADDRESS:8090>http://ZAPSERVERIPADDRESS:8090</a></li> </ul> <h3 id=a-specialized-tool-for-working-with-containers---ansible-container>A specialized tool for working with Containers - Ansible Container<a class=headerlink href=#a-specialized-tool-for-working-with-containers---ansible-container title="Permanent link">&para;</a></h3> <p>Currently, we are using Docker modules to perform container operations. A new tool, ansible-container, provides an Ansible-centric workflow for building, running, testing, and deploying containers.</p> <p>This allows us to build, push, and run containers using existing playbooks. Dockerfiles are like writing shell scripts, therefore, ansible-container will allow us to codify those Dockerfiles and build them using existing playbooks rather writing complex scripts.</p> <p>The ansible-container supports various orchestration tools, such as Kubernetes and OpenShift. It can also be used to push the build images to private registries such as Google Container Registry and Docker Hub. </p> <h3 id=running-an-owasp-zap-baseline-scan>Running an OWASP ZAP Baseline scan<a class=headerlink href=#running-an-owasp-zap-baseline-scan title="Permanent link">&para;</a></h3> <ul> <li>The following playbook runs the Docker Baseline scan against a given website URL. </li> <li>It also stores the output of the Baseline's scan in the host system in HTML, Markdown, and XML formats. <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Running OWASP ZAP Baseline Scan</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">zap</span>
  <span class=nt>remote_user</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>remote_user_name</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>gather_facts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class=nt>become</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>remote_user_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class=nt>owasp_zap_image_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp/zap2docker-weekly</span>
    <span class=nt>website_url</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>website_url</span> <span class="p p-Indicator">}}</span>
    <span class=nt>reports_location</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/zapdata/</span>
    <span class=nt>scan_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp-zap-base-line-scan-dvws</span>

  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">adding write permissions to reports directory</span>
      <span class=nt>file</span><span class=p>:</span>
        <span class=nt>path</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>reports_location</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
        <span class=nt>owner</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
        <span class=nt>group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
        <span class=nt>recurse</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0770</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">running owasp zap baseline scan container against &quot;{{ website_url }}&quot;</span>
      <span class=nt>docker_container</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>image</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>owasp_zap_image_name</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>interactive</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>auto_remove</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
        <span class=nt>volumes</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>reports_location</span><span class=nv> </span><span class=s>}}:/zap/wrk:rw&quot;</span>
        <span class=nt>command</span><span class=p>:</span> <span class=s>&quot;zap-baseline.py</span><span class=nv> </span><span class=s>-t</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>website_url</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>-r</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}_report.html&quot;</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">getting raw output of the scan</span>
      <span class=nt>command</span><span class=p>:</span> <span class=s>&quot;docker</span><span class=nv> </span><span class=s>logs</span><span class=nv> </span><span class=s>-f</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}&quot;</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">scan_output</span>

    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>scan_output</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div></li> <li>Explore the parameters of the preceding playbook:<ul> <li>website_url is the domain (or) URL that you want to perform the Baseline scan, we can pass this via &ndash;extra-vars "website_url: <a href=http://192.168.33.111>http://192.168.33.111</a>" from the ansible-playbook command</li> <li>reports_location is the path to ZAP host machine where reports get stored</li> </ul> </li> </ul> <h3 id=security-testing-against-web-applications-and-websites>Security testing against web applications and websites<a class=headerlink href=#security-testing-against-web-applications-and-websites title="Permanent link">&para;</a></h3> <ul> <li>An active scan may cause the vulnerability to be exploited in the application.</li> <li>Also, this type of scan requires extra configuration, which includes authentication and sensitive functionalities.</li> <li>The following playbook will run the full scan against the DVWS application. </li> <li>Now we can see that the playbook looks almost similar, except the flags sent to command: <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Running OWASP ZAP Full Scan</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">zap</span>
  <span class=nt>remote_user</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>remote_user_name</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>gather_facts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class=nt>become</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>remote_user_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class=nt>owasp_zap_image_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp/zap2docker-weekly</span>
    <span class=nt>website_url</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>website_url</span> <span class="p p-Indicator">}}</span>
    <span class=nt>reports_location</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/zapdata/</span>
    <span class=nt>scan_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp-zap-full-scan-dvws</span>

  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">adding write permissions to reports directory</span>
      <span class=nt>file</span><span class=p>:</span>
        <span class=nt>path</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>reports_location</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
        <span class=nt>owner</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
        <span class=nt>group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
        <span class=nt>recurse</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0777</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">running owasp zap full scan container against &quot;{{ website_url }}&quot;</span>
      <span class=nt>docker_container</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>image</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>owasp_zap_image_name</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>interactive</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>auto_remove</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
        <span class=nt>volumes</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>reports_location</span><span class=nv> </span><span class=s>}}:/zap/wrk:rw&quot;</span>
        <span class=nt>command</span><span class=p>:</span> <span class=s>&quot;zap-full-scan.py</span><span class=nv> </span><span class=s>-t</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>website_url</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>-r</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}_report.html&quot;</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">getting raw output of the scan</span>
      <span class=nt>raw</span><span class=p>:</span> <span class=s>&quot;docker</span><span class=nv> </span><span class=s>logs</span><span class=nv> </span><span class=s>-f</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}&quot;</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">scan_output</span>

    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>scan_output</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div></li> </ul> <h2 id=testing-web-apis>Testing web APIs<a class=headerlink href=#testing-web-apis title="Permanent link">&para;</a></h2> <ul> <li>Similar to the ZAP Baseline scan, the fine folks behind ZAP provide a script as part of their live and weekly Docker images. </li> <li>We can use it to run scans against API endpoints defined either by OpenAPI specification or Simple Object Access Protocol (SOAP).</li> <li>The script can understand the API specifications and import all the definitions. </li> <li>Based on this, it runs an active scan against all the URLs found. <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Running OWASP ZAP API Scan</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">zap</span>
  <span class=nt>remote_user</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>remote_user_name</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>gather_facts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class=nt>become</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>remote_user_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class=nt>owasp_zap_image_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp/zap2docker-weekly</span>
    <span class=nt>website_url</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>website_url</span> <span class="p p-Indicator">}}</span>
    <span class=nt>reports_location</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/zapdata/</span>
    <span class=nt>scan_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">owasp-zap-api-scan-dvws</span>
    <span class=nt>api_type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">openapi</span>
  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">adding write permissions to reports directory</span>
      <span class=nt>file</span><span class=p>:</span>
        <span class=nt>path</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>reports_location</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
        <span class=nt>owner</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
        <span class=nt>group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
        <span class=nt>recurse</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0777</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">running owasp zap api scan container against &quot;{{ website_url }}&quot;</span>
      <span class=nt>docker_container</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>image</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>owasp_zap_image_name</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>interactive</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>auto_remove</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
        <span class=nt>volumes</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>reports_location</span><span class=nv> </span><span class=s>}}:/zap/wrk:rw&quot;</span>
        <span class=nt>command</span><span class=p>:</span> <span class=s>&quot;zap-api-scan.py</span><span class=nv> </span><span class=s>-t</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>website_url</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>-f</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>api_type</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>-r</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}_report.html&quot;</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">getting raw output of the scan</span>
      <span class=nt>raw</span><span class=p>:</span> <span class=s>&quot;docker</span><span class=nv> </span><span class=s>logs</span><span class=nv> </span><span class=s>-f</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_name</span><span class=nv> </span><span class=s>}}&quot;</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">scan_output</span>

    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>scan_output</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div></li> </ul> <h2 id=vulnerability-scanning-with-nessus>Vulnerability Scanning with Nessus<a class=headerlink href=#vulnerability-scanning-with-nessus title="Permanent link">&para;</a></h2> <ul> <li>Scanning for vulnerabilities is one of the best understood periodic activities security teams take up on their computers. </li> <li>There are well-documented strategies and best practices for doing regular scanning for vulnerabilities in computers, networks, operating system software, and application software:<ul> <li>Basic network scans </li> <li>Credentials patch audit</li> <li>Correlating system information with known vulnerabilities</li> </ul> </li> <li>With networked systems, this type of scanning is usually executed from a connected host that has the right kind of permissions to scan for security issues. </li> <li>One of the most popular vulnerability scanning tools is Nessus. Nessus started as a network vulnerability scanning tool, but now incorporates features such as the following: <ul> <li>Port scanning</li> <li>Network vulnerability scanning</li> <li>Web application-specific scanning</li> <li>Host-based vulnerability scanning</li> </ul> </li> </ul> <h3 id=introduction-to-nessus>Introduction to Nessus<a class=headerlink href=#introduction-to-nessus title="Permanent link">&para;</a></h3> <p>The vulnerability database that Nessus has is its main advantage. While the techniques to understanding which service is running and what version of the software is running the service are known to us, answering the question, "Does this service have a known vulnerability" is the important one. Apart from a regularly updated vulnerability database, Nessus also has information on default credentials found in applications, default paths, and locations. All of this fine-tuned in an easy way to use CLI or web-based tool.</p> <ul> <li>We will try out the standard activities required for that and see what steps are needed to automate them using Ansible.<ul> <li>Installing Nessus using a playbook.</li> <li>Configuring Nessus.</li> <li>Running a scan.</li> <li>Running a scan using AutoNessus. </li> <li>Installing the Nessus REST API Python client.</li> <li>Downloading a report using the API.</li> </ul> </li> </ul> <h3 id=installing-nessus-for-vulnerability-assessments>Installing Nessus for vulnerability assessments<a class=headerlink href=#installing-nessus-for-vulnerability-assessments title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">installing nessus server</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nessus</span>
  <span class=nt>remote_user</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>remote_user_name</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>gather_facts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>remote_user_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
    <span class=nt>nessus_download_url</span><span class=p>:</span> <span class=s>&quot;http://downloads.nessus.org/nessus3dl.php?file=Nessus-6.11.2-ubuntu1110_amd64.deb&amp;licence_accept=yes&amp;t=84ed6ee87f926f3d17a218b2e52b61f0&quot;</span>

  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">install python 2</span>
      <span class=nt>raw</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">test -e /usr/bin/python || (apt -y update &amp;&amp; apt install -y python-minimal)</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">downloading the package and installing</span>
      <span class=nt>apt</span><span class=p>:</span>
        <span class=nt>deb</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>nessus_download_url</span><span class=nv> </span><span class=s>}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">start the nessus daemon</span>
      <span class=nt>service</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;nessusd&quot;</span>
        <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
</code></pre></div> <h3 id=configuring-nessus-for-vulnerability-scanning>Configuring Nessus for vulnerability scanning<a class=headerlink href=#configuring-nessus-for-vulnerability-scanning title="Permanent link">&para;</a></h3> <ul> <li>Perform the following steps to configure Nessus for vulnerability scanning:<ul> <li>We have to navigate to <a href=https://NESSUSSERVERIP:8834>https://NESSUSSERVERIP:8834</a> to confirm and start the service</li> </ul> </li> <li>It returns with an SSL error and we need to accept the SSL error and confirm the security exception and continue with the installation</li> <li>Click on Confirm Security Exception and continue to proceed with the installation steps.</li> <li>Click on Continue and provide the details of the user, this user has full administrator access.</li> <li>Then finally, we have to provide the registration code (Activation Code), which can be obtained from registering at <a href=https://www.tenable.com/products/nessus-home>https://www.tenable.com/products/nessus-home</a></li> <li>Now it will install the required plugins. It will take a while to install, and once it is done we can log in to use the application.</li> <li>Now, we have successfully set up the Nessus vulnerability scanner.</li> </ul> <h3 id=basic-network-scanning>Basic network scanning<a class=headerlink href=#basic-network-scanning title="Permanent link">&para;</a></h3> <ul> <li>Nessus has a wide variety of scans, some of them are free and some of them will be available only in a paid version. So, we can also customize the scanning if required.</li> <li>We can start with a basic network scan to see what's happening in the network. This scan will perform a basic full system scan for the given hosts.</li> <li>We have to mention the scan name and targets. Targets are just the hosts we want.</li> <li>Targets can be given in different formats, such as 192.168.33.1 for a single host, 192.168.33.1-10 for a range of hosts, and also we can upload the target file from our computer.</li> </ul> <h3 id=running-a-scan-using-autonessus>Running a scan using AutoNessus<a class=headerlink href=#running-a-scan-using-autonessus title="Permanent link">&para;</a></h3> <ul> <li>With the AutoNessus script, we can do the following:<ul> <li>List scans</li> <li>List scan policies</li> <li>Do actions on scans such as start, stop, pause, and resume</li> </ul> </li> <li>The best part of AutoNessus is that since this is a command-line tool, it can easily become part of scheduled tasks and other automation workflows.</li> </ul> <h3 id=setting-up-autonessus>Setting up AutoNessus<a class=headerlink href=#setting-up-autonessus title="Permanent link">&para;</a></h3> <ul> <li>The following code is the Ansible playbook snippet to set up AutoNessus and configure it to use Nessus using credentials. <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">installing python-pip</span>
  <span class=nt>apt</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">python-pip</span>
    <span class=nt>update_cache</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">install python requests</span>
  <span class=nt>pip</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">requests</span>

<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">setting up autonessus</span>
  <span class=nt>get_url</span><span class=p>:</span>
    <span class=nt>url</span><span class=p>:</span> <span class=s>&quot;https://github.com/redteamsecurity/AutoNessus/raw/master/autoNessus.py&quot;</span>
    <span class=nt>dest</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/autoNessus</span>
    <span class=nt>mode</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0755</span>
 
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">updating the credentials</span>
  <span class=nt>replace</span><span class=p>:</span>
    <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/autoNessus</span>
    <span class=nt>regexp</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>item.src</span><span class=nv> </span><span class=s>}}&quot;</span>
    <span class=nt>replace</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>item.dst</span><span class=nv> </span><span class=s>}}&quot;</span>
    <span class=nt>backup</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class=nt>no_log</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
 
  <span class=nt>with_items</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class=nt> src</span><span class=p>:</span> <span class=s>&quot;token</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;&#39;&quot;</span><span class="p p-Indicator">,</span><span class=nt> dst</span><span class=p>:</span> <span class=s>&quot;token</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>nessus_user_token</span><span class=nv> </span><span class=s>}}&#39;&quot;</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class=nt> src</span><span class=p>:</span> <span class=s>&quot;url</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;https://localhost:8834&#39;&quot;</span><span class="p p-Indicator">,</span><span class=nt> dst</span><span class=p>:</span> <span class=s>&quot;url</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>nessus_url</span><span class=nv> </span><span class=s>}}&#39;&quot;</span> <span class="p p-Indicator">}</span> 
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class=nt> src</span><span class=p>:</span> <span class=s>&quot;username</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;xxxxx&#39;&quot;</span><span class="p p-Indicator">,</span><span class=nt> dst</span><span class=p>:</span> <span class=s>&quot;username</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>nessus_user_name</span><span class=nv> </span><span class=s>}}&#39;&quot;</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class=nt> src</span><span class=p>:</span> <span class=s>&quot;password</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;xxxxx&#39;&quot;</span><span class="p p-Indicator">,</span><span class=nt> dst</span><span class=p>:</span> <span class=s>&quot;password</span><span class=nv> </span><span class=s>=</span><span class=nv> </span><span class=s>&#39;{{</span><span class=nv> </span><span class=s>nessus_user_password</span><span class=nv> </span><span class=s>}}&#39;&quot;</span> <span class="p p-Indicator">}</span>
</code></pre></div></li> <li><em>no_log</em>: True will censor the output in the log console of Ansible output. It will be very useful when we are using secrets and keys inside playbooks.</li> <li>Before running the automated scans using AutoNessus, we have to create them in the Nessus portal with required customization, and we can use these automated playbooks to perform tasks on top of it.</li> </ul> <h4 id=listing-current-available-scans-and-ids>Listing current available scans and IDs<a class=headerlink href=#listing-current-available-scans-and-ids title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">list current scans and IDs using autoNessus</span>
  <span class=nt>command</span><span class=p>:</span> <span class=s>&quot;autoNessus</span><span class=nv> </span><span class=s>-l&quot;</span>
  <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">list_scans_output</span>

<span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>list_scans_output.stdout_lines</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <h4 id=starting-a-specified-scan-using-scan-id>Starting a specified scan using scan ID<a class=headerlink href=#starting-a-specified-scan-using-scan-id title="Permanent link">&para;</a></h4> <p><div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">starting nessus scan &quot;{{ scan_id }}&quot; using autoNessus</span>
  <span class=nt>command</span><span class=p>:</span> <span class=s>&quot;autoNessus</span><span class=nv> </span><span class=s>-sS</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_id</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">start_scan_output</span>

<span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>start_scan_output.stdout_lines</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> - Similarly, we can perform pause, resume, stop, list policies, and so on. Using the AutoNessus program, these playbooks are available. This can be improved by advancing the Nessus API scripts.</p> <h4 id=storing-results>Storing results<a class=headerlink href=#storing-results title="Permanent link">&para;</a></h4> <ul> <li>The entire report can be exported into multiple formats, such as HTML, CSV, and Nessus. This helps to give more a detailed structure of vulnerabilities found, solutions with risk rating, and other references</li> <li>The output report can be customized based on the audience, if it goes to the technical team, we can list all the vulnerabilities and remediation. For example, if management wants to get the report, we can only get the executive summary of the issues.</li> <li>Reports can be sent by email as well using notification options in Nessus configuration.</li> </ul> <h4 id=installing-the-nessus-rest-api-python-client>Installing the Nessus REST API Python client<a class=headerlink href=#installing-the-nessus-rest-api-python-client title="Permanent link">&para;</a></h4> <ul> <li>Official API documentation can be obtained by connecting to your Nessus server under 8834/nessus6-api.html.</li> <li>To perform any operations using the Nessus REST API, we have to obtain the API keys from the portal. This can be found in user settings. Please make sure to save these keys</li> </ul> <h4 id=downloading-reports-using-the-nessus-rest-api>Downloading reports using the Nessus REST API<a class=headerlink href=#downloading-reports-using-the-nessus-rest-api title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">working with nessus rest api</span>
  <span class=nt>connection</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class=nt>gather_facts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>scan_id</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">17</span>
    <span class=nt>nessus_access_key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">620fe4ffaed47e9fe429ed749207967ecd7a77471105d8</span>
    <span class=nt>nessus_secret_key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">295414e22dc9a56abc7a89dab713487bd397cf860751a2</span>
    <span class=nt>nessus_url</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://192.168.33.109:8834</span>
    <span class=nt>nessus_report_format</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">html</span>

  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">export the report for given scan &quot;{{ scan_id }}&quot;</span>
      <span class=nt>uri</span><span class=p>:</span>
        <span class=nt>url</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>nessus_url</span><span class=nv> </span><span class=s>}}/scans/{{</span><span class=nv> </span><span class=s>scan_id</span><span class=nv> </span><span class=s>}}/export&quot;</span>
        <span class=nt>method</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">POST</span>
        <span class=nt>validate_certs</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
        <span class=nt>headers</span><span class=p>:</span>
            <span class=nt>X-ApiKeys</span><span class=p>:</span> <span class=s>&quot;accessKey={{</span><span class=nv> </span><span class=s>nessus_access_key</span><span class=nv> </span><span class=s>}};</span><span class=nv> </span><span class=s>secretKey={{</span><span class=nv> </span><span class=s>nessus_secret_key</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>body</span><span class=p>:</span> <span class=s>&quot;format={{</span><span class=nv> </span><span class=s>nessus_report_format</span><span class=nv> </span><span class=s>}}&amp;chapters=vuln_by_host;remediations&quot;</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">export_request</span>

    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;File</span><span class=nv> </span><span class=s>id</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>export_request.json.file</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>and</span><span class=nv> </span><span class=s>scan</span><span class=nv> </span><span class=s>id</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>scan_id</span><span class=nv> </span><span class=s>}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">check the report status for &quot;{{ export_request.json.file }}&quot;</span>
      <span class=nt>uri</span><span class=p>:</span>
        <span class=nt>url</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>nessus_url</span><span class=nv> </span><span class=s>}}/scans/{{</span><span class=nv> </span><span class=s>scan_id</span><span class=nv> </span><span class=s>}}/export/{{</span><span class=nv> </span><span class=s>export_request.json.file</span><span class=nv> </span><span class=s>}}/status&quot;</span>
        <span class=nt>method</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">GET</span>
        <span class=nt>validate_certs</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
        <span class=nt>headers</span><span class=p>:</span>
            <span class=nt>X-ApiKeys</span><span class=p>:</span> <span class=s>&quot;accessKey={{</span><span class=nv> </span><span class=s>nessus_access_key</span><span class=nv> </span><span class=s>}};</span><span class=nv> </span><span class=s>secretKey={{</span><span class=nv> </span><span class=s>nessus_secret_key</span><span class=nv> </span><span class=s>}}&quot;</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">report_status</span>

    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;Report</span><span class=nv> </span><span class=s>status</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>report_status.json.status</span><span class=nv> </span><span class=s>}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">downloading the report locally</span>
      <span class=nt>uri</span><span class=p>:</span>
        <span class=nt>url</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>nessus_url</span><span class=nv> </span><span class=s>}}/scans/{{</span><span class=nv> </span><span class=s>scan_id</span><span class=nv> </span><span class=s>}}/export/{{</span><span class=nv> </span><span class=s>export_request.json.file</span><span class=nv> </span><span class=s>}}/download&quot;</span>
        <span class=nt>method</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">GET</span>
        <span class=nt>validate_certs</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
        <span class=nt>headers</span><span class=p>:</span>
                  <span class=nt>X-ApiKeys</span><span class=p>:</span> <span class=s>&quot;accessKey={{</span><span class=nv> </span><span class=s>nessus_access_key</span><span class=nv> </span><span class=s>}};</span><span class=nv> </span><span class=s>secretKey={{</span><span class=nv> </span><span class=s>nessus_secret_key</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>return_content</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class=nt>dest</span><span class=p>:</span> <span class=s>&quot;./{{</span><span class=nv> </span><span class=s>scan_id</span><span class=nv> </span><span class=s>}}_{{</span><span class=nv> </span><span class=s>export_request.json.file</span><span class=nv> </span><span class=s>}}.{{</span><span class=nv> </span><span class=s>nessus_report_format</span><span class=nv> </span><span class=s>}}&quot;</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">report_output</span>

    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
      <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;Report</span><span class=nv> </span><span class=s>can</span><span class=nv> </span><span class=s>be</span><span class=nv> </span><span class=s>found</span><span class=nv> </span><span class=s>at</span><span class=nv> </span><span class=s>./{{</span><span class=nv> </span><span class=s>scan_id</span><span class=nv> </span><span class=s>}}_{{</span><span class=nv> </span><span class=s>export_request.json.file</span><span class=nv> </span><span class=s>}}.{{</span><span class=nv> </span><span class=s>nessus_report_format</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <h3 id=nessus-configuration>Nessus configuration<a class=headerlink href=#nessus-configuration title="Permanent link">&para;</a></h3> <ul> <li>Nessus allows us to create different users with role-based authentication to perform scans and review with different access levels.</li> </ul> <h4 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h4> <ul> <li>Security teams and IT teams rely on tools for vulnerability scanning, management, remediation, and continuous security processes. </li> <li>Nessus, by being one of the most popular and useful tools, was an automatic choice for the authors to try and automate.</li> </ul> <h2 id=writing-an-ansible-module-for-security-testing>Writing an Ansible Module for Security Testing<a class=headerlink href=#writing-an-ansible-module-for-security-testing title="Permanent link">&para;</a></h2> <ul> <li>Ansible primarily works by pushing small bits of code to the nodes it connects to. </li> <li>These codes/programs are what we know as Ansible modules. </li> <li>Typically in the case of a Linux host these are copied over SSH, executed, and then removed from the node.</li> <li>We will look at the following:<ul> <li>How to set up the development environment -Writing an Ansible hello world module to understand the basics -Where to seek further help -Defining a security problem statement -Addressing that problem by writing a module of our own</li> </ul> </li> <li>Along with that, we will try to understand and attempt to answer the following questions:<ul> <li>What are the good use cases for modules?</li> <li>When does it make sense to use roles?</li> <li>How do modules differ from plugins?</li> </ul> </li> </ul> <h3 id=getting-started-with-a-hello-world-ansible-module>Getting started with a hello world Ansible module<a class=headerlink href=#getting-started-with-a-hello-world-ansible-module title="Permanent link">&para;</a></h3> <ul> <li>We will pass one argument to our custom module and show if we have success or failure for the module executing based on that.</li> <li>Since all of this is new to us, we will look at the following things:<ul> <li>The source code of the hello world module</li> <li>The output of that module for both success and failure</li> <li>The command that we will use to invoke it</li> </ul> </li> </ul> <h3 id=setting-up-the-development-environment>Setting up the development environment<a class=headerlink href=#setting-up-the-development-environment title="Permanent link">&para;</a></h3> <ul> <li>The primary requirement for Ansible 2.4 is Python 2.6 or higher and Python 3.5 or higher. If you have either of them installed, we can follow the simple steps to get the development environment going.</li> <li>From the Ansible Developer Guide:<ul> <li>Clone the Ansible repository: $ git clone <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/ansible/ansible.git title="GitHub Repository: ansible/ansible.git">ansible/ansible.git</a></li> <li>Change the directory into the repository root directory: $ cd ansible</li> <li>Create a virtual environment: $ python3 -m venv venv (or for Python 2 $ virtualenv venv</li> <li>Note, this requires you to install the virtualenv package: $ pip install virtualenv</li> <li>Activate the virtual environment: $ . venv/bin/activate</li> <li>Install the development requirements: $ pip install -r requirements.txt</li> <li>Run the environment setup script for each new dev shell process: $ . hacking/env-setup</li> </ul> </li> <li>This playbook will set up the developer environment by installing and setting up the virtual environment. <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Setting Developer Environment</span>
  <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
  <span class=nt>remote_user</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">madhu</span>
  <span class=nt>become</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>ansible_code_path</span><span class=p>:</span> <span class=s>&quot;/home/madhu/ansible-code&quot;</span>

  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">installing prerequirements if not installed</span>
      <span class=nt>apt</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>item</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class=nt>update_cache</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    
      <span class=nt>with_items</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">git</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">virtualenv</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python-pip</span>
    
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">downloading ansible repo locally</span>
      <span class=nt>git</span><span class=p>:</span>
        <span class=nt>repo</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://github.com/ansible/ansible.git</span>
        <span class=nt>dest</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>ansible_code_path</span><span class=nv> </span><span class=s>}}/venv&quot;</span>
    
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">creating virtual environment</span>
      <span class=nt>pip</span><span class=p>:</span>
        <span class=nt>virtualenv</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>ansible_code_path</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>virtualenv_command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">virtualenv</span>
        <span class=nt>requirements</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>ansible_code_path</span><span class=nv> </span><span class=s>}}/venv/requirements.txt&quot;</span>
</code></pre></div></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2018 - 2019 Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script> <script src=../../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>