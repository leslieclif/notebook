<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/learning/ansible/container_cloud/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.0.3"><title>Container and Cloud Management - Leslie's Online Notebook</title><link rel=stylesheet href=../../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#container-and-cloud-management class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Container and Cloud Management </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../../devops/ci/ class=md-nav__link> CI </a> </li> <li class=md-nav__item> <a href=../../../devops/cd/ class=md-nav__link> CD </a> </li> <li class=md-nav__item> <a href=../../../devops/iac/ class=md-nav__link> IAC </a> </li> <li class=md-nav__item> <a href=../../../devops/gitops/ class=md-nav__link> GitOps </a> </li> <li class=md-nav__item> <a href=../../../devops/devops-engineer/ class=md-nav__link> Skills </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ansible/ class=md-nav__link> Ansible </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../../docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../linux/linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../linux/security/ class=md-nav__link> Linux_Security </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#container-and-cloud-management class=md-nav__link> Container and Cloud Management </a> </li> <li class=md-nav__item> <a href=#designing-and-building-containers-with-playbooks class=md-nav__link> Designing and building containers with playbooks </a> <nav class=md-nav aria-label="Designing and building containers with playbooks"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#managing-multiple-container-platforms class=md-nav__link> Managing multiple container platforms </a> </li> <li class=md-nav__item> <a href=#deploying-to-kubernetes-with-ansible-container class=md-nav__link> Deploying to Kubernetes with ansible-container </a> </li> <li class=md-nav__item> <a href=#managing-kubernetes-objects-with-ansible class=md-nav__link> Managing Kubernetes Objects with Ansible </a> </li> <li class=md-nav__item> <a href=#automating-docker-with-ansible class=md-nav__link> Automating Docker with Ansible </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#automating-against-amazon-web-services class=md-nav__link> Automating against Amazon Web Services </a> <nav class=md-nav aria-label="Automating against Amazon Web Services"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#authentication class=md-nav__link> Authentication </a> </li> <li class=md-nav__item> <a href=#creating-your-first-machine class=md-nav__link> Creating your first machine </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#automating-against-azure class=md-nav__link> Automating against Azure </a> <nav class=md-nav aria-label="Automating against Azure"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-your-first-machine_1 class=md-nav__link> Creating your first machine </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Container and Cloud Management</h1> <h2 id=container-and-cloud-management>Container and Cloud Management<a class=headerlink href=#container-and-cloud-management title="Permanent link">&para;</a></h2> <ul> <li>In the last few years, container-based workloads and cloud workloads have become more and more popular, and for this reason, we are going to look at how you can automate tasks related to those kinds of workloads with Ansible.</li> <li>First of all, even if you are in a very good place in your automation path and you have a lot of Ansible roles written for your infrastructure, you can't leverage them in Dockerfiles, so you would end up replicating your work to create containers.</li> <li>If this is not enough of a problem, this situation quickly deteriorates when you start considering cloud environments. All cloud environments have their own control planes and native automation languages, so in a very short time, you would find yourself rewriting the automation for the same operation over and over, thus wasting time and deteriorating the consistency of your environments.</li> </ul> <h2 id=designing-and-building-containers-with-playbooks>Designing and building containers with playbooks<a class=headerlink href=#designing-and-building-containers-with-playbooks title="Permanent link">&para;</a></h2> <ul> <li>Ansible provides ansible-container so that you can create containers using the same components you would use for creating machines. The first thing you should do is ensure that you have ansible-container installed. <div class=highlight><pre><span></span><code>sudo pip install ansible-container<span class=o>[</span>docker,k8s<span class=o>]</span>
</code></pre></div></li> <li>The ansible-container tool comes with three supported engines at the time of writing:<ul> <li>docker: This is needed if you want to use it with Docker Engine (that is, on your local machine).</li> <li>k8s: This is needed if you want to use it with a Kubernetes cluster, both local (that is, MiniKube) or remote (that is, a production cluster).</li> <li>openshift: This is needed if you want to use it with an OpenShift cluster, both local (that is, MiniShift) or remote (that is, a production cluster).</li> </ul> </li> <li>Follow these steps to build the container using playbooks<ul> <li>Issuing the ansible-container init command <code>ansible-container init</code></li> <li>Running this command will also create the following files:<ul> <li>ansible.cfg: An empty file to be (eventually) used to override Ansible system configurations</li> <li>ansible-requirements.txt: An empty file to (eventually) list the Python requirements for the building process of your containers</li> <li>container.yml: A file that contains the Ansible code for the build</li> <li>meta.yml: A file that contains the metadata for Ansible Galaxy</li> <li>requirements.yml: An empty file to (eventually) list the Ansible roles that are required for your build</li> </ul> </li> <li>Let's try building our own container using this tool – replace the contents of container.yml with the following <div class=highlight><pre><span></span><code><span class=nt>version</span><span class=p>:</span> <span class=s>&quot;2&quot;</span>
<span class=nt>settings</span><span class=p>:</span>
  <span class=nt>conductor</span><span class=p>:</span>
    <span class=nt>base</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">centos:7</span>
  <span class=nt>project_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http-server</span>
<span class=nt>services</span><span class=p>:</span>
  <span class=nt>web</span><span class=p>:</span>
    <span class=nt>from</span><span class=p>:</span> <span class=s>&quot;centos:7&quot;</span>
    <span class=nt>roles</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">geerlingguy.apache</span>
    <span class=nt>ports</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;80:80&quot;</span>
    <span class=nt>command</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;/usr/bin/dumb-init&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;/usr/sbin/apache2ctl&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;-D&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;FOREGROUND&quot;</span>
    <span class=nt>dev_overrides</span><span class=p>:</span>
      <span class=nt>environment</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=s>&quot;DEBUG=1&quot;</span>
</code></pre></div></li> <li>We can now run ansible-container build to initiate the build.</li> <li>At the end of the building process, we will have a container built with the geerlingguy.apache role applied to it. The ansible-container tool performs a multi-stage build capability, spinning up an Ansible container that is then used to build the real container.</li> <li>If we specified more than one role to be applied, the output would be an image with more layers, since Ansible will create a layer for every specified role. In this way, containers can easily be built using your existing Ansible roles rather than Dockerfiles.</li> </ul> </li> </ul> <h3 id=managing-multiple-container-platforms>Managing multiple container platforms<a class=headerlink href=#managing-multiple-container-platforms title="Permanent link">&para;</a></h3> <ul> <li>To be able to call a deployment "production-ready," you need to be able to demonstrate that the service your application is delivering will run reasonably, even in the case of a single application crash, as well as hardware failure. Often, you'll have even more reliability constraints from your customer.</li> <li>Today, the most successful one is Kubernetes due to its various distributions/versions, so we are going to focus on it primarily.</li> <li>The idea of Kubernetes is that you inform the Kubernetes Control Plane that you want X number of instances of your Y application, and Kubernetes will count how many instances of the Y application are running on the Kubernetes Nodes to ensure that the number of instances are X. If there are too few instances, Kubernetes will take care to start more instances, while if there are too many instances, the exceeding instances will be stopped.</li> <li>Due to the complexity of installing and managing Kubernetes, multiple companies have started to sell distributions of Kubernetes that simplify their operations and that they are willing to support.</li> </ul> <h3 id=deploying-to-kubernetes-with-ansible-container>Deploying to Kubernetes with ansible-container<a class=headerlink href=#deploying-to-kubernetes-with-ansible-container title="Permanent link">&para;</a></h3> <ul> <li>We will assume that you have access to either a Kubernetes cluster for testing. </li> <li>To deploy your application to your cluster, you need to change the container.yml file so that you can add some additional information. We will need to add a section called <strong>settings</strong> and a section called <strong>k8s_namespace</strong> to declare our deployment settings. <div class=highlight><pre><span></span><code><span class=nt>k8s_namespace</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http-server</span>
  <span class=nt>description</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">An HTTP server</span>
  <span class=nt>display_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">HTTP server</span>
</code></pre></div></li> <li>We can proceed with the deployment- <code>ansible-container --engine kubernetes deploy</code></li> <li>As soon as Ansible has completed its execution, you will be able to find the http-server deployment on your Kubernetes cluster.</li> <li>Based on the image that we built in the previous section and the additional information we added at the beginning of this section, Ansible is able to populate a deployment template and then deploy it using the k8s module.</li> </ul> <h3 id=managing-kubernetes-objects-with-ansible>Managing Kubernetes Objects with Ansible<a class=headerlink href=#managing-kubernetes-objects-with-ansible title="Permanent link">&para;</a></h3> <ul> <li>You can do <code>kubectl get namespaces</code> with Ansible by creating a file called k8s-ns-show.yaml <div class=highlight><pre><span></span><code><span class=nn>---</span>
<span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Get information from K8s</span>
      <span class=nt>k8s_info</span><span class=p>:</span>
        <span class=nt>api_version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
        <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Namespace</span>     <span class=c1># Specify the k8s object Deployments, Services, Pods</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ns</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Print info</span>
      <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>var</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ns</span>
</code></pre></div> <div class=highlight><pre><span></span><code>ansible-playbook k8s-ns-show.yaml
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Create a new namespace</span>
<span class=nn>---</span>
<span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure the myns namespace exists</span>
      <span class=nt>k8s</span><span class=p>:</span>
        <span class=nt>api_version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
        <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Namespace</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myns</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Creates a new service</span>
<span class=nn>---</span>
<span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure the Service mysvc is present</span>
      <span class=nt>k8s</span><span class=p>:</span>
        <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class=nt>definition</span><span class=p>:</span>
          <span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
          <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
          <span class=nt>metadata</span><span class=p>:</span>
            <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysvc</span>
            <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myns</span>
          <span class=nt>spec</span><span class=p>:</span>
            <span class=nt>selector</span><span class=p>:</span>
              <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
              <span class=nt>service</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysvc</span>
            <span class=nt>ports</span><span class=p>:</span>
              <span class="p p-Indicator">-</span> <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
                <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">800</span>
                <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">port-80-tcp</span>
                <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></li> <li>Ansible allows you to manage your Kubernetes clusters with some modules:<ul> <li>k8s: Allows you to manage any kind of Kubernetes object</li> <li>k8s_auth: Allows you to authenticate to Kubernetes clusters that require an explicit login step</li> <li>k8s_facts: Allows you to inspect Kubernetes objects</li> <li>k8s_scale: Allows you to set a new size for a Deployment, ReplicaSet, Replication Controller, or Job</li> <li>k8s_service: Allows you to manage Services on Kubernetes</li> </ul> </li> </ul> <h3 id=automating-docker-with-ansible>Automating Docker with Ansible<a class=headerlink href=#automating-docker-with-ansible title="Permanent link">&para;</a></h3> <ul> <li>With Ansible, you can easily manage your Docker instance in Development environments.</li> <li>First of all, we need to create a playbook called start-docker-container.yaml that will contain the following code <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Start a container with a command</span>
      <span class=nt>docker_container</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">test-container</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
        <span class=nt>command</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">echo</span>
          <span class="p p-Indicator">-</span> <span class=s>&quot;Hello,</span><span class=nv> </span><span class=s>World!&quot;</span>
</code></pre></div></li> <li>Other modules include the following:<ul> <li>docker_config: Used to change the configurations of the Docker daemon</li> <li>docker_container_info: Used to gather information from (inspect) a container</li> <li>docker_network: Used to manage Docker networking configuration</li> </ul> </li> </ul> <h2 id=automating-against-amazon-web-services>Automating against Amazon Web Services<a class=headerlink href=#automating-against-amazon-web-services title="Permanent link">&para;</a></h2> <p>To be able to use Ansible to automate your Amazon Web Service estate, you'll need to install the boto library. <div class=highlight><pre><span></span><code>pip install boto
</code></pre></div></p> <h3 id=authentication>Authentication<a class=headerlink href=#authentication title="Permanent link">&para;</a></h3> <ul> <li>The boto library looks up the necessary credentials in the <code>~/.aws/credentials</code> file. </li> <li>There are two different ways to ensure that the credentials file is configured properly.<ul> <li>It is possible to use the AWS CLI tool. </li> <li>Alternatively, this can be done with a text editor of your choice by creating a file with the following structure <div class=highlight><pre><span></span><code><span class=o>[</span>default<span class=o>]</span>
<span class=nv>aws_access_key_id</span> <span class=o>=</span> <span class=o>[</span>YOUR_KEY_HERE<span class=o>]</span>
<span class=nv>aws_secret_access_key</span> <span class=o>=</span> <span class=o>[</span>YOUR_SECRET_ACCESS_KEY_HERE<span class=o>]</span>
</code></pre></div></li> </ul> </li> <li>Now that you've created the file with the necessary credentials, boto will be able to work against your AWS environment.</li> <li>Since Ansible uses boto for every single communication with AWS systems, this means that Ansible will be appropriately configured, even without you have to change any Ansible-specific configuration.</li> </ul> <h3 id=creating-your-first-machine>Creating your first machine<a class=headerlink href=#creating-your-first-machine title="Permanent link">&para;</a></h3> <ul> <li>To launch a virtual machine in AWS, we need a few things to be in place, as follows:<ul> <li>An SSH key pair</li> <li>A network</li> <li>A subnetwork</li> <li>A security group</li> </ul> </li> <li>By default, a network and a subnetwork are already available in your accounts, but you need to retrieve their IDs.</li> <li>Create the aws.yaml Playbook with the following content <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure key pair is present</span>
      <span class=nt>ec2_key</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fale</span>
        <span class=nt>key_material</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>lookup(&#39;file&#39;,</span><span class=nv> </span><span class=s>&#39;~/.ssh/fale.pub&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Gather information of the EC2 VPC net in eu-west-1</span>
      <span class=nt>ec2_vpc_net_facts</span><span class=p>:</span>
        <span class=nt>region</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">eu-west-1</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aws_simple_net</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Gather information of the EC2 VPC subnet in eu-west-1</span>
      <span class=nt>ec2_vpc_subnet_facts</span><span class=p>:</span>
        <span class=nt>region</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">eu-west-1</span>
        <span class=nt>filters</span><span class=p>:</span>
          <span class=nt>vpc-id</span><span class=p>:</span> <span class=s>&#39;{{</span><span class=nv> </span><span class=s>aws_simple_net.vpcs.0.id</span><span class=nv> </span><span class=s>}}&#39;</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aws_simple_subnet</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure wssg Security Group is present</span>
      <span class=nt>ec2_group</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">wssg</span>
        <span class=nt>description</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Web Security Group</span>
        <span class=nt>region</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">eu-west-1</span>
        <span class=nt>vpc_id</span><span class=p>:</span> <span class=s>&#39;{{</span><span class=nv> </span><span class=s>aws_simple_net.vpcs.0.id</span><span class=nv> </span><span class=s>}}&#39;</span>
        <span class=nt>rules</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>proto</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
            <span class=nt>from_port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">22</span>
            <span class=nt>to_port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">22</span>
            <span class=nt>cidr_ip</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
          <span class="p p-Indicator">-</span> <span class=nt>proto</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
            <span class=nt>from_port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class=nt>to_port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
            <span class=nt>cidr_ip</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
          <span class="p p-Indicator">-</span> <span class=nt>proto</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
            <span class=nt>from_port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
            <span class=nt>to_port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
            <span class=nt>cidr_ip</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
        <span class=nt>rules_egress</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>proto</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
            <span class=nt>cidr_ip</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
      <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aws_simple_wssg</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Setup instance</span>
      <span class=nt>ec2</span><span class=p>:</span>
        <span class=nt>assign_public_ip</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ami-3548444c</span>
        <span class=nt>region</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">eu-west-1</span>
        <span class=nt>exact_count</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
        <span class=nt>key_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fale</span>
        <span class=nt>count_tag</span><span class=p>:</span>
          <span class=nt>Name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ws01.ansible2cookbook.com</span>
        <span class=nt>instance_tags</span><span class=p>:</span>
          <span class=nt>Name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ws01.ansible2cookbook.coms</span>
        <span class=nt>instance_type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">t2.micro</span>
        <span class=nt>group_id</span><span class=p>:</span> <span class=s>&#39;{{</span><span class=nv> </span><span class=s>aws_simple_wssg.group_id</span><span class=nv> </span><span class=s>}}&#39;</span>
        <span class=nt>vpc_subnet_id</span><span class=p>:</span> <span class=s>&#39;{{</span><span class=nv> </span><span class=s>aws_simple_subnet.subnets.0.id</span><span class=nv> </span><span class=s>}}&#39;</span>
        <span class=nt>volumes</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>device_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/sda1</span>
            <span class=nt>volume_type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">gp2</span>
            <span class=nt>volume_size</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
            <span class=nt>delete_on_termination</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</code></pre></div> <div class=highlight><pre><span></span><code>ansible-playbook aws.yaml
</code></pre></div></li> <li>We started by uploading the public part of an SSH keypair to AWS, then queried for information about the network and the subnetwork, then ensured that the Security Group we wanted to use was present, and lastly triggered the machine build.</li> </ul> <h2 id=automating-against-azure>Automating against Azure<a class=headerlink href=#automating-against-azure title="Permanent link">&para;</a></h2> <ul> <li>To let Ansible manage the Azure cloud, you need to install the Azure SDK for Python. <div class=highlight><pre><span></span><code> pip install <span class=s1>&#39;ansible[azure]&#39;</span>
 <span class=sb>```</span>
 <span class=c1>## Authentication</span>
- There are different ways to ensure that Ansible is able to manage Azure <span class=k>for</span> you, based on the way your Azure account is <span class=nb>set</span> up, but they can all be configured <span class=k>in</span> the <span class=sb>`</span>~/.azure/credentials<span class=sb>`</span> file.
<span class=sb>```</span>BASH
<span class=o>[</span>default<span class=o>]</span>
<span class=nv>subscription_id</span> <span class=o>=</span> <span class=o>[</span>YOUR_SUBSCIRPTION_ID_HERE<span class=o>]</span>
<span class=nv>client_id</span> <span class=o>=</span> <span class=o>[</span>YOUR_CLIENT_ID_HERE<span class=o>]</span>
<span class=nv>secret</span> <span class=o>=</span> <span class=o>[</span>YOUR_SECRET_HERE<span class=o>]</span>
<span class=nv>tenant</span> <span class=o>=</span> <span class=o>[</span>YOUR_TENANT_HERE<span class=o>]</span>
</code></pre></div></li> <li>If you prefer to use Active Directories with a username and password. <div class=highlight><pre><span></span><code><span class=o>[</span>default<span class=o>]</span>
<span class=nv>ad_user</span> <span class=o>=</span> <span class=o>[</span>YOUR_AD_USER_HERE<span class=o>]</span>
<span class=nv>password</span> <span class=o>=</span> <span class=o>[</span>YOUR_AD_PASSWORD_HERE<span class=o>]</span>
</code></pre></div></li> <li>You can opt for an Active Directory login with ADFS. <div class=highlight><pre><span></span><code><span class=o>[</span>default<span class=o>]</span>
<span class=nv>ad_user</span> <span class=o>=</span> <span class=o>[</span>YOUR_AD_USER_HERE<span class=o>]</span>
<span class=nv>password</span> <span class=o>=</span> <span class=o>[</span>YOUR_AD_PASSWORD_HERE<span class=o>]</span>
<span class=nv>client_id</span> <span class=o>=</span> <span class=o>[</span>YOUR_CLIENT_ID_HERE<span class=o>]</span>
<span class=nv>tenant</span> <span class=o>=</span> <span class=o>[</span>YOUR_TENANT_HERE<span class=o>]</span>
<span class=nv>adfs_authority_url</span> <span class=o>=</span> <span class=o>[</span>YOUR_ADFS_AUTHORITY_URL_HERE<span class=o>]</span>
</code></pre></div></li> </ul> <h3 id=creating-your-first-machine_1>Creating your first machine<a class=headerlink href=#creating-your-first-machine_1 title="Permanent link">&para;</a></h3> <ul> <li>Create the azure.yaml Playbook with the following content.</li> <li>In Azure, you will need all the resources to be ready before you can issue the machine creation command. </li> <li>This is the reason you create the Storage Account, the Virtual Network, the Subnet, the Public IP, the security Group, and the NIC first, and only at that point, the machine itself. <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure the Storage Account is present</span>
      <span class=nt>azure_rm_storageaccount</span><span class=p>:</span>
        <span class=nt>resource_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Testing</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysa</span>
        <span class=nt>account_type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Standard_LRS</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure the Virtual Network is present</span>
      <span class=nt>azure_rm_virtualnetwork</span><span class=p>:</span>
        <span class=nt>resource_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Testing</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myvn</span>
        <span class=nt>address_prefixes</span><span class=p>:</span> <span class=s>&quot;10.10.0.0/16&quot;</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure the Subnet is present</span>
      <span class=nt>azure_rm_subnet</span><span class=p>:</span>
        <span class=nt>resource_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Testing</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysn</span>
        <span class=nt>address_prefix</span><span class=p>:</span> <span class=s>&quot;10.10.0.0/24&quot;</span>
        <span class=nt>virtual_network</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myvn</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure that the Public IP is set</span>
      <span class=nt>azure_rm_publicipaddress</span><span class=p>:</span>
        <span class=nt>resource_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Testing</span>
        <span class=nt>allocation_method</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Static</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myip</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure a Security Group allowing SSH is present</span>
      <span class=nt>azure_rm_securitygroup</span><span class=p>:</span>
        <span class=nt>resource_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Testing</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysg</span>
        <span class=nt>rules</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">SSH</span>
            <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Tcp</span>
            <span class=nt>destination_port_range</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">22</span>
            <span class=nt>access</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Allow</span>
            <span class=nt>priority</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">101</span>
            <span class=nt>direction</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Inbound</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure the NIC is present</span>
      <span class=nt>azure_rm_networkinterface</span><span class=p>:</span>
        <span class=nt>resource_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Testing</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">testnic001</span>
        <span class=nt>virtual_network</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myvn</span>
        <span class=nt>subnet</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysn</span>
        <span class=nt>public_ip_name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myip</span>
        <span class=nt>security_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysg</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure the Virtual Machine is present</span>
      <span class=nt>azure_rm_virtualmachine</span><span class=p>:</span>
        <span class=nt>resource_group</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Testing</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myvm01</span>
        <span class=nt>vm_size</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Standard_D1</span>
        <span class=nt>storage_account</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysa</span>
        <span class=nt>storage_container</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myvm01</span>
        <span class=nt>storage_blob</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myvm01.vhd</span>
        <span class=nt>admin_username</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">admin</span>
        <span class=nt>admin_password</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Password!</span>
        <span class=nt>network_interfaces</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">testnic001</span>
        <span class=nt>image</span><span class=p>:</span>
          <span class=nt>offer</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">CentOS</span>
          <span class=nt>publisher</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">OpenLogic</span>
          <span class=nt>sku</span><span class=p>:</span> <span class=s>&#39;8.0&#39;</span>
          <span class=nt>version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">latest</span>
</code></pre></div> <div class=highlight><pre><span></span><code>ansible-playbook azure.yaml
</code></pre></div></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2018 - 2019 Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script> <script src=../../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>