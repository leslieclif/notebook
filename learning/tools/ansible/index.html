<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/learning/tools/ansible/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.1, mkdocs-material-7.0.3"><title>Ansible - Leslie's Online Notebook</title><link rel=stylesheet href=../../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#ansible class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Ansible </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/ class=md-nav__link> Devops </a> </li> <li class=md-nav__item> <a href=../../../devops/ci/ class=md-nav__link> CI </a> </li> <li class=md-nav__item> <a href=../../../devops/cd/ class=md-nav__link> CD </a> </li> <li class=md-nav__item> <a href=../../../devops/iac/ class=md-nav__link> IAC </a> </li> <li class=md-nav__item> <a href=../../../devops/gitops/ class=md-nav__link> GitOps </a> </li> <li class=md-nav__item> <a href=../../../devops/devops-engineer/ class=md-nav__link> Skills </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ansible/ansible/ class=md-nav__link> Ansible </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../../docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../linux/linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../linux/security/ class=md-nav__link> Linux_Security </a> </li> <li class=md-nav__item> <a href=../../linux/firewall/ class=md-nav__link> Linux_Firewall </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#ansible class=md-nav__link> Ansible </a> <nav class=md-nav aria-label=Ansible> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tldr class=md-nav__link> TL;DR </a> </li> <li class=md-nav__item> <a href=#templating class=md-nav__link> Templating </a> <nav class=md-nav aria-label=Templating> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tests class=md-nav__link> Tests </a> </li> <li class=md-nav__item> <a href=#loops class=md-nav__link> Loops </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#roles class=md-nav__link> Roles </a> <nav class=md-nav aria-label=Roles> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-roles class=md-nav__link> Get roles </a> </li> <li class=md-nav__item> <a href=#role-dependencies class=md-nav__link> Role dependencies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#output-formatting class=md-nav__link> Output formatting </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#print-all-known-variables class=md-nav__link> Print all known variables </a> </li> <li class=md-nav__item> <a href=#force-notified-handlers-to-run-at-a-specific-point class=md-nav__link> Force notified handlers to run at a specific point </a> </li> <li class=md-nav__item> <a href=#run-specific-tasks-even-in-check-mode class=md-nav__link> Run specific tasks even in check mode </a> </li> <li class=md-nav__item> <a href=#dry-run-only-specific-tasks class=md-nav__link> Dry-run only specific tasks </a> </li> <li class=md-nav__item> <a href=#set-up-recursive-permissions-on-a-directory-so-that-directories-are-set-to-755-and-files-to-644 class=md-nav__link> Set up recursive permissions on a directory so that directories are set to 755 and files to 644 </a> </li> <li class=md-nav__item> <a href=#only-run-a-task-when-another-has-a-specific-result class=md-nav__link> Only run a task when another has a specific result </a> </li> <li class=md-nav__item> <a href=#define-when-a-task-changed-or-failed class=md-nav__link> Define when a task changed or failed </a> </li> <li class=md-nav__item> <a href=#set-environment-variables-for-a-play-role-or-task class=md-nav__link> Set environment variables for a play, role or task </a> </li> <li class=md-nav__item> <a href=#set-variables-to-the-value-of-environment-variables class=md-nav__link> Set variables to the value of environment variables </a> </li> <li class=md-nav__item> <a href=#check-if-a-list-contains-an-item-and-fail-otherwise class=md-nav__link> Check if a list contains an item and fail otherwise </a> </li> <li class=md-nav__item> <a href=#define-different-values-for-truefalsenull class=md-nav__link> Define different values for true/false/null </a> </li> <li class=md-nav__item> <a href=#force-a-task-or-play-to-use-a-specific-python-interpreter class=md-nav__link> Force a task or play to use a specific Python interpreter </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#further-readings class=md-nav__link> Further readings </a> </li> <li class=md-nav__item> <a href=#sources class=md-nav__link> Sources </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Ansible</h1> <h2 id=ansible>Ansible<a class=headerlink href=#ansible title="Permanent link">&para;</a></h2> <ol> <li><a href=#tldr>TL;DR</a></li> <li><a href=#templating>Templating</a></li> <li><a href=#tests>Tests</a></li> <li><a href=#loops>Loops</a></li> <li><a href=#roles>Roles</a></li> <li><a href=#get-roles>Get roles</a></li> <li><a href=#role-dependencies>Role dependencies</a></li> <li><a href=#output-formatting>Output formatting</a></li> <li><a href=#troubleshooting>Troubleshooting</a></li> <li><a href=#print-all-known-variables>Print all known variables</a></li> <li><a href=#force-notified-handlers-to-run-at-a-specific-point>Force notified handlers to run at a specific point</a></li> <li><a href=#run-specific-tasks-even-in-check-mode>Run specific tasks even in check mode</a></li> <li><a href=#dry-run-only-specific-tasks>Dry-run only specific tasks</a></li> <li><a href=#set-up-recursive-permissions-on-a-directory-so-that-directories-are-set-to-755-and-files-to-644>Set up recursive permissions on a directory so that directories are set to 755 and files to 644</a></li> <li><a href=#only-run-a-task-when-another-has-a-specific-result>Only run a task when another has a specific result</a></li> <li><a href=#define-when-a-task-changed-or-failed>Define when a task changed or failed</a></li> <li><a href=#set-environment-variables-for-a-play-role-or-task>Set environment variables for a play, role or task</a></li> <li><a href=#set-variables-to-the-value-of-environment-variables>Set variables to the value of environment variables</a></li> <li><a href=#check-if-a-list-contains-an-item-and-fail-otherwise>Check if a list contains an item and fail otherwise</a></li> <li><a href=#define-different-values-for-truefalsenull>Define different values for <code>true</code>/<code>false</code>/<code>null</code></a></li> <li><a href=#force-a-task-or-play-to-use-a-specific-python-interpreter>Force a task or play to use a specific Python interpreter</a></li> <li><a href=#further-readings>Further readings</a></li> <li><a href=#sources>Sources</a></li> </ol> <h3 id=tldr>TL;DR<a class=headerlink href=#tldr title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Install.</span>
pip3 install --user ansible <span class=o>&amp;&amp;</span> port install sshpass   <span class=c1># darwin</span>
sudo pamac install ansible sshpass                    <span class=c1># manjaro linux</span>

<span class=c1># Show hosts&#39; ansible facts.</span>
ansible -i hostfile -m setup all
ansible -i host1,hostn, -m setup host1 -u remote-user
ansible -i localhost, -c <span class=nb>local</span> -km setup localhost

<span class=c1># Check the syntax of a playbook.</span>
<span class=c1># This will *not* execute the plays inside it.</span>
ansible-playbook path/to/playbook.yml --syntax-check

<span class=c1># Execute a playbook.</span>
ansible-playbook path/to/playbook.yml -i hosts.list
ansible-playbook path/to/playbook.yml -i host1,host2,hostn, -l hosts,list
ansible-playbook path/to/playbook.yml -i host1,host2,other, -l hosts-pattern

<span class=c1># Show what changes (with details) a play whould apply to the local machine.</span>
ansible-playbook path/to/playbook.yml -i localhost, -c <span class=nb>local</span> -vvC

<span class=c1># Only execute tasks with specific tags.</span>
ansible-playbook path/to/playbook.yml --tags <span class=s2>&quot;configuration,packages&quot;</span>

<span class=c1># Avoid executing tasks with specific tags.</span>
ansible-playbook path/to/playbook.yml --skip-tags <span class=s2>&quot;system,user&quot;</span>

<span class=c1># Check what tasks will be executed.</span>
ansible-playbook example.yml --list-tasks
ansible-playbook example.yml --list-tasks --tags <span class=s2>&quot;configuration,packages&quot;</span>
ansible-playbook example.yml --list-tasks --skip-tags <span class=s2>&quot;system,user&quot;</span>

<span class=c1># List roles installed from Galaxy.</span>
ansible-galaxy list

<span class=c1># Install roles from Galaxy.</span>
ansible-galaxy install namespace.role
ansible-galaxy install --roles-path ~/ansible-roles namespace.role
ansible-galaxy install namespace.role,v1.0.0
ansible-galaxy install git+https://github.com/namespace/role.git,commit-hash
ansible-galaxy install -r requirements.yml

<span class=c1># Remove roles installed from Galaxy.</span>
ansible-galaxy remove namespace.role
</code></pre></div> <h3 id=templating>Templating<a class=headerlink href=#templating title="Permanent link">&para;</a></h3> <p>Ansible leverages <a href=https://jinja.palletsprojects.com/en/3.1.x/templates/ >Jinja2 templating</a>, which can be used directly in tasks or through the <code>template</code> module.</p> <p>All Jinja2's standard filters and tests can be used, with the addition of:</p> <ul> <li>specialized filters for selecting and transforming data</li> <li>tests for evaluating template expressions</li> <li>lookup plugins for retrieving data from external sources for use in templating</li> </ul> <p>All templating happens <strong>on the Ansible controller</strong>, <strong>before</strong> the task is sent and executed on the target machine.</p> <p>Updated <a href=../ansible/examples.yml>examples</a> are available.</p> <div class=highlight><pre><span></span><code><span class=c1># Remove empty or false values from a list piping it to &#39;select()&#39;.</span><span class=w></span>
<span class=c1># Returns [&quot;string&quot;].</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>list</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;string&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>0</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>false</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list | select</span><span class=w></span>

<span class=c1># Remove only empty strings from a list &#39;reject()&#39;ing them.</span><span class=w></span>
<span class=c1># Returns [&quot;string&quot;, 0, false].</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>list</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;string&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>0</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>false</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list | reject(&#39;match&#39;, &#39;^$&#39;)</span><span class=w></span>

<span class=c1># Merge two lists.</span><span class=w></span>
<span class=c1># Returns [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;].</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>list1</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;a&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;b&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>    </span><span class=nt>list2</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;c&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;d&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list1 + list2</span><span class=w></span>

<span class=c1># Dedupe elements in a list.</span><span class=w></span>
<span class=c1># Returns [&quot;a&quot;, &quot;b&quot;].</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>list</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;a&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;b&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;b&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;a&quot;</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list | unique</span><span class=w></span>

<span class=c1># Sort a list by version number (not lexicographically).</span><span class=w></span>
<span class=c1># Returns [&#39;2.7.0&#39;, &#39;2.8.0&#39;, &#39;2.9.0&#39;, &#39;2.10.0&#39; &#39;2.11.0&#39;].</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>list</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;2.8.0&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;2.11.0&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;2.7.0&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;2.10.0&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;2.9.0&#39;</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list | community.general.version_sort</span><span class=w></span>

<span class=c1># Generate a random password.</span><span class=w></span>
<span class=c1># Returns a random string following the specifications.</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>lookup(&#39;password&#39;,</span><span class=nv> </span><span class=s>&#39;/dev/null</span><span class=nv> </span><span class=s>length=32</span><span class=nv> </span><span class=s>chars=ascii_letters,digits,punctuation&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span><span class=w></span>

<span class=c1># Hash a password.</span><span class=w></span>
<span class=c1># Returns a hash of the requested type.</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">abcd</span><span class=w></span>
<span class=w>    </span><span class=nt>salt</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>lookup(&#39;community.general.random_string&#39;,</span><span class=nv> </span><span class=s>special=false)</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password | password_hash(&#39;sha512&#39;, salt)</span><span class=w></span>

<span class=c1># Get a variable&#39;s type.</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&#39;string&#39;</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>type_debug&quot;</span><span class=w></span>
</code></pre></div> <h4 id=tests>Tests<a class=headerlink href=#tests title="Permanent link">&para;</a></h4> <p>Return a boolean result.</p> <div class=highlight><pre><span></span><code><span class=c1># Compare semver version numbers.</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&#39;2.0.0-rc.1+build.123&#39;</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>version(&#39;2.1.0-rc.2+build.423&#39;,</span><span class=nv> </span><span class=s>&#39;ge&#39;,</span><span class=nv> </span><span class=s>version_type=&#39;semver&#39;)&quot;</span><span class=w></span>
</code></pre></div> <h4 id=loops>Loops<a class=headerlink href=#loops title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=c1># Get the values of some special variables.</span><span class=w></span>
<span class=c1># See the &#39;Further readings&#39; section for the full list.</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>var</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>item</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>with_items</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;ansible_local&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;playbook_dir&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;role_path&quot;</span><span class="p p-Indicator">]</span><span class=w></span>


<span class=c1># Fail when any of the given variables is an empty string.</span><span class=w></span>
<span class=c1># Returns the ones which are empty.</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">lookup(&#39;vars&#39;, item) == &#39;&#39;</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.fail</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s>&quot;The</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>item</span><span class=nv> </span><span class=s>}}</span><span class=nv> </span><span class=s>variable</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>an</span><span class=nv> </span><span class=s>empty</span><span class=nv> </span><span class=s>string&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>loop</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">variable1</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">variableN</span><span class=w></span>

<span class=c1># Iterate thrugh nested loops.</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>middles</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;middle1&#39;</span><span class=w></span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;middle2&#39;</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>item[0]</span><span class=nv> </span><span class=s>}},</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>item[1]</span><span class=nv> </span><span class=s>}},</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>item[2]</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>with_nested</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;outer1&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;outer2&#39;</span><span class="p p-Indicator">]</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>middles</span><span class=nv> </span><span class=s>}}&quot;</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&#39;inner1&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;inner2&#39;</span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div> <h3 id=roles>Roles<a class=headerlink href=#roles title="Permanent link">&para;</a></h3> <h4 id=get-roles>Get roles<a class=headerlink href=#get-roles title="Permanent link">&para;</a></h4> <p>Roles can be either <strong>created</strong>:</p> <div class=highlight><pre><span></span><code>ansible-galaxy init role-name
</code></pre></div> <p>or <strong>installed</strong> from <a href=https://galaxy.ansible.com/ >Ansible Galaxy</a>:</p> <div class=highlight><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=c1># requirements.yml</span><span class=w></span>
<span class=nt>collections</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">community.docker</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code>ansible-galaxy install mcereda.boinc_client
ansible-galaxy install --roles-path ~/ansible-roles namespace.role
ansible-galaxy install namespace.role,v1.0.0
ansible-galaxy install git+https://github.com/namespace/role.git,0b7cd353c0250e87a26e0499e59e7fd265cc2f25
ansible-galaxy install -r requirements.yml
</code></pre></div> <h4 id=role-dependencies>Role dependencies<a class=headerlink href=#role-dependencies title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=c1># role/meta/main.yml</span><span class=w></span>
<span class=nt>dependencies</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>role</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">common</span><span class=w></span>
<span class=w>    </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>some_parameter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>role</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span><span class=w></span>
<span class=w>    </span><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>dbname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">blarg</span><span class=w></span>
<span class=w>      </span><span class=nt>other_parameter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">12</span><span class=w></span>
</code></pre></div> <h3 id=output-formatting>Output formatting<a class=headerlink href=#output-formatting title="Permanent link">&para;</a></h3> <blockquote> <p>Introduced in Ansible 2.5</p> </blockquote> <p>Change Ansible's output setting the stdout callback to <code>json</code> or <code>yaml</code>:</p> <div class=highlight><pre><span></span><code><span class=nv>ANSIBLE_STDOUT_CALLBACK</span><span class=o>=</span>yaml
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># ansible.cfg</span><span class=w></span>
<span class=k>[defaults]</span><span class=w></span>
<span class=na>stdout_callback</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>json</span><span class=w></span>
</code></pre></div> <p><code>yaml</code> will set tasks output only to be in the defined format:</p> <div class=highlight><pre><span></span><code>$ ANSIBLE_STDOUT_CALLBACK=yaml ansible-playbook --inventory=localhost.localdomain, ansible/localhost.configure.yml -vv --check
PLAY [Configure localhost] *******************************************************************

TASK [Upgrade system packages] ***************************************************************
task path: /home/user/localhost.configure.yml:7
ok: [localhost.localdomain] =&gt; changed=false
  cmd:
  - /usr/bin/zypper
  - --quiet
  - --non-interactive
  …
  update_cache: false
</code></pre></div> <p>The <code>json</code> output format will be a single, long JSON file:</p> <div class=highlight><pre><span></span><code>$ ANSIBLE_STDOUT_CALLBACK=yaml ansible-playbook --inventory=localhost.localdomain, ansible/localhost.configure.yml -vv --check
{
    &quot;custom_stats&quot;: {},
    &quot;global_custom_stats&quot;: {},
    &quot;plays&quot;: [
        {
            &quot;play&quot;: {
                …
                &quot;name&quot;: &quot;Configure localhost&quot;
            },
            &quot;tasks&quot;: [
                {
                    &quot;hosts&quot;: {
                        &quot;localhost.localdomain&quot;: {
                            …
                            &quot;action&quot;: &quot;community.general.zypper&quot;,
                            &quot;changed&quot;: false,
                            …
                            &quot;update_cache&quot;: false
                        }
                    }
                    …
…
}
</code></pre></div> <h3 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h3> <h4 id=print-all-known-variables>Print all known variables<a class=headerlink href=#print-all-known-variables title="Permanent link">&para;</a></h4> <p>Print the special variable <code>vars</code> as a task:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Debug all variables</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">var=vars</span><span class=w></span>
</code></pre></div> <h4 id=force-notified-handlers-to-run-at-a-specific-point>Force notified handlers to run at a specific point<a class=headerlink href=#force-notified-handlers-to-run-at-a-specific-point title="Permanent link">&para;</a></h4> <p>Use the <code>meta</code> plugin with the <code>flush_handlers</code> option:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Force all notified handlers to run at this point, not waiting for normal sync points</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.meta</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">flush_handlers</span><span class=w></span>
</code></pre></div> <h4 id=run-specific-tasks-even-in-check-mode>Run specific tasks even in check mode<a class=headerlink href=#run-specific-tasks-even-in-check-mode title="Permanent link">&para;</a></h4> <p>Add the <code>check_mode: false</code> pair to the task:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">this task will make changes to the system even in check mode</span><span class=w></span>
<span class=w>  </span><span class=nt>check_mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/something/to/run --even-in-check-mode</span><span class=w></span>
</code></pre></div> <h4 id=dry-run-only-specific-tasks>Dry-run only specific tasks<a class=headerlink href=#dry-run-only-specific-tasks title="Permanent link">&para;</a></h4> <p>Add the <code>check_mode: true</code> pair to the task:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">This task will always run under checkmode and not change the system</span><span class=w></span>
<span class=w>  </span><span class=nt>check_mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.lineinfile</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>line</span><span class=p>:</span><span class=w> </span><span class=s>&quot;important</span><span class=nv> </span><span class=s>file&quot;</span><span class=w></span>
<span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/file.conf</span><span class=w></span>
<span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">present</span><span class=w></span>
</code></pre></div> <h4 id=set-up-recursive-permissions-on-a-directory-so-that-directories-are-set-to-755-and-files-to-644>Set up recursive permissions on a directory so that directories are set to 755 and files to 644<a class=headerlink href=#set-up-recursive-permissions-on-a-directory-so-that-directories-are-set-to-755-and-files-to-644 title="Permanent link">&para;</a></h4> <p>Use the special <code>X</code> mode setting in the <code>file</code> plugin:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Fix files and directories&#39; permissions</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.file</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>dest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/some/dir</span><span class=w></span>
<span class=w>    </span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">u=rwX,g=rX,o=rX</span><span class=w></span>
<span class=w>    </span><span class=nt>recurse</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">yes</span><span class=w></span>
</code></pre></div> <h4 id=only-run-a-task-when-another-has-a-specific-result>Only run a task when another has a specific result<a class=headerlink href=#only-run-a-task-when-another-has-a-specific-result title="Permanent link">&para;</a></h4> <p>When a task executes, it also stores the two special values <code>changed</code> and <code>failed</code> in its results. You can use those as conditions to execute the next ones:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Trigger task</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">any</span><span class=w></span>
<span class=w>  </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trigger_task</span><span class=w></span>
<span class=w>  </span><span class=nt>ignore_errors</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run only on change</span><span class=w></span>
<span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trigger_task.changed</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;The trigger task changed&quot;</span><span class=w></span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run only on failure</span><span class=w></span>
<span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trigger_task.failed</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;The trigger task failed&quot;</span><span class=w></span>
</code></pre></div> <p>Alternatively, you can use special checks built for this:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run only on success</span><span class=w></span>
<span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trigger_task is succeeded</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;The trigger task succeeded&quot;</span><span class=w></span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run only on change</span><span class=w></span>
<span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trigger_task is changed</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;The trigger task changed&quot;</span><span class=w></span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run only on failure</span><span class=w></span>
<span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trigger_task is failed</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;The trigger task failed&quot;</span><span class=w></span>

<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Run only on skip</span><span class=w></span>
<span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trigger_task is skipped</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;The trigger task skipped&quot;</span><span class=w></span>
</code></pre></div> <h4 id=define-when-a-task-changed-or-failed>Define when a task changed or failed<a class=headerlink href=#define-when-a-task-changed-or-failed title="Permanent link">&para;</a></h4> <p>This lets you avoid using <code>ignore_errors</code>.</p> <p>Use the <code>changed_when</code> and <code>failed_when</code> attributes to define your own conditions:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Task with custom results</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">any</span><span class=w></span>
<span class=w>  </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">result</span><span class=w></span>
<span class=w>  </span><span class=nt>changed_when</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">result.rc == 2</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">result.stderr | regex_search(&#39;things changed&#39;)</span><span class=w></span>
<span class=w>  </span><span class=nt>failed_when</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">result.rc != 0</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">not (result.stderr | regex_search(&#39;all good&#39;))</span><span class=w></span>
</code></pre></div> <h4 id=set-environment-variables-for-a-play-role-or-task>Set environment variables for a play, role or task<a class=headerlink href=#set-environment-variables-for-a-play-role-or-task title="Permanent link">&para;</a></h4> <p>Environment variables can be set at a play, block, or task level using the <code>environment</code> keyword:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Use environment variables for a task</span><span class=w></span>
<span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>HTTP_PROXY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://example.proxy</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">curl ifconfig.io</span><span class=w></span>
</code></pre></div> <p>The <code>environment</code> keyword does not affect Ansible itself or its configuration settings, the environment for other users, or the execution of other plugins like lookups and filters; variables set with <code>environment</code> do not automatically become Ansible facts, even when set at the play level.</p> <h4 id=set-variables-to-the-value-of-environment-variables>Set variables to the value of environment variables<a class=headerlink href=#set-variables-to-the-value-of-environment-variables title="Permanent link">&para;</a></h4> <p>Use the <code>lookup()</code> plugin with the <code>env</code> option:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Use a local environment variable</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;HOME={{ lookup(&#39;env&#39;, &#39;HOME&#39;) }}&quot;</span><span class=w></span>
</code></pre></div> <h4 id=check-if-a-list-contains-an-item-and-fail-otherwise>Check if a list contains an item and fail otherwise<a class=headerlink href=#check-if-a-list-contains-an-item-and-fail-otherwise title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Check if a list contains an item and fail otherwise</span><span class=w></span>
<span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">item not in list</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible.builtin.fail</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">msg=&quot;item not in list&quot;</span><span class=w></span>
</code></pre></div> <h4 id=define-different-values-for-truefalsenull>Define different values for <code>true</code>/<code>false</code>/<code>null</code><a class=headerlink href=#define-different-values-for-truefalsenull title="Permanent link">&para;</a></h4> <p>Create a test and define two values: the first will be returned when the test returns <code>true</code>, the second will be returned when the test returns <code>false</code> (Ansible 1.9+):</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>(ansible_pkg_mgr == &#39;zypper&#39;) | ternary(&#39;gnu_parallel&#39;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&#39;parallel&#39;</span><span class=nv>))</span><span class=w> </span><span class="p p-Indicator">}}</span><span class=w></span>
</code></pre></div> <p>Since Ansible 2.8 you can define a third value to be returned when the test returns <code>null</code>:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">{{</span><span class=w> </span><span class=nv>autoscaling_enabled | ternary(true</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>false</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>omit)</span><span class=w> </span><span class="p p-Indicator">}}</span><span class=w></span>
</code></pre></div> <h4 id=force-a-task-or-play-to-use-a-specific-python-interpreter>Force a task or play to use a specific Python interpreter<a class=headerlink href=#force-a-task-or-play-to-use-a-specific-python-interpreter title="Permanent link">&para;</a></h4> <p>Just set it in the Play's or Task's variables:</p> <div class=highlight><pre><span></span><code><span class=nt>vars</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>ansible_python_interpreter</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/usr/local/bin/python3.9</span><span class=w></span>
</code></pre></div> <h3 id=further-readings>Further readings<a class=headerlink href=#further-readings title="Permanent link">&para;</a></h3> <ul> <li><a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_templating.html>Templating</a></li> <li><a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html>Roles</a></li> <li><a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html>Tests</a></li> <li><a href=https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html>Special variables</a></li> <li><a href=https://www.ansible.com/blog/automating-helm-using-ansible>Automating Helm using Ansible</a></li> <li><a href=https://syslint.com/blog/tutorial/edit-ini-file-in-other-servers-using-ansible-playbook/ >Edit .ini file in other servers using Ansible PlayBook</a></li> <li><a href=https://chronicler.tech/red-hat-ansible-yes-no-and/ >Yes and No, True and False</a></li> <li><a href=https://docs.ansible.com/ansible/latest/galaxy/user_guide.html>Ansible Galaxy user guide</a></li> <li><a href=https://geekflare.com/ansible-playbook-windows-example/ >Windows playbook example</a></li> </ul> <h3 id=sources>Sources<a class=headerlink href=#sources title="Permanent link">&para;</a></h3> <ul> <li><a href=https://stackoverflow.com/questions/60525961/ansible-removing-empty-values-from-a-list-and-assigning-it-to-a-new-list#60526774>Removing empty values from a list and assigning it to a new list</a></li> <li><a href=https://www.shellhacks.com/ansible-human-readable-output-format/ >Human-Readable Output Format</a></li> <li><a href=https://blog.crisp.se/2016/10/20/maxwenzin/how-to-append-to-lists-in-ansible>How to append to lists</a></li> <li><a href=https://stackoverflow.com/questions/28080145/check-if-a-list-contains-an-item-in-ansible/28084746>Check if a list contains an item in ansible</a></li> <li><a href=https://docs.ansible.com/ansible/latest/collections/community/general/docsite/filter_guide_working_with_versions.html>Working with versions</a></li> <li><a href=https://stackoverflow.com/questions/32255660/how-to-install-sshpass-on-mac/62623099#62623099>How to install SSHpass on Mac</a></li> <li><a href=https://stackoverflow.com/questions/28119521/ansible-include-task-only-if-file-exists#comment118578470_62289639>Include task only if file exists</a></li> <li><a href=https://stackoverflow.com/questions/44329598/unique-filter-of-list-in-jinja2>Unique filter of list in jinja2</a></li> <li><a href=https://raymii.org/s/tutorials/Ansible_-_Only-do-something-if-another-action-changed.html>Only do something if another action changed</a></li> <li><a href=https://superuser.com/questions/1024677/ansible-how-to-recursively-set-directory-and-file-permissions#1317715>How to recursively set directory and file permissions</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2022 - Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.fb4a9340.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>