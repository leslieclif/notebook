<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/learning/tools/gpg/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.1, mkdocs-material-7.0.3"><title>GnuPG - Leslie's Online Notebook</title><link rel=stylesheet href=../../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#gnupg class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> GnuPG </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/ class=md-nav__link> Devops </a> </li> <li class=md-nav__item> <a href=../../../devops/ci/ class=md-nav__link> CI </a> </li> <li class=md-nav__item> <a href=../../../devops/cd/ class=md-nav__link> CD </a> </li> <li class=md-nav__item> <a href=../../../devops/iac/ class=md-nav__link> IAC </a> </li> <li class=md-nav__item> <a href=../../../devops/gitops/ class=md-nav__link> GitOps </a> </li> <li class=md-nav__item> <a href=../../../devops/devops-engineer/ class=md-nav__link> Skills </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ansible/ansible/ class=md-nav__link> Ansible </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../../docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../linux/linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../linux/security/ class=md-nav__link> Linux_Security </a> </li> <li class=md-nav__item> <a href=../../linux/firewall/ class=md-nav__link> Linux_Firewall </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#gnupg class=md-nav__link> GnuPG </a> <nav class=md-nav aria-label=GnuPG> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tldr class=md-nav__link> TL;DR </a> </li> <li class=md-nav__item> <a href=#encryption class=md-nav__link> Encryption </a> </li> <li class=md-nav__item> <a href=#decryption class=md-nav__link> Decryption </a> </li> <li class=md-nav__item> <a href=#key-export class=md-nav__link> Key export </a> </li> <li class=md-nav__item> <a href=#key-import class=md-nav__link> Key import </a> </li> <li class=md-nav__item> <a href=#key-trust class=md-nav__link> Key trust </a> </li> <li class=md-nav__item> <a href=#unattended-key-generation class=md-nav__link> Unattended key generation </a> </li> <li class=md-nav__item> <a href=#change-a-keys-password class=md-nav__link> Change a key's password </a> </li> <li class=md-nav__item> <a href=#put-comments-in-a-message-or-file class=md-nav__link> Put comments in a message or file </a> </li> <li class=md-nav__item> <a href=#use-a-gpg-key-for-ssh-authentication class=md-nav__link> Use a GPG key for SSH authentication </a> <nav class=md-nav aria-label="Use a GPG key for SSH authentication"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-an-authentication-subkey class=md-nav__link> Create an authentication subkey </a> </li> <li class=md-nav__item> <a href=#enable-ssh-to-use-the-gpg-subkey class=md-nav__link> Enable SSH to use the GPG subkey </a> </li> <li class=md-nav__item> <a href=#share-the-gpg-ssh-key class=md-nav__link> Share the GPG-SSH key </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gpg-failed-to-sign-the-data-fatal-failed-to-write-commit-object class=md-nav__link> gpg failed to sign the data; fatal: failed to write commit object </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sources class=md-nav__link> Sources </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>GnuPG</h1> <h2 id=gnupg>GnuPG<a class=headerlink href=#gnupg title="Permanent link">&para;</a></h2> <h3 id=tldr>TL;DR<a class=headerlink href=#tldr title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># List existing keys.</span>
gpg --list-keys
gpg --list-keys --keyid-format <span class=s1>&#39;short&#39;</span>
gpg --list-secret-keys --with-keygrip

<span class=c1># Generate a new key.</span>
gpg --gen-key
gpg --generate-key
gpg --full-generate-key
gpg --expert --full-generate-key

<span class=c1># Generate a new key unattended.</span>
<span class=c1># The non-interactive (--batch) option requires a settings file.</span>
gpg --generate-key --batch setting.txt
gpg --generate-key --batch <span class=s>&lt;&lt;-EOF</span>
<span class=s>	…</span>
<span class=s>EOF</span>

<span class=c1># Delete a key from the keyring.</span>
<span class=c1># The non-interactive (--batch) option requires the key fingerprint.</span>
gpg --delete-secret-key <span class=s1>&#39;recipient&#39;</span>
gpg --delete-key <span class=s1>&#39;recipient&#39;</span>
gpg --delete-keys --batch <span class=s1>&#39;key_fingerprint&#39;</span>

<span class=c1># Get a key&#39;s fingerprint information.</span>
gpg --fingerprint
gpg --fingerprint <span class=s1>&#39;recipient&#39;</span>

<span class=c1># Encrypt files.</span>
gpg -e -o <span class=s1>&#39;file.out.gpg&#39;</span> -r <span class=s1>&#39;recipient&#39;</span> <span class=s1>&#39;file.in&#39;</span>
gpg --encrypt -o <span class=s1>&#39;file.out.gpg&#39;</span> -u <span class=s1>&#39;sender&#39;</span> -r <span class=s1>&#39;recipient&#39;</span> <span class=s1>&#39;file.in&#39;</span>
gpg --encrypt-files --batch -r <span class=s1>&#39;recipient&#39;</span> <span class=s1>&#39;file.in.1&#39;</span> <span class=s1>&#39;file.in.N&#39;</span>
gpg -e --multifile --batch -r <span class=s1>&#39;recipient&#39;</span> --yes <span class=s1>&#39;file.in.1&#39;</span> <span class=s1>&#39;file.in.N&#39;</span>

<span class=c1># Decrypt files.</span>
gpg -d -o <span class=s1>&#39;file.out&#39;</span> <span class=s1>&#39;file.in.gpg&#39;</span>
gpg --decrypt-files --batch <span class=s1>&#39;file.in.gpg.1&#39;</span> <span class=s1>&#39;file.in.gpg.N&#39;</span>
gpg -d --multifile --batch --yes <span class=s1>&#39;file.in.gpg.1&#39;</span> <span class=s1>&#39;file.in.gpg.N&#39;</span>

<span class=c1># Import keys from a file.</span>
gpg --import <span class=s1>&#39;keys.asc&#39;</span>

<span class=c1># Export keys to a file.</span>
gpg --armor --export &gt; <span class=s1>&#39;all.public-keys.asc&#39;</span>
gpg --armor --export recipient &gt; <span class=s1>&#39;recipient.public-keys.asc&#39;</span>
gpg --armor --export-secret-keys &gt; <span class=s1>&#39;all.private-keys.asc&#39;</span>
gpg --armor --export-secret-keys recipient &gt; <span class=s1>&#39;recipient.private-keys.asc&#39;</span>

<span class=c1># Generate a revoke certificate.</span>
gpg --gen-revoke

<span class=c1># Get the short ID of the signing key only for a user.</span>
<span class=c1># Primarily usable for git&#39;s signingKey configuration.</span>
gpg --list-keys --keyid-format <span class=s1>&#39;short&#39;</span> <span class=s1>&#39;recipient&#39;</span> <span class=se>\</span>
  <span class=p>|</span> grep --extended-regexp <span class=s1>&#39;^pub[[:blank:]]+[[:alnum:]]+/[[:alnum:]]+[[:blank:]].*\[[[:upper:]]*S[[:upper:]]*\]&#39;</span> <span class=se>\</span>
  <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span> <span class=se>\</span>
  <span class=p>|</span> cut -d <span class=s1>&#39;/&#39;</span> -f <span class=m>2</span>

<span class=c1># Install on Mac OS X.</span>
<span class=c1># Choose one.</span>
brew install --cask <span class=s1>&#39;gpg-suite-no-mail&#39;</span>
brew install <span class=s1>&#39;gnupg&#39;</span>
</code></pre></div> <h3 id=encryption>Encryption<a class=headerlink href=#encryption title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Single file.</span>
gpg --output <span class=s1>&#39;file.out.gpg&#39;</span> --encrypt --recipient <span class=s1>&#39;recipient&#39;</span> <span class=s1>&#39;file.in&#39;</span>
gpg --armor --symmetric --output <span class=s1>&#39;file.out.gpg&#39;</span> <span class=s1>&#39;file.in&#39;</span>

<span class=c1># All files found.</span>
find . -type <span class=s1>&#39;f&#39;</span> -name <span class=s1>&#39;secret.txt&#39;</span> <span class=se>\</span>
  -exec gpg --batch --yes --encrypt-files --recipient <span class=s1>&#39;recipient&#39;</span> <span class=o>{}</span> <span class=s1>&#39;;&#39;</span>
</code></pre></div> <h3 id=decryption>Decryption<a class=headerlink href=#decryption title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Single file.</span>
gpg --output <span class=s1>&#39;file.out&#39;</span> --decrypt <span class=s1>&#39;file.in.gpg&#39;</span>

<span class=c1># All files found.</span>
find . -type f -name <span class=s2>&quot;*.gpg&quot;</span> -exec gpg --decrypt-files <span class=o>{}</span> +
</code></pre></div> <p>The second command will create the decrypted version of all files in the same directory. Each file will have the same name of the encrypted version, minus the <code>.gpg</code> extension.</p> <h3 id=key-export>Key export<a class=headerlink href=#key-export title="Permanent link">&para;</a></h3> <p>As the original user, export all public keys to a base64-encoded text file and create an encrypted version of that file:</p> <div class=highlight><pre><span></span><code><span class=c1># Export.</span>
gpg --armor --export &gt; <span class=s1>&#39;all.public-keys.asc&#39;</span>
gpg --armor --export <span class=s1>&#39;recipient&#39;</span> &gt; <span class=s1>&#39;recipient.public-keys.asc&#39;</span>

<span class=c1># Encryption.</span>
gpg --output <span class=s1>&#39;file.out.gpg&#39;</span> --encrypt --recipient <span class=s1>&#39;recipient&#39;</span> <span class=s1>&#39;file.in&#39;</span>
gpg --armor --symmetric --output <span class=s1>&#39;file.out.gpg&#39;</span> <span class=s1>&#39;file.in&#39;</span>
</code></pre></div> <p>Export all encrypted private keys (which will also include corresponding public keys) to a text file and create an encrypted version of that file:</p> <div class=highlight><pre><span></span><code><span class=c1># Export.</span>
gpg --armor --export-secret-keys &gt; <span class=s1>&#39;all.private-keys.asc&#39;</span>
gpg --armor --export-secret-keys <span class=s1>&#39;recipient&#39;</span> &gt; <span class=s1>&#39;recipient.private-keys.asc&#39;</span>

<span class=c1># Encryption.</span>
gpg --output <span class=s1>&#39;file.out.gpg&#39;</span> --encrypt --recipient <span class=s1>&#39;recipient&#39;</span> <span class=s1>&#39;file.in&#39;</span>
gpg --armor --symmetric --output <span class=s1>&#39;file.out.gpg&#39;</span> <span class=s1>&#39;file.in&#39;</span>
</code></pre></div> <p>Optionally, also export <code>gpg</code>'s trustdb to a text file:</p> <div class=highlight><pre><span></span><code>gpg --export-ownertrust &gt; <span class=s1>&#39;otrust.txt&#39;</span>
</code></pre></div> <h3 id=key-import>Key import<a class=headerlink href=#key-import title="Permanent link">&para;</a></h3> <p>As the new user execute <code>gpg --import</code> commands against the secured files, or the decrypted content of those files, and then check for the new keys with <code>gpg -k</code> and <code>gpg -K</code>, e.g.:</p> <div class=highlight><pre><span></span><code>gpg --output <span class=s1>&#39;myprivatekeys.asc&#39;</span> --decrypt <span class=s1>&#39;mysecretatedprivatekeys.sec.asc&#39;</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
gpg --import <span class=s1>&#39;myprivatekeys.asc&#39;</span>
gpg --output <span class=s1>&#39;mypubkeys.asc&#39;</span> --decrypt <span class=s1>&#39;mysecretatedpubkeys.sec.asc&#39;</span>
gpg --import <span class=s1>&#39;mypubkeys.asc&#39;</span>
gpg --list-secret-keys
gpg --list-keys
</code></pre></div> <p>Optionally import the trustdb file as well:</p> <div class=highlight><pre><span></span><code>gpg --import-ownertrust <span class=s1>&#39;otrust.txt&#39;</span>
</code></pre></div> <h3 id=key-trust>Key trust<a class=headerlink href=#key-trust title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>$ gpg --edit-key <span class=s1>&#39;key_fingerprint&#39;</span>
gpg&gt; trust
gpg&gt; quit
</code></pre></div> <h3 id=unattended-key-generation>Unattended key generation<a class=headerlink href=#unattended-key-generation title="Permanent link">&para;</a></h3> <blockquote> <p>The non-interactive (&ndash;batch) option requires a settings file.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1># basic key with default values</span>
gpg --batch --generate-key <span class=s>&lt;&lt;EOF</span>
<span class=s>    %echo Generating a default key</span>
<span class=s>    Key-Type: default</span>
<span class=s>    Subkey-Type: default</span>
<span class=s>    Name-Real: Joe Tester</span>
<span class=s>    Name-Comment: with stupid passphrase</span>
<span class=s>    Name-Email: joe@foo.bar</span>
<span class=s>    Expire-Date: 0</span>
<span class=s>    Passphrase: abc</span>
<span class=s>    # Do a commit here, so that we can later print &quot;done&quot; :-)</span>
<span class=s>    %commit</span>
<span class=s>    %echo done</span>
<span class=s>EOF</span>
</code></pre></div> <h3 id=change-a-keys-password>Change a key's password<a class=headerlink href=#change-a-keys-password title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>$ gpg --edit-key <span class=s1>&#39;key_fingerprint&#39;</span>
gpg&gt; passwd
gpg&gt; quit
</code></pre></div> <h3 id=put-comments-in-a-message-or-file>Put comments in a message or file<a class=headerlink href=#put-comments-in-a-message-or-file title="Permanent link">&para;</a></h3> <p>One can put comments in an armored ASCII message or key block using the <code>Comment</code> keyword for each line:</p> <div class=highlight><pre><span></span><code>-----BEGIN PGP MESSAGE-----
Comment: …
Comment: …

hQIMAwbYc…
-----END PGP MESSAGE-----
</code></pre></div> <p>OpenPGP defines all text to be in UTF-8, so a comment may be any UTF-8 string.<br> The whole point of armoring, however, is to provide seven-bit-clean data, so if a comment has characters that are outside the US-ASCII range of UTF they may very well not survive transport.</p> <h3 id=use-a-gpg-key-for-ssh-authentication>Use a GPG key for SSH authentication<a class=headerlink href=#use-a-gpg-key-for-ssh-authentication title="Permanent link">&para;</a></h3> <blockquote> <p>Shamelessly copied over from <a href=https://opensource.com/article/19/4/gpg-subkeys-ssh>How to enable SSH access using a GPG key for authentication</a>.</p> </blockquote> <p>This exercise will use a GPG subkey with only the authentication capability enabled to complete SSH connections.<br> You can create multiple subkeys as you would do for SSH keypairs.</p> <h4 id=create-an-authentication-subkey>Create an authentication subkey<a class=headerlink href=#create-an-authentication-subkey title="Permanent link">&para;</a></h4> <p>You should already have a GPG key. If you don't, read one of the many fine tutorials available on this topic.<br> You will create the subkey by editing your existing key <strong>in expert mode</strong> to get access to the appropriate options:</p> <div class=highlight><pre><span></span><code>$ gpg2 --expert --edit-key <span class=s1>&#39;key_fingerprint&#39;</span>
gpg&gt; addkey
Please <span class=k>select</span> what kind of key you want:
   <span class=o>(</span><span class=m>3</span><span class=o>)</span> DSA <span class=o>(</span>sign only<span class=o>)</span>
   <span class=o>(</span><span class=m>4</span><span class=o>)</span> RSA <span class=o>(</span>sign only<span class=o>)</span>
   <span class=o>(</span><span class=m>5</span><span class=o>)</span> Elgamal <span class=o>(</span>encrypt only<span class=o>)</span>
   <span class=o>(</span><span class=m>6</span><span class=o>)</span> RSA <span class=o>(</span>encrypt only<span class=o>)</span>
   <span class=o>(</span><span class=m>7</span><span class=o>)</span> DSA <span class=o>(</span><span class=nb>set</span> your own capabilities<span class=o>)</span>
   <span class=o>(</span><span class=m>8</span><span class=o>)</span> RSA <span class=o>(</span><span class=nb>set</span> your own capabilities<span class=o>)</span>
  <span class=o>(</span><span class=m>10</span><span class=o>)</span> ECC <span class=o>(</span>sign only<span class=o>)</span>
  <span class=o>(</span><span class=m>11</span><span class=o>)</span> ECC <span class=o>(</span><span class=nb>set</span> your own capabilities<span class=o>)</span>
  <span class=o>(</span><span class=m>12</span><span class=o>)</span> ECC <span class=o>(</span>encrypt only<span class=o>)</span>
  <span class=o>(</span><span class=m>13</span><span class=o>)</span> Existing key
Your selection? <span class=m>8</span>

Possible actions <span class=k>for</span> a RSA key: Sign Encrypt Authenticate
Current allowed actions: Sign Encrypt

   <span class=o>(</span>S<span class=o>)</span> Toggle the sign capability
   <span class=o>(</span>E<span class=o>)</span> Toggle the encrypt capability
   <span class=o>(</span>A<span class=o>)</span> Toggle the authenticate capability
   <span class=o>(</span>Q<span class=o>)</span> Finished

Your selection? s
Your selection? e
Your selection? a

Possible actions <span class=k>for</span> a RSA key: Sign Encrypt Authenticate
Current allowed actions: Authenticate

   <span class=o>(</span>S<span class=o>)</span> Toggle the sign capability
   <span class=o>(</span>E<span class=o>)</span> Toggle the encrypt capability
   <span class=o>(</span>A<span class=o>)</span> Toggle the authenticate capability
   <span class=o>(</span>Q<span class=o>)</span> Finished

Your selection? q
RSA keys may be between <span class=m>1024</span> and <span class=m>4096</span> bits long.
What keysize <span class=k>do</span> you want? <span class=o>(</span><span class=m>4096</span><span class=o>)</span>
Requested keysize is <span class=m>4096</span> bits
Please specify how long the key should be valid.
         <span class=nv>0</span> <span class=o>=</span> key does not expire
      &lt;n&gt;  <span class=o>=</span> key expires <span class=k>in</span> n days
      &lt;n&gt;w <span class=o>=</span> key expires <span class=k>in</span> n weeks
      &lt;n&gt;m <span class=o>=</span> key expires <span class=k>in</span> n months
      &lt;n&gt;y <span class=o>=</span> key expires <span class=k>in</span> n years
Key is valid <span class=k>for</span>? <span class=o>(</span><span class=m>0</span><span class=o>)</span>
Key does not expire at all
Is this correct? <span class=o>(</span>y/N<span class=o>)</span> y
Really create? <span class=o>(</span>y/N<span class=o>)</span> y

sec  rsa2048/8715AF32191DB135
     created: <span class=m>2019</span>-03-21  expires: <span class=m>2021</span>-03-20  usage: SC  
     trust: ultimate      validity: ultimate
ssb  rsa2048/150F16909B9AA603
     created: <span class=m>2019</span>-03-21  expires: <span class=m>2021</span>-03-20  usage: E  
ssb  rsa2048/17E7403F18CB1123
     created: <span class=m>2019</span>-03-21  expires: never       usage: A  
<span class=o>[</span>ultimate<span class=o>]</span> <span class=o>(</span><span class=m>1</span><span class=o>)</span>. Brian Exelbierd

gpg&gt; quit
Save changes? <span class=o>(</span>y/N<span class=o>)</span> y
</code></pre></div> <h4 id=enable-ssh-to-use-the-gpg-subkey>Enable SSH to use the GPG subkey<a class=headerlink href=#enable-ssh-to-use-the-gpg-subkey title="Permanent link">&para;</a></h4> <p>When using SSH, <code>ssh-agent</code> is used to manage SSH keys. When using a GPG key, <code>gpg-agent</code> is used to manage GPG keys.<br> To get <code>gpg-agent</code> to handle requests from SSH, you need to enable its SSH support:</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=s2>&quot;enable-ssh-support&quot;</span> &gt;&gt; ~/.gnupg/gpg-agent.conf
</code></pre></div> <p>You can avoid usinig <code>ssh-add</code> to load the keys pre-specifying which GPG keys to use in the <code>~/.gnupg/sshcontrol</code> file.<br> The entries in this file are keygrips—internal identifiers that <code>gpg-agent</code> uses to refer to the keys. A keygrip refers to both the public and private key.<br> To find the keygrip use <code>gpg -K --with-keygrip</code>, then add that line to the <code>~/.gnupg/sshcontrol</code> file:</p> <div class=highlight><pre><span></span><code>$ gpg2 -K --with-keygrip
/home/bexelbie/.gnupg/pubring.kbx
------------------------------
sec   rsa2048 <span class=m>2019</span>-03-21 <span class=o>[</span>SC<span class=o>]</span> <span class=o>[</span>expires: <span class=m>2021</span>-03-20<span class=o>]</span>
      96F33EA7F4E0F7051D75FC208715AF32191DB135
      <span class=nv>Keygrip</span> <span class=o>=</span> 90E08830BC1AAD225E657AD4FBE638B3D8E50C9E
uid           <span class=o>[</span>ultimate<span class=o>]</span> Brian Exelbierd
ssb   rsa2048 <span class=m>2019</span>-03-21 <span class=o>[</span>E<span class=o>]</span> <span class=o>[</span>expires: <span class=m>2021</span>-03-20<span class=o>]</span>
      <span class=nv>Keygrip</span> <span class=o>=</span> 5FA04ABEBFBC5089E50EDEB43198B4895BCA2136
ssb   rsa2048 <span class=m>2019</span>-03-21 <span class=o>[</span>A<span class=o>]</span>
      <span class=nv>Keygrip</span> <span class=o>=</span> 7710BA0643CC022B92544181FF2EAC2A290CDC0E

$ <span class=nb>echo</span> 7710BA0643CC022B92544181FF2EAC2A290CDC0E &gt;&gt; ~/.gnupg/sshcontrol
</code></pre></div> <p>Now tell SSH how to access <code>gpg-agent</code> by setting the value of the <code>SSH_AUTH_SOCK</code> environment variable.</p> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>SSH_AUTH_SOCK</span><span class=o>=</span><span class=k>$(</span>gpgconf --list-dirs agent-ssh-socket<span class=k>)</span>
gpgconf --launch gpg-agent
</code></pre></div> <h4 id=share-the-gpg-ssh-key>Share the GPG-SSH key<a class=headerlink href=#share-the-gpg-ssh-key title="Permanent link">&para;</a></h4> <p>Run <code>ssh-add -L</code> to list your public keys and copy them over manually to the remote host, or use <code>ssh-copy-id</code> as you would normally do.</p> <h3 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h3> <h4 id=gpg-failed-to-sign-the-data-fatal-failed-to-write-commit-object><code>gpg failed to sign the data; fatal: failed to write commit object</code><a class=headerlink href=#gpg-failed-to-sign-the-data-fatal-failed-to-write-commit-object title="Permanent link">&para;</a></h4> <p><strong>Problem:</strong></p> <ul> <li><code>git</code> is instructed to sign a commit with <code>gpg</code></li> <li><code>git commit</code> fails with the following error:</li> </ul> <blockquote> <div class=highlight><pre><span></span><code>gpg failed to sign the data
fatal: failed to write commit object
</code></pre></div> </blockquote> <p><strong>Solution:</strong> if <code>gnupg2</code> and <code>gpg-agent</code> 2.x are used, be sure to set the environment variable <code>GPG_TTY</code>:</p> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>GPG_TTY</span><span class=o>=</span><span class=k>$(</span>tty<span class=k>)</span>
</code></pre></div> <h3 id=sources>Sources<a class=headerlink href=#sources title="Permanent link">&para;</a></h3> <ul> <li><a href=https://stackoverflow.com/questions/18769290/decrypt-multiple-openpgp-files-in-a-directory/42431810#42431810>Decrypt multiple openpgp files in a directory</a></li> <li><a href=https://access.redhat.com/solutions/2115511>ask redhat</a></li> <li><a href=https://unix.stackexchange.com/a/550538>how can i remove the passphrase from a gpg2 private key?</a></li> <li><a href=https://www.gnupg.org/documentation/manuals/gnupg/Unattended-GPG-key-generation.html>Unattended key generation</a></li> <li><a href=https://opensource.com/article/19/4/gpg-subkeys-ssh>How to enable SSH access using a GPG key for authentication</a></li> <li><a href=https://stackoverflow.com/questions/39494631/gpg-failed-to-sign-the-data-fatal-failed-to-write-commit-object-git-2-10-0#42265848>gpg failed to sign the data fatal: failed to write commit object</a></li> <li><a href=https://stackoverflow.com/questions/58696139/can-you-manually-add-a-comment-to-a-pgp-public-key-block-and-not-break-it#58696634>Can you manually add a comment to a PGP public key block and not break it?</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2022 - Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.fb4a9340.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>