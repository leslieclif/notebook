<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/learning/linux/volumes/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.0.3"><title>Why use LVM? - Leslie's Online Notebook</title><link rel=stylesheet href=../../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#why-use-lvm class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Why use LVM? </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../devops/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../../devops/ci/ class=md-nav__link> CI </a> </li> <li class=md-nav__item> <a href=../../../devops/cd/ class=md-nav__link> CD </a> </li> <li class=md-nav__item> <a href=../../../devops/iac/ class=md-nav__link> IAC </a> </li> <li class=md-nav__item> <a href=../../../devops/gitops/ class=md-nav__link> GitOps </a> </li> <li class=md-nav__item> <a href=../../../devops/devops-engineer/ class=md-nav__link> Skills </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ansible/ansible/ class=md-nav__link> Ansible </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../../k8s/install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../../terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../../docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../security/ class=md-nav__link> Linux_Security </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#why-use-lvm class=md-nav__link> Why use LVM? </a> <nav class=md-nav aria-label="Why use LVM?"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#flexible-capacity class=md-nav__link> Flexible Capacity </a> </li> <li class=md-nav__item> <a href=#easily-resize-storage-while-online class=md-nav__link> Easily Resize Storage While Online </a> </li> <li class=md-nav__item> <a href=#online-data-relocation class=md-nav__link> Online Data Relocation </a> </li> <li class=md-nav__item> <a href=#convenient-device-naming class=md-nav__link> Convenient Device Naming </a> </li> <li class=md-nav__item> <a href=#disk-striping class=md-nav__link> Disk Striping </a> </li> <li class=md-nav__item> <a href=#data-redundancy--data-mirroring class=md-nav__link> Data Redundancy / Data Mirroring </a> </li> <li class=md-nav__item> <a href=#snapshots class=md-nav__link> Snapshots </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#layers-of-abstraction-in-lvm class=md-nav__link> Layers of Abstraction in LVM </a> </li> <li class=md-nav__item> <a href=#logical-volume-creation-process class=md-nav__link> Logical Volume Creation Process </a> <nav class=md-nav aria-label="Logical Volume Creation Process"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-physical-volumes class=md-nav__link> Creating Physical Volumes </a> </li> <li class=md-nav__item> <a href=#creating-volume-groups class=md-nav__link> Creating Volume Groups </a> </li> <li class=md-nav__item> <a href=#creating-logical-volumes class=md-nav__link> Creating Logical Volumes </a> </li> <li class=md-nav__item> <a href=#creating-file-systems class=md-nav__link> Creating File Systems </a> </li> <li class=md-nav__item> <a href=#creating-multiple-logical-volumes-in-volume-groups class=md-nav__link> Creating Multiple Logical Volumes in Volume Groups </a> </li> <li class=md-nav__item> <a href=#logical-extents-and-physical-extents class=md-nav__link> Logical Extents and Physical Extents </a> </li> <li class=md-nav__item> <a href=#create-logical-volumes-using-percentage class=md-nav__link> Create Logical Volumes using percentage </a> </li> <li class=md-nav__item> <a href=#extending-volume-groups class=md-nav__link> Extending Volume Groups </a> </li> <li class=md-nav__item> <a href=#extending-logical-volumes class=md-nav__link> Extending Logical Volumes </a> </li> <li class=md-nav__item> <a href=#creating-mirrored-logical-volumes class=md-nav__link> Creating Mirrored Logical Volumes </a> </li> <li class=md-nav__item> <a href=#deleting-logical-volumes-volume-groups-and-physical-volumes class=md-nav__link> Deleting Logical Volumes, Volume Groups, and Physical Volumes </a> </li> <li class=md-nav__item> <a href=#migrating-data-while-online class=md-nav__link> Migrating Data While Online </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Why use LVM?</h1> <h2 id=why-use-lvm>Why use LVM?<a class=headerlink href=#why-use-lvm title="Permanent link">&para;</a></h2> <h3 id=flexible-capacity>Flexible Capacity<a class=headerlink href=#flexible-capacity title="Permanent link">&para;</a></h3> <p>One benefit of using LVM is that you can create file systems that extend across multiple storage devices. With LVM, you can aggregate multiple storage devices into a single logical volume.</p> <h3 id=easily-resize-storage-while-online>Easily Resize Storage While Online<a class=headerlink href=#easily-resize-storage-while-online title="Permanent link">&para;</a></h3> <p>LVM allows you to expand or shrink filesystems in real-time while the data remains online and fully accessible. Without LVM you would have to reformat and repartition the underlying storage devices. Of course, you would have to take the file system offline to perform that work. LVM eliminates this problem.</p> <h3 id=online-data-relocation>Online Data Relocation<a class=headerlink href=#online-data-relocation title="Permanent link">&para;</a></h3> <p>LVM also allows you to easily migrate data from one storage device to another while online. For example, if you want to deploy newer, faster, or more resilient storage, you can move your existing data from the current storage devices to the new ones while your system is active.</p> <h3 id=convenient-device-naming>Convenient Device Naming<a class=headerlink href=#convenient-device-naming title="Permanent link">&para;</a></h3> <p>Instead of using abstract disk numbers, you can use human-readable device names of your choosing. Instead of wondering what data is on /dev/sdb, you can name your data with a descriptive name.</p> <h3 id=disk-striping>Disk Striping<a class=headerlink href=#disk-striping title="Permanent link">&para;</a></h3> <p>With LVM, you can stripe data across two or more disks. This can dramatically increase throughput by allowing your system to read data in parallel.</p> <h3 id=data-redundancy--data-mirroring>Data Redundancy / Data Mirroring<a class=headerlink href=#data-redundancy--data-mirroring title="Permanent link">&para;</a></h3> <p>If you want to increase fault tolerance and reliability, use LVM to mirror your data so that you always have more than one copy of your data. Using LVM mirroring prevents single points of failure. If one storage device fails, your data can be accessed via another storage device. You can then fix or replace the failed storage device to restore your mirror, without downtime.</p> <h3 id=snapshots>Snapshots<a class=headerlink href=#snapshots title="Permanent link">&para;</a></h3> <p>LVM gives you the ability to create point-in-time snapshots of your filesystems. This can be perfect for when you need consistent backups. For example, you could pause writes to a database, take a snapshot of the logical volume where the database data resides, then resume writes to the database. That way you ensure your data is in a known-good state when you perform the backup of the snapshot.</p> <h2 id=layers-of-abstraction-in-lvm>Layers of Abstraction in LVM<a class=headerlink href=#layers-of-abstraction-in-lvm title="Permanent link">&para;</a></h2> <ul> <li>The logical volume manager introduces extra layers of abstraction between the storage devices and the file systems placed on those storage devices.</li> <li>The first layer of abstraction is physical volumes. These are storage devices that are used by LVM. The name is a bit of a legacy name. To be clear, these storage devices do not have to be physical. They just have to be made available to the Linux operating system. In other words, as long as Linux sees the device as a block storage device, it can be used as a physical volume (PV). Physical hard drives, iSCSI devices, SAN disks, and so on can be PVs. You can allocate an entire storage device as a PV or you can partition a storage device and use just that one partition as a PV.</li> <li>The next layer of abstraction is the Volume Group. A volume group is made up of one or more PVs. You can think of a volume group as a pool of storage. If you want to increase the size of the pool, you simply add more PVs. Keep in mind that you can have different types of storage in the same volume group if you want. For example, you could have some PVs that are backed by hard drives and other PVs that are backed by san disks.</li> <li>The next layer of abstraction is the Logical Volume layer. Logical Volumes are created from a volume group. File systems are created on Logical Volumes. Without LVM you would create a file system on a disk partition, but with LVM you create a file system on a logical volume. As long as there is free space in the Volume Group, logical volumes can be extended. You can also shrink logical volumes to reclaim unused space if you want, but typically you'll find yourself extending logical volumes.</li> </ul> <h2 id=logical-volume-creation-process>Logical Volume Creation Process<a class=headerlink href=#logical-volume-creation-process title="Permanent link">&para;</a></h2> <p>At a high level, the process for creating a logical volume is this: 1. Create one or more physical volumes. 2. Create a volume group from those one or more physical volumes. 3. Finally, you can create one or more logical volumes from the volume group.</p> <h3 id=creating-physical-volumes>Creating Physical Volumes<a class=headerlink href=#creating-physical-volumes title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Verify which devices are used</span>
su -
lvmdiskscan                     <span class=c1># Shows all the storage devices that have the ability to be used with LVM.</span>
lsblk -p                        <span class=c1># Shows the partitions</span>
df -h                           <span class=c1># Display sizes in a human readable format.</span>
<span class=c1># Once verified which devices are not used</span>
<span class=c1># Create the physical volumes</span>
pvcreate /dev/sdb               <span class=c1># initializes the disk for use by the logical volume manager.</span>
pvs                             <span class=c1># list of pvs</span>
</code></pre></div> <h3 id=creating-volume-groups>Creating Volume Groups<a class=headerlink href=#creating-volume-groups title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>vgcreate vg_app /dev/sdb        <span class=c1># Volume group naming convention of &quot;vg_&quot;.</span>
vgs                             <span class=c1># view the volume groups</span>
<span class=c1># It shows that we have 1 physical volume.</span>
<span class=c1># The size of the volume group is 50GB and we have 50GB free in the volume group. </span>
<span class=c1># If we look at our pvs with the pvs command, we&#39;ll now see what VG our PV belongs to.</span>
</code></pre></div> <h3 id=creating-logical-volumes>Creating Logical Volumes<a class=headerlink href=#creating-logical-volumes title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>lvcreate -L 20G -n lv_data vg_app   <span class=c1># Logical Volume naming convention of &quot;lv_&quot;.</span>
<span class=c1># Note captial L is to give human readable volume size</span>
lvs                                 <span class=c1># view logical volumes</span>
lvdisplay                           <span class=c1># Also to view lv, but it provides different output. </span>
<span class=c1># For example, notice the LV Path: ​ /dev/vg_app/lv_data​ </span>
<span class=c1># It&#39;s easy to tell that the ​ lv_data​ logical volume belongs to the vg_app​ volume group.</span>
</code></pre></div> <h3 id=creating-file-systems>Creating File Systems<a class=headerlink href=#creating-file-systems title="Permanent link">&para;</a></h3> <ul> <li>Now that we have a logical volume, we can treat it like we would a normal disk partition. </li> <li>So, let's put a file system on our logical volume and mount it. <div class=highlight><pre><span></span><code>mkfs -t ext4 /dev/vg_app/lv_data
mkdir /data
mount /dev/vg_app/lv_data /data
df -h /data
</code></pre></div></li> </ul> <h3 id=creating-multiple-logical-volumes-in-volume-groups>Creating Multiple Logical Volumes in Volume Groups<a class=headerlink href=#creating-multiple-logical-volumes-in-volume-groups title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>lvcreate -L 5G -n lv_app vg_app
<span class=c1># Now you can see we have two logical volumes in vg_app</span>
lvs
<span class=c1># We can put a file system on this logical volume and mount it.</span>
mkfs -t ext4
/dev/vg_app/lv_app
mkdir /app
<span class=c1># Add Logical Volumes in the ​/etc/fstab​ so that it gets mounted at boot time.</span>
<span class=c1># vi /etc/fstab</span>
/dev/vg_app/lv_app /app ext4 defaults <span class=m>0</span> <span class=m>0</span>   <span class=c1># Save and quit</span>
mount /app
df -h /app
df -h   
<span class=c1># You also access your logical volume through the device mapper path as shown in the df output. </span>
<span class=c1># For example, ​ /dev/vg_app/lv_app​ can be accessed via ​ /dev/mapper/vg_app-lv_app​ .</span>
ls -l /dev/vg_app/lv_app
ls -l /dev/mapper/vg_app-lv_app
</code></pre></div> <h3 id=logical-extents-and-physical-extents>Logical Extents and Physical Extents<a class=headerlink href=#logical-extents-and-physical-extents title="Permanent link">&para;</a></h3> <p>There is yet another layer of abstraction that we haven't talked about. Well, two layers of abstraction, really. Each of our LVs is actually divided up into LEs, which stands for logical extents. Or if we look at it from the other direction, a collection of Logical Extents makes up a Logical Volume. This is how LVM allows us to expand or shrink a logical volume &ndash; the logical volume manager just changes the number of underlying Logical Extents for the logical volume. <div class=highlight><pre><span></span><code>lvdisplay -m            <span class=c1># Show a map of the logical volume.</span>
<span class=c1># This map view tells us that the logical extents for the ​lv_app​ LV resize on the ​/dev/sdb​ disk. </span>
<span class=c1># Like an LV is divided into LE, a PV is divided into PE, physical extents. </span>
<span class=c1># There is a one-to-one mapping of LEs to PEs.</span>
pvdisplay -m            <span class=c1># Shows a map from the view of the disk</span>
</code></pre></div></p> <h3 id=create-logical-volumes-using-percentage>Create Logical Volumes using percentage<a class=headerlink href=#create-logical-volumes-using-percentage title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>lvcreate -l <span class=m>100</span>%FREE -n lv_logs vg_app
<span class=c1># Note small l is used with % or passing free extents </span>
<span class=c1># We can squeeze every possible bit of space out of your volume group and put it into a logical volume.</span>
</code></pre></div> <h3 id=extending-volume-groups>Extending Volume Groups<a class=headerlink href=#extending-volume-groups title="Permanent link">&para;</a></h3> <ul> <li>Let's say that the ​lv_data​ logical volume is getting full and we need to extend it.</li> <li>If we look at our volume group, we'll see we've already allocated all our space to the existing logical volumes. <div class=highlight><pre><span></span><code>vgs                 <span class=c1># Output shows VFREE = 0</span>
<span class=c1># In this case, we need to extend the volume group itself </span>
<span class=c1># before we can extend the logical volume within that volume group.</span>
lvmdiskscan         <span class=c1># Shows sdc is free</span>
pvcreate /dev/sdc
vgextend vg_app /dev/sdc    <span class=c1># add this PV to our VG</span>
vgs                 <span class=c1># Output shows VFREE = 50G</span>
pvs                 <span class=c1># We have one pv that is complete full and one that is completely free.</span>
<span class=c1>#  Before we extend our logical volume into this free space, </span>
<span class=c1># let&#39;s look at the space from the file system level.</span>
df -h /data
</code></pre></div></li> </ul> <h3 id=extending-logical-volumes>Extending Logical Volumes<a class=headerlink href=#extending-logical-volumes title="Permanent link">&para;</a></h3> <ul> <li>Now, let's use the lvextend command to add 5GB of space to that logical volume. </li> <li>In addition to increasing the size of the logical volume, we also need to grow the file system on that logical volume to fill up this new space. </li> <li>That's what the ​ -r​ option is for. <div class=highlight><pre><span></span><code>lvextend -L +5G -r /dev/vg_app/lv_data
df -h /data             <span class=c1># Shows filesystem has increased by 5G</span>

<span class=c1># If you forget to use the ​-r​ option to lvextend to perform the resize, you&#39;ll have to do that after the fact.</span>
lvextend -L +5G /dev/vg_app/lv_data
lvs                     <span class=c1># lv size has increased</span>
df -h /data             <span class=c1># The file system is still the same size, and there is no 5G increase</span>
<span class=c1># To fix this you&#39;ll have to use a resize tool for the specific filesystem you&#39;re working with. </span>
<span class=c1># For ext file systems, that tool is ​resize2fs​. </span>
<span class=c1># We give it the path the the underlying device, which is a logical volume in our case.</span>
resize2fs /dev/vg_app/lv_data
df -h /data             <span class=c1># Shows filesystem has increased by 5G</span>
lvdisplay -m /dev/vg_app/lv_data
<span class=c1># We see that some of the extents live on ​/dev/sdb​ while other extents live on ​/dev/sdc​ .</span>
</code></pre></div></li> </ul> <h3 id=creating-mirrored-logical-volumes>Creating Mirrored Logical Volumes<a class=headerlink href=#creating-mirrored-logical-volumes title="Permanent link">&para;</a></h3> <ul> <li>Mirrored logical volume will ensure that an exact copy of the data will be stored on two different storage devices. <div class=highlight><pre><span></span><code>lvmdiskscan             <span class=c1># We have two more disks that we can use sdd and sde.</span>
pvcreate /dev/sdd /dev/sde
vgcreate vg_safe /dev/sdd /dev/sde
lvcreate -m <span class=m>1</span> -L 5G -n lv_secrets vg_safe
lvs                     <span class=c1># Copy%Sync column indicates if the mirror is synced.</span>
<span class=c1># When it finished syncing the data, it would be at 100%.</span>
lvs -a                  <span class=c1># The logical volume we created is actually RAID 1. So a mirror and raid 1 are the same thing.</span>
<span class=c1># Let&#39;s create a file system on that logical volume and mount it.</span>
mkfs -t ext4 /dev/vg_safe/lv_secrets
mkdir /secrets
mount /dev/vg_safe/lv_secrets /secrets
df -h /secrets
<span class=c1># So we write to ​ /dev/vg_safe/lv_secrets​ and let the logical volume manager handle the mirroring. </span>
<span class=c1># We just use this file system like any other.</span>
</code></pre></div></li> </ul> <h3 id=deleting-logical-volumes-volume-groups-and-physical-volumes>Deleting Logical Volumes, Volume Groups, and Physical Volumes<a class=headerlink href=#deleting-logical-volumes-volume-groups-and-physical-volumes title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># unmount the file system that is mounted inside logical volumes.</span>
umount /secrets
<span class=c1># we can remove the underlying logical volume.</span>
lvremove /dev/vg_safe/lv_secrets
<span class=c1># If you want to remove a pv from a vg, use the vgreduce command.</span>
vgs
vgreduce vg_safe /dev/sde
pvs
pvremove /dev/sde
<span class=c1># Let&#39;s finish destroying the ​ vg_safe​ volume group with ​ vgremove​ .</span>
vgremove vg_safe
vgs
pvs
pvremove /dev/sdd
</code></pre></div> <h3 id=migrating-data-while-online>Migrating Data While Online<a class=headerlink href=#migrating-data-while-online title="Permanent link">&para;</a></h3> <p>Early I mentioned how easy it is to move data from one storage device to another with LVM. Let's say that the storage device attached to our system at ​<code>/dev/sde</code>​ is faster and has more space. Let's say we want to move the data that currently resides on ​<code>/dev/sdb​</code> to that new disk. To do that, we'll just add ​<code>/dev/sde</code>​ to the volume group and migrate the data over. <div class=highlight><pre><span></span><code><span class=c1># we ​pvcreate​ the device.</span>
pvcreate /dev/sde
<span class=c1># Now we add it to the volume group.</span>
vgextend vg_app /dev/sde
pvs
<span class=c1># Finally, we use the ​pvmove​ command to move all the data from ​/dev/sdb​ to ​/dev/sde​</span>
pvmove /dev/sdb /dev/sde
</code></pre></div> Once the ​ pvmove​ command is complete, all the data the used to live on ​ /dev/sdb​ now lives on ​ /dev/sde​ . And the whole time this was happening, any logical volumes and file systems that where on ​ /dev/sdb remained online and available throughout this entire process. There's no need to take an outage for this process. <div class=highlight><pre><span></span><code>pvs                 <span class=c1># Now ​/dev/sdb​ is unused</span>
pvdisplay /dev/sdb  <span class=c1># We see that &quot;Allocated PE&quot; is zero.</span>
<span class=c1># Now that we&#39;re done with this disk we can remove it from the volume group with ​vgreduce​</span>
vgreduce vg_app /dev/sdb
pvremove /dev/sdb
pvs
</code></pre></div></p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2018 - 2019 Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script> <script src=../../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>