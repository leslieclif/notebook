<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/learning/terraform/ rel=canonical><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.0.3"><title>Terraform - Leslie's Online Notebook</title><link rel=stylesheet href=../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#example-using-docker-images class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Terraform </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../k8s/install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../ansible/ class=md-nav__link> Ansible </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Terraform <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Terraform </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#example-using-docker-images class=md-nav__link> Example using Docker images </a> </li> <li class=md-nav__item> <a href=#infrastructure-as-code class=md-nav__link> Infrastructure as Code </a> </li> <li class=md-nav__item> <a href=#benefits-of-iac class=md-nav__link> Benefits of Iac </a> </li> <li class=md-nav__item> <a href=#iac-implemetation-approaches class=md-nav__link> IaC Implemetation Approaches </a> <nav class=md-nav aria-label="IaC Implemetation Approaches"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#imperative class=md-nav__link> Imperative </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration-management class=md-nav__link> Configuration Management </a> </li> <li class=md-nav__item> <a href=#orchestration class=md-nav__link> Orchestration: </a> </li> <li class=md-nav__item> <a href=#installing-terraform class=md-nav__link> Installing Terraform </a> </li> <li class=md-nav__item> <a href=#terraform-lifecycle class=md-nav__link> Terraform Lifecycle </a> </li> <li class=md-nav__item> <a href=#terraform-configuration class=md-nav__link> Terraform Configuration </a> </li> <li class=md-nav__item> <a href=#creating-virtual-network class=md-nav__link> Creating Virtual Network </a> </li> <li class=md-nav__item> <a href=#terraform-validate class=md-nav__link> Terraform Validate </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> <li class=md-nav__item> <a href=#sensitive-parameters class=md-nav__link> Sensitive Parameters </a> </li> <li class=md-nav__item> <a href=#terraformtfvars-file class=md-nav__link> terraform.tfvars File </a> </li> <li class=md-nav__item> <a href=#terraform-fmt class=md-nav__link> terraform fmt </a> </li> <li class=md-nav__item> <a href=#state-file---terraformtfstate class=md-nav__link> State File - terraform.tfstate </a> </li> <li class=md-nav__item> <a href=#modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=#updates class=md-nav__link> Updates </a> </li> <li class=md-nav__item> <a href=#module-outputs class=md-nav__link> Module Outputs </a> </li> <li class=md-nav__item> <a href=#benefits-of-modules class=md-nav__link> Benefits of Modules </a> </li> <li class=md-nav__item> <a href=#introduction-to-meta-parameters class=md-nav__link> Introduction to Meta Parameters </a> </li> <li class=md-nav__item> <a href=#count class=md-nav__link> Count </a> </li> <li class=md-nav__item> <a href=#elements class=md-nav__link> Elements </a> </li> <li class=md-nav__item> <a href=#conditions class=md-nav__link> Conditions </a> </li> <li class=md-nav__item> <a href=#inheriting-variables class=md-nav__link> Inheriting Variables </a> </li> <li class=md-nav__item> <a href=#module-file-structure class=md-nav__link> Module File Structure </a> </li> <li class=md-nav__item> <a href=#nested-modules class=md-nav__link> Nested Modules </a> </li> <li class=md-nav__item> <a href=#remote-backends class=md-nav__link> Remote Backends </a> </li> <li class=md-nav__item> <a href=#points-to-remember class=md-nav__link> Points to Remember </a> </li> <li class=md-nav__item> <a href=#terragrunt class=md-nav__link> Terragrunt </a> </li> <li class=md-nav__item> <a href=#terragrunt-commands class=md-nav__link> Terragrunt Commands </a> </li> <li class=md-nav__item> <a href=#build-in-functions class=md-nav__link> Build-In Functions </a> </li> <li class=md-nav__item> <a href=#lookup class=md-nav__link> lookup </a> </li> <li class=md-nav__item> <a href=#local-values class=md-nav__link> Local Values </a> </li> <li class=md-nav__item> <a href=#data-source class=md-nav__link> Data Source </a> </li> <li class=md-nav__item> <a href=#concat-and-contains class=md-nav__link> Concat and Contains </a> </li> <li class=md-nav__item> <a href=#workspaces class=md-nav__link> Workspaces </a> </li> <li class=md-nav__item> <a href=#workspace-commands class=md-nav__link> Workspace Commands </a> </li> <li class=md-nav__item> <a href=#configuring-multiple-providers class=md-nav__link> Configuring Multiple Providers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../devops/ class=md-nav__link> Index </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#example-using-docker-images class=md-nav__link> Example using Docker images </a> </li> <li class=md-nav__item> <a href=#infrastructure-as-code class=md-nav__link> Infrastructure as Code </a> </li> <li class=md-nav__item> <a href=#benefits-of-iac class=md-nav__link> Benefits of Iac </a> </li> <li class=md-nav__item> <a href=#iac-implemetation-approaches class=md-nav__link> IaC Implemetation Approaches </a> <nav class=md-nav aria-label="IaC Implemetation Approaches"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#imperative class=md-nav__link> Imperative </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration-management class=md-nav__link> Configuration Management </a> </li> <li class=md-nav__item> <a href=#orchestration class=md-nav__link> Orchestration: </a> </li> <li class=md-nav__item> <a href=#installing-terraform class=md-nav__link> Installing Terraform </a> </li> <li class=md-nav__item> <a href=#terraform-lifecycle class=md-nav__link> Terraform Lifecycle </a> </li> <li class=md-nav__item> <a href=#terraform-configuration class=md-nav__link> Terraform Configuration </a> </li> <li class=md-nav__item> <a href=#creating-virtual-network class=md-nav__link> Creating Virtual Network </a> </li> <li class=md-nav__item> <a href=#terraform-validate class=md-nav__link> Terraform Validate </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> <li class=md-nav__item> <a href=#sensitive-parameters class=md-nav__link> Sensitive Parameters </a> </li> <li class=md-nav__item> <a href=#terraformtfvars-file class=md-nav__link> terraform.tfvars File </a> </li> <li class=md-nav__item> <a href=#terraform-fmt class=md-nav__link> terraform fmt </a> </li> <li class=md-nav__item> <a href=#state-file---terraformtfstate class=md-nav__link> State File - terraform.tfstate </a> </li> <li class=md-nav__item> <a href=#modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=#updates class=md-nav__link> Updates </a> </li> <li class=md-nav__item> <a href=#module-outputs class=md-nav__link> Module Outputs </a> </li> <li class=md-nav__item> <a href=#benefits-of-modules class=md-nav__link> Benefits of Modules </a> </li> <li class=md-nav__item> <a href=#introduction-to-meta-parameters class=md-nav__link> Introduction to Meta Parameters </a> </li> <li class=md-nav__item> <a href=#count class=md-nav__link> Count </a> </li> <li class=md-nav__item> <a href=#elements class=md-nav__link> Elements </a> </li> <li class=md-nav__item> <a href=#conditions class=md-nav__link> Conditions </a> </li> <li class=md-nav__item> <a href=#inheriting-variables class=md-nav__link> Inheriting Variables </a> </li> <li class=md-nav__item> <a href=#module-file-structure class=md-nav__link> Module File Structure </a> </li> <li class=md-nav__item> <a href=#nested-modules class=md-nav__link> Nested Modules </a> </li> <li class=md-nav__item> <a href=#remote-backends class=md-nav__link> Remote Backends </a> </li> <li class=md-nav__item> <a href=#points-to-remember class=md-nav__link> Points to Remember </a> </li> <li class=md-nav__item> <a href=#terragrunt class=md-nav__link> Terragrunt </a> </li> <li class=md-nav__item> <a href=#terragrunt-commands class=md-nav__link> Terragrunt Commands </a> </li> <li class=md-nav__item> <a href=#build-in-functions class=md-nav__link> Build-In Functions </a> </li> <li class=md-nav__item> <a href=#lookup class=md-nav__link> lookup </a> </li> <li class=md-nav__item> <a href=#local-values class=md-nav__link> Local Values </a> </li> <li class=md-nav__item> <a href=#data-source class=md-nav__link> Data Source </a> </li> <li class=md-nav__item> <a href=#concat-and-contains class=md-nav__link> Concat and Contains </a> </li> <li class=md-nav__item> <a href=#workspaces class=md-nav__link> Workspaces </a> </li> <li class=md-nav__item> <a href=#workspace-commands class=md-nav__link> Workspace Commands </a> </li> <li class=md-nav__item> <a href=#configuring-multiple-providers class=md-nav__link> Configuring Multiple Providers </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Terraform</h1> <h2 id=example-using-docker-images>Example using Docker images<a class=headerlink href=#example-using-docker-images title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=err>//</span> <span class=err>Main</span><span class=p>.</span><span class=err>tf</span>
<span class=kr>resource</span> <span class=s>&quot;docker_image&quot; &quot;nginx&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>    name</span> <span class=o>=</span> <span class=s2>&quot;nginx:latest&quot;</span>
<span class=na>    keep_locally</span> <span class=o>=</span> <span class=kt>false</span>
<span class=" -Punctuation">}</span>

<span class=kr>resource</span> <span class=s>&quot;docker_container&quot; &quot;nginx&quot;</span> <span class=" -Punctuation">{</span>
<span class=na>    image</span> <span class=o>=</span> <span class=err>docker_image</span><span class=p>.</span><span class=err>nginx</span><span class=p>.</span><span class=err>latest</span>
<span class=na>    name</span> <span class=o>=</span> <span class=s2>&quot;webserver&quot;</span>
    <span class=err>ports</span> <span class=" -Punctuation">{</span>
<span class=na>        internal</span> <span class=o>=</span> <span class=m>80</span>
<span class=na>        external</span> <span class=o>=</span> <span class=m>8050</span>
    <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>
</code></pre></div> <h2 id=infrastructure-as-code>Infrastructure as Code<a class=headerlink href=#infrastructure-as-code title="Permanent link">&para;</a></h2> <ul> <li>IaC is an important <strong>DevOps cornerstone</strong> that enables you to define, automatically manage, and provision infrastructure through source code.</li> <li>Infrastructure is managed as a <strong>software system</strong>.</li> <li>IaC is frequently referred to as <strong>Programmable Infrastructure</strong>.</li> </ul> <h2 id=benefits-of-iac>Benefits of Iac<a class=headerlink href=#benefits-of-iac title="Permanent link">&para;</a></h2> <ul> <li>In IaC,</li> <li>A tool will monitor the <strong>state of the infrastructure</strong>.</li> <li>A script will be sent <strong>automatically to fix the issue</strong>.</li> <li>A script can be written to add new instances, and <strong>it can be reused</strong>.</li> <li><strong>Faster process</strong>, no/less human involvement.</li> </ul> <h2 id=iac-implemetation-approaches>IaC Implemetation Approaches<a class=headerlink href=#iac-implemetation-approaches title="Permanent link">&para;</a></h2> <p>##Declarative + Focuses on the <strong>desired end state of infrastructure (Functional)</strong>. + <strong>Tools</strong> perform the <strong>necessary actions to reach that state</strong>. + Automatically takes care of the <strong>order and executes it</strong>. + Examples are Terraform and CloudFormation.</p> <h3 id=imperative>Imperative<a class=headerlink href=#imperative title="Permanent link">&para;</a></h3> <ul> <li>Focuses on how to <strong>achieve the desired state (Procedural)</strong>.</li> <li>Follows the <strong>order of tasks and it executes in that order</strong>.</li> <li>Examples are Chef and Ansible.</li> </ul> <h2 id=configuration-management>Configuration Management<a class=headerlink href=#configuration-management title="Permanent link">&para;</a></h2> <ul> <li>It is a <strong>system that keeps the track</strong> of organization's hardware, software, and other related information.</li> <li>It includes the software updates and versions present in the system.</li> <li>Configuration management is also called as <strong>configuration control</strong>.</li> <li>E.g.: Chef and Ansible</li> </ul> <h2 id=orchestration>Orchestration:<a class=headerlink href=#orchestration title="Permanent link">&para;</a></h2> <ul> <li>It <strong>automates the coordination, management, and configuration</strong> of systems and hardware.</li> <li>E.g.: Terraform and Nomad</li> </ul> <h2 id=installing-terraform>Installing Terraform<a class=headerlink href=#installing-terraform title="Permanent link">&para;</a></h2> <p>sudo apt-get install unzip wget <a href=https://releases.hashicorp.com/terraform/0.11.11/terraform_0.11.11_linux_amd64.zip>https://releases.hashicorp.com/terraform/0.11.11/terraform_0.11.11_linux_amd64.zip</a> unzip terraform_0.11.11_linux_amd64.zip sudo mv terraform /usr/local/bin/ terraform &ndash;version</p> <h2 id=terraform-lifecycle>Terraform Lifecycle<a class=headerlink href=#terraform-lifecycle title="Permanent link">&para;</a></h2> <ul> <li>Terraform init - Initializes the working directory having Terraform configuration files.</li> <li>Terraform plan - Creates an execution plan and it mentions the changes it is going to make.</li> <li>Terraform apply - When you are not amazed by seeing the results of the terraform plan, you can go ahead and run terraform apply to apply the changes.</li> <li>The main difference between plan and apply is - apply asks for a prompt like Do you want to perform these actions? and then implement the changes, whereas, plan shows the possible end state of your infrastructure without actually implementing them.</li> <li>Terraform destroy - Destroys the created infrastructure.</li> </ul> <h2 id=terraform-configuration>Terraform Configuration<a class=headerlink href=#terraform-configuration title="Permanent link">&para;</a></h2> <ul> <li>A set of files that describe the infrastructure in Terraform is called as Terraform Configuration.</li> <li>The entire configuration file is saved with <strong>.tf</strong> extension. Make sure to have all the configurations maintained in a single .tf file instead of many. Terraform loads all the .tf files present in the working directory.</li> </ul> <h2 id=creating-virtual-network>Creating Virtual Network<a class=headerlink href=#creating-virtual-network title="Permanent link">&para;</a></h2> <ul> <li>create a virtual network without using the Azure portal and azure CLI commands. <div class=highlight><pre><span></span><code>resource &quot;azurerm_virtual_network&quot;&quot;myterraformnetwork&quot;
  {
     name = &quot;myvnet&quot;
     address_space = [&quot;10.0.0.0/16&quot;]
     location=&quot;East US&quot;
     resource_group_name=&quot;er-tyjy&quot;
  }
</code></pre></div></li> <li>Resource blocks define the infrastructure (resource "azurerm_virtual_network" "myterraformnetwork"). It contains the two strings - type of the resource(azurerm_virtualnetwork) and name of the resource(myterraformnetwork).</li> <li>Terraform uses <strong>plugin based architecture</strong> to support the various services providers and infrastructure available.</li> <li>When you run Terraform init command, it downloads and installs provider binary for the corresponding providers. In this case, it is Azure.</li> <li>Now, you can run the terraform plan command. It shows all the changes it is going to make.</li> <li>If the output is as you expected and there are no errors, then you can run Terraform apply.</li> </ul> <h2 id=terraform-validate>Terraform Validate<a class=headerlink href=#terraform-validate title="Permanent link">&para;</a></h2> <ul> <li>You can run this command whenever you like to check whether the code is correct. Once you run this command, if there is no output, it means that there are no errors in the code.</li> </ul> <h2 id=variables>Variables<a class=headerlink href=#variables title="Permanent link">&para;</a></h2> <ul> <li>Terraform provides the following variable types:</li> <li>Strings - The default data type is a <strong>string</strong>.</li> <li>List - A list is like <strong>simple arrays</strong></li> <li> <p>Map - A map value is nothing but a <strong>lookup table for string keys</strong> to get the string values. </p> </li> <li> <p>In terraform, to <strong>reduce the complexity of code and for easiness</strong>, all the variables are created in the <strong>variables.tf</strong> file. <strong>variables.tf</strong> <div class=highlight><pre><span></span><code>variable &quot;rg&quot;
{
default = &quot;terraform-lab2&quot;
}
variable &quot;locations&quot;
{ 
default = [&quot;ap-southeast-1&quot; , &quot;ap-southeast-2&quot;]
}
variable &quot;tags&quot;
{
  type = &quot;map&quot;
  default = 
        {
         environment = &quot;training&quot;
         source=&quot;citadel&quot;
        }
 }
variable &quot;images&quot;
{
type = &quot;map&quot;
default = 
  {
   us-east-1 = &quot;image-1234&quot;
   us-east-2 = &quot;image-4321&quot;
  }
}
</code></pre></div></p> </li> <li>For example, you have defined resource_group name in the variable.tf file. you can call them in main.tf file like this <code>"${var.resource_group}"</code></li> </ul> <h2 id=sensitive-parameters>Sensitive Parameters<a class=headerlink href=#sensitive-parameters title="Permanent link">&para;</a></h2> <ul> <li>There may be sensitive parameters which should be shown only when running the terraform plan but not terraform apply. <div class=highlight><pre><span></span><code>output &quot;sensitiveoutput&quot; {
  sensitive = true
  value     = VALUE
}
</code></pre></div></li> <li>When you run terraform apply, the output is labeled as sensitive. If there is any sensitive information, then you can protect it by using a sensitive parameter.</li> </ul> <h2 id=terraformtfvars-file>terraform.tfvars File<a class=headerlink href=#terraformtfvars-file title="Permanent link">&para;</a></h2> <ul> <li>In terraform.tfvars file, we mention the "key/value" pair.</li> <li>The main.tf file takes the input from a terraform. tfvars file. If it is not present, it gets the input from variables.tf file. <div class=highlight><pre><span></span><code>resource_group = &quot;user-ybje&quot;
location = &quot;East US&quot;
</code></pre></div></li> </ul> <h2 id=terraform-fmt>terraform fmt<a class=headerlink href=#terraform-fmt title="Permanent link">&para;</a></h2> <ul> <li>It rewrites the confguration files to canonical style and format.</li> </ul> <h2 id=state-file---terraformtfstate>State File - terraform.tfstate<a class=headerlink href=#state-file---terraformtfstate title="Permanent link">&para;</a></h2> <ul> <li>It is a <strong>JSON file</strong> that maps the real world resources to the configuration files. </li> <li>In terraform, there are three states.</li> <li><strong>Desired state</strong> - Represents how the infrastructure to be present.</li> <li><strong>Actual state</strong> - Represents the current state of infrastructure.</li> <li><strong>Known state</strong> - To bridge desired state and actual state, there is a known state. You can get the details of known state from a tfstate file.</li> <li>When you run terraform <strong>plan command</strong>, terraform performs a quick refresh and lists the actions needed to achieve the desired state.</li> <li>When terraform <strong>apply command</strong> is run, it applies the changes and updates the actual state.</li> </ul> <h2 id=modules>Modules<a class=headerlink href=#modules title="Permanent link">&para;</a></h2> <ul> <li>A module is like a reusable <strong>blueprint of infrastructure</strong>.</li> <li>A module is nothing but a folder of Terraform files.</li> <li>In terraform the modules are categorized into two types:</li> <li>Root modules - The current directory of Terraform files on which you are running the commands.</li> <li>Child modules - The modules sourced by the root module. To create a child module, add resources to it. <strong>Module syntax:</strong> <div class=highlight><pre><span></span><code>module &quot;child&quot;
{
source = &quot;../child&quot;
}
</code></pre></div></li> <li>The difference between adding the resources and module is <strong>for adding the resource</strong> (Eg: resource "azurerm_virtual_network" 'test") you need type and name but for adding a module (Eg: module "child") only the name is enough.</li> <li> <p>The name of the module should be <strong>unique</strong> within configurations because it is used as a reference to the module and outputs.</p> </li> <li> <p>main.tf file so that it creates three virtual networks at a time. <div class=highlight><pre><span></span><code>resource &quot;azurerm_virtual_network&quot;&quot;multiplevnets&quot; {
   name = &quot;multiplevnets-${count.index}&quot;
   resource_group_name=&quot;${var.resource_group&quot;}
   location=&quot;${var.location}&quot;
   address_space=[&quot;10.0.0.0/16&quot;]
   count = 3
}
</code></pre></div></p> </li> </ul> <h2 id=updates>Updates<a class=headerlink href=#updates title="Permanent link">&para;</a></h2> <ul> <li><strong>terraform get</strong> - This command is used to download and install the modules for that configuration.</li> <li><strong>terraform get -update</strong> - It checks the downloaded modules and checks for the recent versions if any.</li> </ul> <h2 id=module-outputs>Module Outputs<a class=headerlink href=#module-outputs title="Permanent link">&para;</a></h2> <p>If you need output from any module, you can get it by passing the required parameter.</p> <p>For example, the output of virtual network location can be found by following the below syntax. You can add this syntax to <strong>.tf file(main.tf or variables.tf)</strong>. <div class=highlight><pre><span></span><code>output &quot;virtual_network_id&quot; {
value = &quot;${azurerm_virtual_network.test.location}&quot;
}  
</code></pre></div> Where virtual_network_id is a unique name and "${azurerm_virtual_network.test.location}" is the location of the virtual network using string interpolation.</p> <h2 id=benefits-of-modules>Benefits of Modules<a class=headerlink href=#benefits-of-modules title="Permanent link">&para;</a></h2> <ul> <li><strong>Code reuse</strong>: When there is a need to provision the group of resources on another resource at the same time, a module can be used instead of copying the same code. It helps in resolving the bugs easily. If you want to make changes, changing the code in one place is enough.</li> <li><strong>Abstraction layer</strong>: It makes complex configurations easier to conceptualize. For example, if you like to add vault(Another harshicop's tool for managing secrets) cluster to the environment, it requires dozens of components. Instead of worrying about individual components, it gives ready-to-use vault cluster.</li> <li><strong>Black box</strong>: To create a vault, you only need some configuration parameters without worrying about the complexity. You don't need any knowledge on how to install vault, configuring vault cluster and working of the vault. You can create a working cluster in a few minutes.</li> <li><strong>Best practices in organization</strong>: When a module is created, you can give it to the other teams. It helps in easily developing the infrastructure.</li> <li>**Versioned artifacts: They are immutable artifacts and can be promoted from one environment to others.</li> </ul> <h2 id=introduction-to-meta-parameters>Introduction to Meta Parameters<a class=headerlink href=#introduction-to-meta-parameters title="Permanent link">&para;</a></h2> <p>There are some difficulties with the declarative language. For example, since it is a declarative language, there is no concept of for loops. How do you repeat a piece of code without copy paste? * Terraform provides primitives like meta parameter called as <strong>count, life cycle blocks like create_before_destroy, ternary operator and a large number of interpolation functions</strong>. This helps in performing certain types of loops, if statements and zero downtime deployments.</p> <h2 id=count>Count<a class=headerlink href=#count title="Permanent link">&para;</a></h2> <ul> <li> <p>Count - It defines how many parameters you like to create.</p> </li> <li> <p>Modify main.tf file so that it creates three virtual networks at a time. <div class=highlight><pre><span></span><code>resource &quot;azurerm_virtual_network&quot;&quot;multiplevnets&quot; {
   name = &quot;multiplevnets-${count.index}&quot;
   resource_group_name=&quot;${var.resource_group&quot;}
   location=&quot;${var.location}&quot;
   address_space=[&quot;10.0.0.0/16&quot;]
   count = 3
}
</code></pre></div></p> </li> <li>To increase Vnets to 5, update <strong>count = 5</strong>.</li> <li>To decrease Vnets to 2, update <strong>count = 2</strong>, last 3 Vnets will get deleted.</li> </ul> <h2 id=elements>Elements<a class=headerlink href=#elements title="Permanent link">&para;</a></h2> <ul> <li>Suppose you like to create the three virtual networks with names vnet-A, vnet-B and vnet-C, you can do this easily with the help of <strong>list</strong>.</li> <li>Mention how many vnets you are going to create with the help of list and define it in variables.tf file <div class=highlight><pre><span></span><code>variable &quot;name&quot; {
  type= &quot;list&quot;
  default = [&quot;A&quot;,&quot;B&quot;,&quot;C&quot;]
}
</code></pre></div></li> <li>You can call this variable in the main.tf file in the following way</li> <li><strong>count = "${length(var.name)}"</strong> - It returns number of elements present in the list. you should store it in meta parameter count.</li> <li><strong>"${element(var.name,count.index)}"</strong> - It acts as a loop, it takes the input from list and repeats until there are no elements in list. <strong>variables.tf ** <div class=highlight><pre><span></span><code>variable &quot;resource_group&quot; {
 default = &quot;user-nuqo&quot;
  } 
 variable &quot;location&quot; { 
 default = &quot;East US&quot;
  }  
  variable &quot;name&quot; {
   type = &quot;list&quot;
   default = [&quot;A&quot;,&quot;B&quot;,&quot;C&quot;]
  }
</code></pre></div> **main.tf</strong> <div class=highlight><pre><span></span><code>resource &quot;azurerm_virtual_network&quot;&quot;multiple&quot; {
name = &quot;vnet-${element(var.name,count.index)}&quot;
resource_group_name = &quot;${var.resource_group}&quot;
location = &quot;${var.location}&quot;
address_space=[&quot;10.0.0.0/16&quot;]
count=&quot;${length(var.name)}&quot; 
}
</code></pre></div></li> </ul> <h2 id=conditions>Conditions<a class=headerlink href=#conditions title="Permanent link">&para;</a></h2> <p>For example, a vnet has to be created only, if the variable number of vnets is 3 or else no. You can do this by using the ternary operator. <strong>variables.tf</strong> <div class=highlight><pre><span></span><code>variable &quot;no_of_vnets&quot; {
   default= 3
}
</code></pre></div> <strong>main.tf</strong> <div class=highlight><pre><span></span><code>count = &quot;${var.no_of_vnets ==3 ?1  : 0}&quot;
</code></pre></div> * First, it will execute the ternary operator. If it is true, it takes the output as 1 or else 0. * Now, in the above case, the output is 1, the count becomes one, and the vnet is created.</p> <h2 id=inheriting-variables>Inheriting Variables<a class=headerlink href=#inheriting-variables title="Permanent link">&para;</a></h2> <ul> <li>Inheriting the variables between modules keeps your Terraform code DRY.</li> <li><strong>Don't Repeat Yourself (DRY)</strong></li> <li>It aims at <strong>reducing repeating</strong> patterns and code.</li> <li>There is no need to write the <strong>duplicate code</strong> for each environment you are deploying.</li> <li>You can write the <strong>minimum code and achieve the goal</strong> by having maximum re-usability.</li> </ul> <h2 id=module-file-structure>Module File Structure<a class=headerlink href=#module-file-structure title="Permanent link">&para;</a></h2> <ul> <li>You will follow the <strong>below file structure to inherit</strong> the variables between modules. <div class=highlight><pre><span></span><code> modules
         |
         |___mod
         |    |__mod.tf
         |
         |___vnet
              |__vnet.tf
              |__vars.tf
</code></pre></div></li> <li>There is one vnet and you can <strong>configure the vnet</strong> by passing the parameters from module.</li> <li>The variables in the vnet are <strong>overriden</strong> by the values provided in mod.tf file.</li> <li>Create a folder with name Modules</li> <li>Create two subfolders of names vnet and mod in the nested_modules folder.</li> <li>In the vnet folder, create a virtual network using Terraform configuration. Maintain two files one for <strong>main configuration(vnet.tf) and other for declaring variables(vars.tf)</strong>.</li> <li>Now, create main.tf file like this <div class=highlight><pre><span></span><code>resource &quot;azurerm_virtual_network&quot;&quot;vnet&quot; {
name = &quot;${var.name}&quot;
address_space = [&quot;10.0.0.0/16&quot;]
resource_group_name = &quot;${var.resourcegroup}&quot;
location = &quot;${var.location}&quot;
}
</code></pre></div></li> <li>Now, vars.tf file looks like this <div class=highlight><pre><span></span><code>variable &quot;name&quot; {
description = &quot;name of the vnet&quot;
}

variable &quot;resourcegroup&quot; {
description = &quot;name of the resource group&quot;
}

variable &quot;location&quot; {
description =&quot;name of the location&quot;
}

variable &quot;address&quot; {
type =&quot;list&quot;
description = &quot;specify the address&quot;
}
</code></pre></div></li> <li>Create a folder with name mod in the modules directory. Create a file with name <strong>mod.tf</strong> and write the below code in it.</li> <li>We are passing the variables from the root module (mod) to the child module (vnet) using <strong>source path</strong>. <div class=highlight><pre><span></span><code>module &quot;child&quot; {
source = &quot;../vnet&quot;
name = &quot;modvnet&quot;
resourcegroup = &quot;user-vcom&quot;
location  = &quot;eastus&quot;
address = &quot;10.0.1.0/16&quot;
}
</code></pre></div></li> <li>Run terraform plan to visualize how the directories will be created. You can see the name of the vnet is taken from the module file instead of getting it from vars.tf</li> </ul> <h2 id=nested-modules>Nested Modules<a class=headerlink href=#nested-modules title="Permanent link">&para;</a></h2> <ul> <li>For any module, root module should exist.</li> <li>Root module is basically a directory that holds the terraform configuration files for the desired infrastructure.</li> <li>They also provide the <strong>entry point</strong> to the nested modules you are going to utilize.</li> <li>For any module main.tf, vars.tf, and outputs.tf naming conventions are recommended.</li> <li>If you are using nested modules, create them under the <strong>subdirectory with name modules</strong>. <div class=highlight><pre><span></span><code>checking_modules
    |__modules
    |      |____main.tf
    |   
    |______virtual_network 
    |              |_main.tf
    |              |_vars.tf
    |
    |______storage_account
                      |_main.tf
                      |_vars.tf
</code></pre></div></li> <li>You will create three folders with names modules, virtual_network, and storage account.</li> <li>Make sure that you are following the terraform standards like writing the terraform configuration in the main file and defining the variables alone in the variables(vars.tf) file. <strong>stoacctmain.tf</strong> <div class=highlight><pre><span></span><code>resource &quot;azurerm_storage_account&quot;&quot;storageacct&quot; {
name = &quot;${var.name}&quot;
resource_group_name = &quot;${var.rg}&quot;
location = &quot;${var.loc}&quot;
account_replication_type = &quot;${var.account_replication}&quot;
account_tier = &quot;${var.account_tier}&quot;
}
</code></pre></div> <strong>stoacctvars.tf</strong> <div class=highlight><pre><span></span><code>variable &quot;rg&quot; {
	default = &quot;user-wmle&quot;
}
variable &quot;loc&quot; {
	default = &quot;eastus&quot;
}
variable &quot;name&quot; {
    default =&quot;storagegh&quot;
}
variable &quot;account_replication&quot; {  
	default = &quot;LRS&quot;
}
variable &quot;account_tier&quot; {
	default = &quot;Basic&quot;
}
</code></pre></div> <strong>Root Module (main.tf) file under checking_modules</strong> <div class=highlight><pre><span></span><code>module &quot;vnet&quot; {
source = &quot;../virtual_network&quot;
name = &quot;mymodvnet&quot;
}
module &quot;stoacct&quot; {
source = &quot;../storage_account&quot;
name = &quot;mymodstorageaccount&quot;
}
</code></pre></div></li> <li>Not only the parameters mentioned above, but you can also pass any parameter from root module to the child modules.</li> <li>You can pass the parameters from the module to avoid the duplicity between them.</li> </ul> <h2 id=remote-backends>Remote Backends<a class=headerlink href=#remote-backends title="Permanent link">&para;</a></h2> <ul> <li>It is better to store the code in a <strong>central repository</strong>.</li> <li>However, is having some disadvantages of doing so:</li> <li>You have to <strong>maintain push, pull configurations</strong>. If one pushes the wrong configuration and commits it, it becomes a problem.</li> <li>State file consists of <strong>sensitive information</strong>. So state files are non-editable.</li> <li>Backend in terraform explains how the state file is loaded and operations are executed.</li> <li>Backend can get initialize only after running terraform init command. So, terraform init is required to be run every time</li> <li>when backend is configured</li> <li>when any changes made to the backend</li> <li>when the backend configuration is removed completely</li> <li>Terraform <strong>cannot perform auto-initialize</strong> because it may require additional info from the user, to perform state migrations, etc..</li> <li>Below are the steps which you will be maintaining for creating <strong>remote backend</strong> in Azure.</li> <li>Create a storage account</li> <li>Create a storage container</li> <li>Create a backend</li> <li>Get the storage account access key and resource group name, give it as a parameter to the backend.</li> <li>Below is the complete file structure for sample backend. <div class=highlight><pre><span></span><code>Backend
   |____stoacct.tf
   |____stocontainer.tf
   |____backend.tf
   |____vars.tf
   |____output.tf
</code></pre></div></li> <li>stoacct.tf <div class=highlight><pre><span></span><code>resource &quot;azurerm_storage_account&quot; &quot;storageaccount&quot; {
  name                     = &quot;storageaccountname&quot;
  resource_group_name      = &quot;${var.resourcegroup}&quot;
  location                 = &quot;${var.location}&quot;
  account_tier             = &quot;${var.accounttier}&quot;
  account_replication_type = &quot;GRS&quot;

  tags {
    environment = &quot;staging&quot;
  }
}
</code></pre></div></li> <li>stocontainer.tf <div class=highlight><pre><span></span><code>resource &quot;azurerm_storage_container&quot; &quot;storagecontainer&quot; {
  name                  = &quot;vhds&quot;
  resource_group_name   = &quot;${var.resourcegroup}&quot;
  storage_account_name  = &quot;${azurerm_storage_account.storageaccount.name}&quot;
  container_access_type = &quot;private&quot;
}
</code></pre></div></li> <li>vars.tf <div class=highlight><pre><span></span><code>variable &quot;resourcegroup&quot; {
default = &quot;user-abcd&quot;
}
variable &quot;location&quot; {
default = &quot;eastus&quot;
}
variable &quot;accounttier&quot; {
default = &quot;Basic&quot;
}
</code></pre></div></li> <li>output.tf <div class=highlight><pre><span></span><code>output &quot;storageacctname&quot; {
value = &quot;${azurerm_storage_account.storageaccount.name}&quot;
}

output &quot;storageacctcontainer&quot; {
value = &quot;${azurerm_storage_account.storagecontainer.name}&quot;
}

output &quot;access_key&quot; {
value = &quot;${azurerm_storage_account.storageaccount.primary_access_key&quot;
}
</code></pre></div></li> <li>Before creating backend, run the command to get the storage account keys list(<strong>az storage account keys list &ndash;account-name storageacctname</strong>) and copy one of the key somewhere. It is useful for configuring the backend.</li> <li>backend.tf <div class=highlight><pre><span></span><code>terraform{
	backend   &quot;azurerm&quot; {
	storage_account_name = &quot;storageacct21&quot;
	container_name = &quot;mycontainer&quot;
	key = &quot;terraform.tfstate.change&quot;
	resource_group_name = &quot;user-okvt&quot;
	access_key = &quot;aJlf+XjZhxwRp4gsU4hkGrQJzO7xBzz7B9rSzMLB/ozwcM6k/1N.......==&quot; 
	}
}
</code></pre></div></li> <li>where Parameters:</li> <li>storage_account_name - name of the storage account.</li> <li>container_name - name of the container.</li> <li>key- name of the tfstate blob.</li> <li>resource_group_name - name of the resource group.</li> <li>access_key - Storage account access key(any one).</li> </ul> <h2 id=points-to-remember>Points to Remember<a class=headerlink href=#points-to-remember title="Permanent link">&para;</a></h2> <ul> <li>You cannot use interpolation syntax to configure backends.</li> <li>After creating backend run terraform init, it will be in the locked state.</li> <li>By running terraform apply command automatically, the lease status is changed to locked.</li> <li>After it is applied, it will come to an unlocked state.</li> <li>This backend supports consistency checking and state locking using the native capabilities of the Azure storage account.</li> </ul> <h2 id=terragrunt>Terragrunt<a class=headerlink href=#terragrunt title="Permanent link">&para;</a></h2> <ul> <li>Terragrunt is referred to as a thin wrapper for Terraform which provides extra tools to keep the terraform configurations DRY, manage remote state and to work with multiple terraform modules.</li> </ul> <h2 id=terragrunt-commands>Terragrunt Commands<a class=headerlink href=#terragrunt-commands title="Permanent link">&para;</a></h2> <ul> <li>terragrunt get</li> <li>terragrunt plan</li> <li>terragrunt apply</li> <li>terragrunt output</li> <li> <p>terragrunt destroy</p> </li> <li> <p>Terragrunt supports the following use cases:</p> </li> <li>Keeps terraform code DRY.</li> <li>Remote state configuration DRY.</li> <li>CLI flags DRY.</li> <li> <p>Executing terraform commands on multiple modules at a time.</p> </li> <li> <p>Advantages of using terragrunt:</p> </li> <li>Provides locking mechanism.</li> <li>Allows you to use remote state always.</li> </ul> <h2 id=build-in-functions>Build-In Functions<a class=headerlink href=#build-in-functions title="Permanent link">&para;</a></h2> <h2 id=lookup>lookup<a class=headerlink href=#lookup title="Permanent link">&para;</a></h2> <ul> <li> <p>This helps in performing a <strong>dynamic lookup</strong> into a map variable.</p> </li> <li> <p>The syntax for lookup variable is <code>lookup(map,key, [default])</code>.</p> </li> <li>map: The map parameter is a variable like var.name.</li> <li>key: The key parameter includes the key from where it should find the environment.</li> <li> <p>If the key doesn't exist in the map, interpolation will fail, if it doesn't find a third argument (default).</p> </li> <li> <p>The lookup will not work on nested lists or maps. It only works on flat maps.</p> </li> </ul> <h2 id=local-values>Local Values<a class=headerlink href=#local-values title="Permanent link">&para;</a></h2> <ul> <li>Local values help in <strong>assigning names to the expressions</strong>, which can be used multiple times within a module without rewriting it.</li> <li>Local values are defined in the local blocks.</li> <li>It is recommended to group the logically related local values together as a single block, if there is a dependency between them. <div class=highlight><pre><span></span><code>locals {
service_name = &quot;Fresco&quot;
owner = &quot;Team&quot;
}
</code></pre></div></li> <li>Example <div class=highlight><pre><span></span><code>locals {
  instance_ids = &quot;${concat(aws_instance.blue.*.id, aws_instance.green.*.id)}&quot;
}
</code></pre></div></li> <li>If a single value or a result is used in many places and it is likely to be changed in the future, then you can go with locals.</li> <li>It is recommended to <strong>not use many local values</strong> because it makes the read configurations hard to the future maintainers.</li> </ul> <h2 id=data-source>Data Source<a class=headerlink href=#data-source title="Permanent link">&para;</a></h2> <ul> <li>Data source allows the data to be computed or fetched for use in Terraform configuration.</li> <li>Data sources allow the terraform configurations to build on the information defined outside the Terraform or by another Terraform configuration.</li> <li>Providers play a major role in implementing and defining data sources.</li> <li>Data source helps in two major ways:</li> <li>It provides a <strong>read-only</strong> view for the pre-existing data.</li> <li> <p>It can <strong>compute new values</strong> on the fly.</p> </li> <li> <p>Every data source in the Terraform is mapped to the provider depending on the <strong>longest-prefix-matching</strong>. <div class=highlight><pre><span></span><code>data &quot;azurerm_resource_group&quot; &quot;passed&quot; {
  name = &quot;${var.resource_group_name}&quot;
}
</code></pre></div></p> </li> </ul> <h2 id=concat-and-contains>Concat and Contains<a class=headerlink href=#concat-and-contains title="Permanent link">&para;</a></h2> <p><code>concat(list1,list2)</code> * It combines two or more lists into a single list. <code>contains(list, element)</code> * It returns true if the element is present in the list or else false. E.g. <code>contains(var.list_of_strings, "an_element")</code></p> <h2 id=workspaces>Workspaces<a class=headerlink href=#workspaces title="Permanent link">&para;</a></h2> <ul> <li>Every terraform configurations has <strong>associate backends</strong> which defines how the operations are executed and where the persistent data like terraform state are stored.</li> <li>Persistent data stored in backend belongs to a workspace.</li> <li>Previously, the backend has only one workspace which is called as <strong>default</strong> and there will be only one state file associated with the configuration.</li> <li>Some of the backends support multiple workspaces, i.e. It allows multiple state files to be stored within a single configuration.</li> <li>The configuration is still having only one backend, and the multiple distinct instances can be deployed without configuring to a new backend or by changing authentication credentials.</li> <li>default workspace is special because you can't delete the default workspace.</li> <li>You cannot delete your active workspace (the workspace in which you are currently working).</li> <li>If you haven't created the workspace before, then you are working on the default workspace.</li> </ul> <h2 id=workspace-commands>Workspace Commands<a class=headerlink href=#workspace-commands title="Permanent link">&para;</a></h2> <ul> <li>terraform workspace new <name> - It creates the workspace with specified name and switches to it.</li> <li>terraform workspace list - It lists the workspaces available.</li> <li>terraform workspace select <name> - It switches to the specified workspace.</li> <li>terraform workspace delete <name> - It deletes the mentioned workspace.</li> </ul> <h2 id=configuring-multiple-providers>Configuring Multiple Providers<a class=headerlink href=#configuring-multiple-providers title="Permanent link">&para;</a></h2> <ul> <li>Below is the file structure that you will maintain for working with multiple providers. <div class=highlight><pre><span></span><code>      multiple_providers
       |
       |___awsmain.tf
       |
       |___azuremain.tf
       |
       |___vars.tf
       |
       |___out.tf
</code></pre></div></li> <li>Create an S3 bucket in Azure which helps in storing the file in AWS.</li> <li>awsmain.tf <div class=highlight><pre><span></span><code>resource &quot;aws_s3_bucket&quot; &quot;b&quot; {
  bucket = &quot;my-tf-test-bucket-21&quot;
  acl    = &quot;private&quot;

  tags = {
    Name        = &quot;My bucket test&quot;
    Environment = &quot;Dev&quot;
  }
}
</code></pre></div></li> <li>Resource has two parameters: name(aws_s3_bucket) and type("b").</li> <li>Name of the resource may vary from provider to provider. Type of the resource depends on the user.</li> <li>Bucket indicates the name of the bucket. If it is not assigned, terraform assigns a random unique name.</li> <li>acl (access control list) - It helps to manage access to the buckets and objects.</li> <li>tag - It is a label which is assigned to the AWS resource by you or AWS.</li> <li> <p>Environment - On which environment do you like to deploy S3 bucket (Dev, Prod or Stage). </p> </li> <li> <p>azuremain.tf <div class=highlight><pre><span></span><code>resource &quot;azurerm_storage_account&quot;&quot;storageacct&quot; {
name = &quot;storageacct21&quot;
resource_group_name = &quot;${var.rg}&quot;
location = &quot;${var.loc}&quot;
account_replication_type = &quot;LRS&quot;
account_tier = &quot;Standard&quot;
}
</code></pre></div></p> </li> <li>Parameters </li> <li>name - It indicates the name of the storage account.</li> <li>resource_group_name and location- name of the resource group and location.</li> <li>account_replication_type - Type of the account replication.</li> <li> <p>account_tier - Account tier type</p> </li> <li> <p>out.tf <div class=highlight><pre><span></span><code>output &quot;account_tier&quot; {
value = &quot;azurerm_storage_Account.storagecct.account_tier&quot;
}
</code></pre></div></p> </li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ansible/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Ansible </div> </div> </a> <a href=../docker/docker-notes/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Docker </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2018 - 2019 Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>