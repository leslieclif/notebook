<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/k8s/1-tips/ rel=canonical><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.1, mkdocs-material-7.0.3"><title>1 tips - Leslie's Online Notebook</title><link rel=stylesheet href=../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tools-used class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 1 tips </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../devops/ class=md-nav__link> Devops </a> </li> <li class=md-nav__item> <a href=../../devops/ci/ class=md-nav__link> CI </a> </li> <li class=md-nav__item> <a href=../../devops/cd/ class=md-nav__link> CD </a> </li> <li class=md-nav__item> <a href=../../devops/iac/ class=md-nav__link> IAC </a> </li> <li class=md-nav__item> <a href=../../devops/gitops/ class=md-nav__link> GitOps </a> </li> <li class=md-nav__item> <a href=../../devops/devops-engineer/ class=md-nav__link> Skills </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learning/ansible/ansible/ class=md-nav__link> Ansible </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learning/git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../learning/python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../learning/vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../../learning/terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../../learning/docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../learning/k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../learning/linux/linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../learning/linux/security/ class=md-nav__link> Linux_Security </a> </li> <li class=md-nav__item> <a href=../../learning/linux/firewall/ class=md-nav__link> Linux_Firewall </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#tools-used class=md-nav__link> Tools used </a> <nav class=md-nav aria-label="Tools used"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#vim class=md-nav__link> Vim </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#general-tips class=md-nav__link> General Tips </a> </li> <li class=md-nav__item> <a href=#troubleshooting-tips class=md-nav__link> Troubleshooting Tips </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>1 tips</h1> <p>alias k=kubectl # will already be pre-configured</p> <p>export do="&ndash;dry-run=client -o yaml" # k create deploy nginx &ndash;image=nginx $do</p> <p>export now="&ndash;force &ndash;grace-period 0" # k delete pod x $now</p> <p>alias ke='kubectl explain' alias pe='k explain po &ndash;recursive' alias kgp='k get po' alias kns='k config set-context &ndash;current &ndash;namespace'</p> <p><a href=https://hackernoon.com/ckad-and-cka-certifications-which-to-take-first-and-how-to-prepare-bh4437mc>https://hackernoon.com/ckad-and-cka-certifications-which-to-take-first-and-how-to-prepare-bh4437mc</a> <a href=https://www.nisheetsinvhal.com/how-i-scored-a-perfect-100-on-cka/ >https://www.nisheetsinvhal.com/how-i-scored-a-perfect-100-on-cka/</a></p> <ul> <li><a href=https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad>CNCF Tips</a> <div class=highlight><pre><span></span><code><span class=c1># Vim config to be set in the exam terminal</span>
<span class=nb>echo</span> <span class=s2>&quot;set ts=2 sts=2 sw=2 et number ai&quot;</span> &gt;&gt; ~/.vimrc

<span class=nb>source</span> ~/.vimrc
<span class=c1># This command will ensure that you set the namespace correctly for your current context. </span>
kubectl config view --minify <span class=p>|</span> grep namespace 
<span class=c1># To test the service, launch a temporary POD with curl</span>
kubectl curl --image<span class=o>=</span>alpine/curl -it --rm  -- sh
<span class=c1># Aliases</span>
<span class=c1>######## Choose any style</span>
<span class=c1># Step 1: enabled auto-complete feature in the bash shell after setting the aliases</span>
<span class=nb>source</span> &lt;<span class=o>(</span>kubectl completion bash<span class=o>)</span>
<span class=nb>echo</span> <span class=s2>&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc
<span class=nb>complete</span> -F __start_kubectl k
<span class=nb>alias</span> <span class=nv>k</span><span class=o>=</span>kubectl
<span class=nb>alias</span> <span class=nv>kr</span><span class=o>=</span><span class=s1>&#39;k run&#39;</span>
<span class=nb>alias</span> <span class=nv>krun</span><span class=o>=</span><span class=s2>&quot;k run -h | grep &#39;# &#39; -A2&quot;</span>
<span class=nb>alias</span> <span class=nv>kg</span><span class=o>=</span><span class=s1>&#39;k get&#39;</span>
<span class=nb>alias</span> <span class=nv>kd</span><span class=o>=</span><span class=s1>&#39;k describe&#39;</span>
<span class=nb>alias</span> <span class=nv>ke</span><span class=o>=</span><span class=s1>&#39;kubectl explain&#39;</span>
<span class=nb>alias</span> <span class=nv>kaf</span><span class=o>=</span><span class=s1>&#39;k apply -f&#39;</span>
<span class=nb>alias</span> <span class=nv>kdf</span><span class=o>=</span><span class=s1>&#39;k delete -f&#39;</span>
<span class=nb>alias</span> <span class=nv>kdp</span><span class=o>=</span><span class=s1>&#39;k delete po&#39;</span>
<span class=nb>alias</span> <span class=nv>kgp</span><span class=o>=</span><span class=s1>&#39;k get po&#39;</span>
<span class=c1># if you’re sure that the Pod that you’re deleting has no Persistent Volumes attached to it (or other resources external to the Pod), then use below command</span>
<span class=nb>alias</span> <span class=nv>kpd</span><span class=o>=</span><span class=s1>&#39;k delete pod --force --grace-period=0&#39;</span>  

<span class=c1># Step 2: create short cut using env variable</span>
<span class=nb>export</span> <span class=nv>dr</span><span class=o>=</span><span class=s2>&quot;--dry-run=client -o yaml&quot;</span>
<span class=c1># Using k run mypod --image=nginx $dr &gt; mypod.yaml</span>

<span class=c1># Step 3: To avoid typing namespaces in the imperative command, set it once and then type all commands</span>
k config get-contexts
<span class=c1># Copy paste the set-context and use-context</span>
<span class=nb>alias</span> <span class=nv>kns</span><span class=o>=</span><span class=s2>&quot;kubectl config set-context --current --namespace&quot;</span>
<span class=c1># Set the alias as above</span>
<span class=c1># Set the namespace where you want to execute the commands, like in myns</span>
kns myns
<span class=c1># Tip: always remember to switch back to default namespace for the next question</span>
kns default

<span class=c1># Changing namespaces</span>
<span class=c1># Suppose your have namespaces test1, test2, test3</span>
kubectl -n test1 get pods
<span class=c1># Now run the last command but in different namespace like test2</span>
^test1^test2
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># Show all the Cert files in ETCD configuration</span>
cat /etc/kubernetes/manifest/etcd.yaml <span class=p>|</span> grep file
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># *** Important - Store the YAML files in home folder wth question number, so in case of review, you can verify and apply it say in correct namespace</span>
<span class=c1># For Windows: Ctrl+Insert to copy and Shift+Insert to paste.</span>
<span class=c1>#  In addition, you might find it helpful to use the Notepad (see top menu under &#39;Exam Controls&#39;) to manipulate text before pasting to the command line.</span>
<span class=c1># Only a single terminal console is available during the exam. Terminal multiplexers such as GNU Screen and tmux can be used to create virtual consoles.</span>
<span class=c1># You can switch the cluster/configuration context using a command such as the following:</span>
kubectl config use-context &lt;cluster/context name&gt;
<span class=c1># Nodes making up each cluster can be reached via ssh, using a command such as the following: </span>
ssh &lt;nodename&gt;
<span class=c1># You can assume elevated privileges on any node by issuing the following command: </span>
sudo -i
<span class=c1># You can also use `sudo` to execute commands with elevated privileges at any time</span>
<span class=c1># You must return to the base node (`hostname node-1`) after completing each task.</span>
<span class=c1># When you want to get some data quickly from a node without getting a shell</span>
ssh &lt;nodename&gt; &lt;<span class=nb>command</span> to execute&gt;     <span class=c1># This will give you the output instead of changing nodes</span>
<span class=c1># You can use kubectl and the appropriate context to work on any cluster from the base node. </span>
<span class=c1># When connected to a cluster member via ssh, you will only be able to work on that particular cluster via kubectl.</span>

<span class=c1># For your convenience, all environments, in other words, the base system and the cluster nodes, have the following additional command-line tools pre-installed and pre-configured:</span>
<span class=c1># - kubectl with k alias and Bash autocompletion</span>
<span class=c1># - jq for YAML/JSON processing</span>
<span class=c1># - tmux for terminal multiplexing</span>
<span class=c1># - curl and wget for testing web services</span>
<span class=c1># - man and man pages for further documentation</span>

<span class=c1># Where no explicit namespace is specified, the default namespace should be acted upon.</span>
<span class=c1># If you need to destroy/recreate a resource to perform a certain task, it is your responsibility to back up the resource definition appropriately prior to destroying the resource.</span>
<span class=c1># Dont waste time waiting for prompt to come back when deleting pods, use the --force flag &lt;Careful&gt;</span>
</code></pre></div></li> <li>Shortcuts <div class=highlight><pre><span></span><code>po      Pod
rs      ReplciaSet
deploy  Deployment
svc     Service
ds      DaemonSet
ns      Namespace
netpol  Network Policy
pv      Persistent Volume
pvc     Persistent Volume Claims
sa      Service Account
sts     StatefulSets
</code></pre></div></li> <li>Implicit Commands <div class=highlight><pre><span></span><code><span class=c1># Do not copy paste from documentation into OS Editor. Copy into Notepad and then make changes. [Not recommended] to avoid wasting time in formatting. Type in Editor directly or use implicit commands</span>
<span class=c1># Use Nano as preferred editor</span>
<span class=nv>KUBE_EDITOR</span><span class=o>=</span>nano 
kubectl edit deploy nginx
<span class=c1># Nano Editor Shortcuts</span>

<span class=c1># Set Context and Namespace</span>
kubectl config set-context &lt;cluster&gt; --namespace<span class=o>=</span>myns <span class=c1># Copy this command in notepad and save time</span>
<span class=c1># Explain Commands</span>
<span class=c1># When is it useful: sometimes when editing/creating yaml files, it is not clear where exaclty rsource should be placed (indented) in the file. Using this command gives a quick overview of resources structure as well as helpful explanation. Sometimes this is faster then looking up in k8s docs.</span>
kubectl explain cronjob.spec.jobTemplate --recursive <span class=p>|</span> less
kubectl explain pods.spec.containers --recursive <span class=p>|</span> less

<span class=c1># Generators</span>
--restart
--dry-run

<span class=c1># Tip</span>
kubectl describe po      <span class=c1># Without po name, it will describe all pods which saves time in typing</span>
<span class=c1># If the edit to po is not saved, do a force replace</span>
<span class=c1># First exit the editor using q!, then execute the replace command</span>
kubectl replace --force -f /tmp/&lt;temp-file&gt;         <span class=c1># This is the temp location k8s stores the edit yaml</span>

kubectl run nginx --image<span class=o>=</span>nginx   <span class=c1># (deployment)</span>
kubectl run nginx --image<span class=o>=</span>nginx --restart<span class=o>=</span>Never   <span class=c1># (pod)</span>
kubectl create job nginx --image<span class=o>=</span>nginx --dry-run<span class=o>=</span>client -o yaml &gt; job.yml   <span class=c1>#(job)  </span>
kubectl create cronjob nginx --image<span class=o>=</span>nginx --dry-run<span class=o>=</span>client <span class=se>\</span>
    --schedule<span class=o>=</span><span class=s2>&quot;* * * * *&quot;</span> -o yaml &gt; cronjob.yml <span class=c1># (cronJob)</span>

kubectl run nginx -image<span class=o>=</span>nginx <span class=se>\</span>
    --restart<span class=o>=</span>Never <span class=se>\</span>
    --port<span class=o>=</span><span class=m>80</span> <span class=se>\</span>
    --namespace<span class=o>=</span>myname <span class=se>\</span>
    --serviceaccount<span class=o>=</span>mysa1 <span class=se>\</span>
    --env<span class=o>=</span><span class=nv>HOSTNAME</span><span class=o>=</span><span class=nb>local</span> <span class=se>\</span>
    --labels<span class=o>=</span><span class=nv>bu</span><span class=o>=</span>finance,env<span class=o>=</span>dev <span class=se>\ </span>
    --requests<span class=o>=</span><span class=s1>&#39;cpu=100m,memory=256Mi&#39;</span> <span class=se>\ </span>
    --limits<span class=o>=</span><span class=s1>&#39;cpu=200m,memory=512Mi&#39;</span> <span class=se>\</span>
    --dry-run -o yaml - /bin/sh -c <span class=s1>&#39;echo hello world&#39;</span> &gt; pod.yaml

kubectl create deployment frontend --replicas<span class=o>=</span><span class=m>2</span> <span class=se>\</span>
    --labels<span class=o>=</span><span class=nv>run</span><span class=o>=</span>load-balancer-example --image<span class=o>=</span>busybox  --port<span class=o>=</span><span class=m>8080</span>
kubectl expose deployment frontend --type<span class=o>=</span>NodePort --name<span class=o>=</span>frontend-service --port<span class=o>=</span><span class=m>6262</span> --target-port<span class=o>=</span><span class=m>8080</span> <span class=c1># OR</span>
kubectl create service clusterip my-cs --tcp<span class=o>=</span><span class=m>5678</span>:8080 --dry-run -o yaml 
kubectl <span class=nb>set</span> serviceaccount deployment frontend myuser


<span class=c1># If we specify two selectors separated by a comma, only the objects that satisfy both will be returned. This is a logical AND operation:</span>
kubectl get pods --selector<span class=o>=</span><span class=s2>&quot;bu=finance,env=dev&quot;</span>
<span class=c1># We can also ask if a label is one of a set of values. Here we ask for all pods where the app label is set to alpaca bandicoot (which will be all six pods):</span>
kubectl get pods --selector<span class=o>=</span><span class=s2>&quot;env in (dev,test)&quot;</span>

<span class=c1># Use of grep when selector filter doesnt work</span>
kubectl describe pods <span class=p>|</span> grep --context<span class=o>=</span><span class=m>10</span> annotations:
kubectl describe pods<span class=p>|</span> grep --context<span class=o>=</span><span class=m>10</span> Events:

<span class=c1># Check last 10 events on pod</span>
k describe pod &lt;pod-name&gt; <span class=p>|</span> grep -i events -A <span class=m>10</span>
<span class=c1># Determine proper api_group/version for a resource</span>
<span class=c1># When is it useful: after creating/modyfing pod or during troubleshooting exercise check quickly if there are no errors in pod</span>
k api-resources <span class=p>|</span> grep -i <span class=s2>&quot;resource name&quot;</span>
k api-versions <span class=p>|</span> grep -i <span class=s2>&quot;api_group name&quot;</span>
<span class=c1># Example:</span>
k api-resources <span class=p>|</span> grep -i deploy <span class=c1># -&gt; produces apps in APIGROUPS column</span>
k api-versions <span class=p>|</span> grep -i apps <span class=c1># -&gt; produces apps/v1</span>
<span class=c1># Quickly find kube api server setting</span>
<span class=c1># When is it useful: since on all the exams, kubernetes services are running as pods, it is faster to check settings with grep rather than move to folder and look at the file.</span>
ps -ef --forest <span class=p>|</span> grep kube-apiserver <span class=p>|</span> grep <span class=s2>&quot;search string&quot;</span>
<span class=c1># Example:</span>
ps -ef --forest <span class=p>|</span> grep kube-apiserver <span class=p>|</span> grep admission-plugins <span class=c1># -&gt; find admission plugins config</span>

<span class=c1># Use busybox for running utilities</span>
<span class=c1># When is it useful: this command will create temporary busybox pod. Full features of Busybox - https://busybox.net/downloads/BusyBox.html</span>
kubectl run -it --rm debug --image<span class=o>=</span>busybox --restart<span class=o>=</span>Never -- sh
<span class=c1># Verify pod connectivity</span>
<span class=c1># When it is useful: when making changes to a pod, it is very important to veryify if it works. One of the best ways to verify is to check pod connectivity. If successful this command will return a response.</span>
kubectl run -it --rm debug --image<span class=o>=</span>radial/busyboxplus:curl --restart<span class=o>=</span>Never -- curl http://servicename
<span class=c1># There is no way to add environment variable from a Secret or ConfigMap imperatively from CLI. So use the `--env SOMETHING=this --dry-run -o yaml` to generate a quick template then vim edit it to match the desired configuration. This is very useful considering you cannot copy-paste a whole yaml from documentation to the exam terminal.</span>

<span class=c1># Create k8s resource on the fly from copied YAML</span>
<span class=c1># When is it useful: sometimes it&#39;s quicker to just grab YAML from k8s documentation page and create a resource much quicker than writting YAML yourself</span>
cat <span class=s>&lt;&lt;EOF | kubectl create -f -</span>
<span class=s>&lt;YAML content goes here&gt;</span>
<span class=s>EOF</span>

<span class=c1># Command alternative: alternatively use </span>
cat &gt; filename.yaml <span class=o>[</span>enter<span class=o>]</span> <span class=o>[</span>Ctrl + Shift - to paste file content<span class=o>]</span> <span class=o>[</span>enter - adds one line to the file<span class=o>]</span> <span class=o>[</span>Ctrl + C - exit<span class=o>]</span> <span class=c1># after that use vim/nano to edit the file and create resource based on it</span>

<span class=c1># Save time on editing and re-creating running pods.</span>
<span class=c1># During the exams you are often asked to change existing pod spec. This usually requires:</span>

<span class=c1># 1. saving pod config as yaml file</span>
kubectl get po &lt;pod name&gt; &lt;optional -n namespace&gt; -o yaml &gt; &lt;filename&gt;.yaml
<span class=c1># check if file was correctly saves</span>
cat &lt;filename&gt;.yaml
<span class=c1># 2. deleting existing pod</span>
kubectl delete po &lt;pod name&gt; &lt;optional -n namespace&gt; --wait<span class=o>=</span><span class=nb>false</span>
<span class=c1># 3. editing the file and making required changes</span>
vim &lt;or nano&gt; &lt;filename&gt;.yaml
<span class=c1># 4. creating new pod from the file</span>
kubectl create -f &lt;filename&gt;.yaml
<span class=c1># The other template to remember is that of a Pod. It is especially useful for creating Static Pods on other Nodes.</span>

<span class=c1># Do not skip the part about jsonpath thinking that it is too easy to come in the exam. Remember that jsonpath is required for sorting output and custom columns.</span>

<span class=c1># Unix Bash one-liners</span>

<span class=c1>#if-else</span>
<span class=nv>a</span><span class=o>=</span><span class=m>10</span><span class=p>;</span><span class=nv>b</span><span class=o>=</span><span class=m>5</span><span class=p>;</span><span class=k>if</span><span class=o>[</span><span class=nv>$a</span> -le <span class=nv>$b</span><span class=o>]</span><span class=p>;</span><span class=k>then</span> <span class=nb>echo</span> <span class=s2>&quot;a is small&quot;</span><span class=p>;</span><span class=k>else</span> <span class=nb>echo</span> <span class=s2>&quot;b is small&quot;</span><span class=p>;</span><span class=k>fi</span>
<span class=c1># while</span>
<span class=nv>x</span><span class=o>=</span><span class=m>1</span><span class=p>;</span><span class=k>while</span> <span class=o>[</span><span class=nv>$x</span> -le <span class=m>10</span><span class=o>]</span><span class=p>;</span> <span class=k>do</span> <span class=nb>echo</span> <span class=s2>&quot;welcome </span><span class=nv>$x</span><span class=s2> times&quot;</span><span class=p>;</span><span class=nv>x</span><span class=o>=</span><span class=k>$((</span>x+1<span class=k>))</span><span class=p>;</span><span class=k>done</span>
<span class=c1># for</span>
<span class=nv>PODS</span><span class=o>=</span><span class=k>$(</span>kubectl get pods -o jsonpath -template<span class=o>=</span><span class=s1>&#39;{.items[*].metadata.name}&#39;</span><span class=k>)</span>
<span class=k>for</span> x <span class=k>in</span> <span class=nv>$PODS</span><span class=p>;</span> <span class=k>do</span>
  kubectl delete pods <span class=si>${</span><span class=nv>x</span><span class=si>}</span>
  sleep <span class=m>60</span>
<span class=k>done</span>

<span class=c1># Examples</span>
args: <span class=o>[</span><span class=s2>&quot;-c&quot;</span>, <span class=s2>&quot;while true;do date &gt;&gt; /var/log/app.txt;sleep 5;done&quot;</span><span class=o>]</span>
args: <span class=o>[</span>/bin/sh, -c,<span class=s1>&#39;i=0; while true; do echo &quot;$i:$(date)&quot;;i=$((i+1))&quot;;sleep 1;done&#39;</span><span class=o>]</span>
args: <span class=o>[</span><span class=s2>&quot;-c&quot;</span>, <span class=s2>&quot;mkdir -p collect;while true;do cat /var/data/* &gt; /collect/data.txt;sleep 5;done&quot;</span><span class=o>]</span>

<span class=c1># Create file with implicit commands</span>
kubectl run busybox --image<span class=o>=</span>busybox --dry-run<span class=o>=</span>client -o yaml --restart<span class=o>=</span>Never &gt; yamlfile.yaml
kubectl create job my-job --dry-run<span class=o>=</span>client -o yaml --image<span class=o>=</span>busybox -- date  &gt; yamlfile.yaml
kubectl get deploy/nginx -o yaml &gt; <span class=m>1</span>.yaml

kubectl run wordpress --image<span class=o>=</span>wordpress --expose --port<span class=o>=</span><span class=m>8989</span> --restart<span class=o>=</span>Never -o yaml
<span class=c1># Command shouls always at the end and all kubectl options before this</span>
kubectl run <span class=nb>test</span> --image<span class=o>=</span>busybox --restart<span class=o>=</span>Never --dry-run<span class=o>=</span>client -o yaml -- /bin/sh -c <span class=s1>&#39;echo test;sleep 100&#39;</span> &gt; yamlfile.yaml 
<span class=c1># OR</span>
kubectl run <span class=nb>test</span> --image<span class=o>=</span>busybox --restart<span class=o>=</span>Never --dry-run<span class=o>=</span>client -o yaml -- <span class=nb>command</span> sleep <span class=m>1000</span> &gt; yamlfile.yaml

<span class=c1># (Notice that -- /bin/sh comes at the end. This will create yaml file.)</span>
kubectl run busybox --image<span class=o>=</span>busybox --dry-run<span class=o>=</span>client -o yaml --restart<span class=o>=</span>Never -- /bin/sh -c <span class=s2>&quot;while true; do echo hello; echo hello again;done&quot;</span> &gt; pod.yaml


<span class=c1># Test script to check if the application is live behind a service and is loadbalancing.</span>
<span class=c1># A curl pod is running in kube-public namespace for testing</span>
<span class=k>for</span> i <span class=k>in</span> <span class=o>{</span><span class=m>1</span>..20<span class=o>}</span><span class=p>;</span> <span class=k>do</span>
   kubectl <span class=nb>exec</span> --namespace<span class=o>=</span>kube-public curl -- sh -c <span class=s1>&#39;test=`wget -qO- -T 2  http://webapp-service.default.svc.cluster.local:8080/ready 2&gt;&amp;1` &amp;&amp; echo &quot;$test OK&quot; || echo &quot;Failed&quot;&#39;</span><span class=p>;</span>
   <span class=nb>echo</span> <span class=s2>&quot;&quot;</span>
<span class=k>done</span>
</code></pre></div></li> </ul> <p><div class=highlight><pre><span></span><code><span class=c1># Type the above command and hit enter, Linux will substitute the namespace and rerun the get pods command</span>
<span class=c1>#################</span>
    <span class=nb>alias</span> <span class=nv>k</span><span class=o>=</span><span class=s1>&#39;kubectl&#39;</span>
    <span class=nb>alias</span> <span class=nv>kc</span><span class=o>=</span><span class=s1>&#39;k config view --minify | grep name&#39;</span>
    <span class=c1># Many pods are created to save time when you go wrong during the exam</span>
    <span class=nb>alias</span> <span class=nv>kpd</span><span class=o>=</span><span class=s1>&#39;k delete pod --force --grace-period=0&#39;</span>  
    <span class=nb>alias</span> <span class=nv>kdp</span><span class=o>=</span><span class=s1>&#39;kubectl describe pod&#39;</span>
    <span class=nb>alias</span> <span class=nv>krh</span><span class=o>=</span><span class=s1>&#39;kubectl run --help | more&#39;</span>
    <span class=nb>alias</span> <span class=nv>kgh</span><span class=o>=</span><span class=s1>&#39;kubectl get --help | more&#39;</span>
    <span class=nb>alias</span> <span class=nv>c</span><span class=o>=</span><span class=s1>&#39;clear&#39;</span>
    <span class=nb>alias</span> <span class=nv>kd</span><span class=o>=</span><span class=s1>&#39;kubectl describe&#39;</span>
    <span class=nb>alias</span> <span class=nv>ke</span><span class=o>=</span><span class=s1>&#39;kubectl explain&#39;</span>
    <span class=nb>alias</span> <span class=nv>kf</span><span class=o>=</span><span class=s1>&#39;kubectl create -f&#39;</span>
    <span class=nb>alias</span> <span class=nv>kg</span><span class=o>=</span><span class=s1>&#39;kubectl get pods --show-labels&#39;</span>
    <span class=nb>alias</span> <span class=nv>kr</span><span class=o>=</span><span class=s1>&#39;kubectl replace -f&#39;</span>
    <span class=nb>alias</span> <span class=nv>kh</span><span class=o>=</span><span class=s1>&#39;kubectl --help | more&#39;</span>
    <span class=nb>alias</span> <span class=nv>krh</span><span class=o>=</span><span class=s1>&#39;kubectl run --help | more&#39;</span>
    <span class=nb>alias</span> <span class=nv>kgn</span><span class=o>=</span><span class=s1>&#39;kubectl get namespaces&#39;</span>
    <span class=nb>alias</span> <span class=nv>l</span><span class=o>=</span><span class=s1>&#39;ls -lrt&#39;</span>
    <span class=nb>alias</span> <span class=nv>ll</span><span class=o>=</span><span class=s1>&#39;vi ls -rt | tail -1&#39;</span>
    <span class=nb>alias</span> <span class=nv>kga</span><span class=o>=</span><span class=s1>&#39;k get pod --all-namespaces&#39;</span>
    <span class=nb>alias</span> <span class=nv>kgaa</span><span class=o>=</span><span class=s1>&#39;kubectl get all --show-labels&#39;</span>

<span class=c1># Viewing resource utilization</span>
kubectl top node
kubectl top pod
watch kubectl top node -n <span class=m>5</span>     <span class=c1># Runs the command every 5 sec</span>
</code></pre></div> - <a href=https://github.com/mmumshad/kubernetes-the-hard-way>Linux Hard Way Mummshad</a> - Kubernetes the Hard Way</p> <h2 id=tools-used>Tools used<a class=headerlink href=#tools-used title="Permanent link">&para;</a></h2> <ul> <li>vim</li> <li>kubectl</li> <li>kubeadm</li> <li>systemctl &amp; journalctl</li> <li>nslookup</li> </ul> <h3 id=vim><a href=../../ide/vim/ >Vim</a><a class=headerlink href=#vim title="Permanent link">&para;</a></h3> <h2 id=general-tips>General Tips<a class=headerlink href=#general-tips title="Permanent link">&para;</a></h2> <ol> <li>Flag Questions You Can’t Immediately Answer</li> </ol> <p>The exam environment comes with built-in flagging functionality. If you read a question that you don’t immediately know how to answer, flag it. Flagged questions will be highlighted in your question list, allowing you to return to them quickly once you’ve finished answering the ones you’re comfortable with.</p> <ol> <li>Keep Score</li> </ol> <p>Along with flagging capabilities, the exam provides you with a built-in notepad. Make use of the notepad to keep a running tally of questions you’ve answered and their percentage value (this number is given to you with each question). </p> <ul> <li>Format of scoring Question Number %weight Total</li> </ul> <p>I like to keep a list of the questions I haven’t answered and their associated percentages too. It’s a good way to inform how you should prioritise your time, particularly towards the end of the exam. If you're cutting it fine with the 74% pass mark, your time is probably better spent on a 7% question, than a 2% one.</p> <ol> <li>Save YAML Files by Question Number</li> </ol> <p>If you have to create a YAML file when answering a question, for example a Pod config file, make sure you name the file according to the question number.</p> <ol> <li> <p>I rely heavily on a solid muscle memory for all commands. The most atomic part of a cluster is a Pod so creating one through <code>kubectl run --generator=run-pod/v1 nginx --image nginx</code> should be out under 10 seconds or so.</p> </li> <li> <p>Even though the exam allows you to copy-paste content from the official documentation, it has a limit of 2-3 lines so I had to be prepared to &ndash;dry-run -o yaml &gt; q2.yaml each time and edit the file as per the question.</p> </li> <li> <p>Useful commands <div class=highlight><pre><span></span><code><span class=c1># list running processes</span>
$ ps -aux

<span class=c1># search for string in the output</span>
$ ps -aux <span class=p>|</span> grep -i <span class=s1>&#39;string&#39;</span> 

<span class=c1># search for multiple expressions in the output (exp can be plain a string too)</span>
$ ps -aux <span class=p>|</span> grep -e <span class=s1>&#39;exp-one&#39;</span> -e <span class=s1>&#39;exp-two&#39;</span>

<span class=c1># get details about network interfaces</span>
$ ifconfig

<span class=c1># list network interfaces and their IP address</span>
$ ip a

<span class=c1># get the route details</span>
$ ip r

<span class=c1># check service status and also show logs</span>
$ systemctl status kubelet

<span class=c1># restart a service</span>
$ systemctl restart kubelet

<span class=c1># reload the service daemon, if you changed the service file</span>
$ systemctl daemon reload

<span class=c1># detailed logs of the service</span>
$ journalctl -u kubelet

<span class=c1># list out ports, protocol and what processes are listening on those ports</span>
$ netstat -tunlp <span class=c1>#-tupan</span>
</code></pre></div></p> </li> </ol> <h2 id=troubleshooting-tips>Troubleshooting Tips<a class=headerlink href=#troubleshooting-tips title="Permanent link">&para;</a></h2> <ul> <li>What is the scope of the issue? &gt; Entire Custer &gt; User &gt; Pod &gt; Service</li> <li>How Long the issue has been going on?</li> <li> <p>What can be done to reproduce the issue?</p> </li> <li> <p>Establish a Probable cause. Develop a Hypothesis &rarr; &gt; Clue 1 &gt; + Clue 2 &gt; + Kubernetes Knowledge ======================== Probable Cause</p> </li> <li> <p>Experiment - Test your Hypothesis</p> </li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2022 - Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing"}, "version": null}</script> <script src=../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>