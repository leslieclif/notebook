<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Leslie><link href=https://leslieclif.github.io/notebook/k8s/4-api/ rel=canonical><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-7.0.3"><title>Example Apps to run on K8s - Leslie's Online Notebook</title><link rel=stylesheet href=../../assets/stylesheets/main.1655a90d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.7fa14f5b.min.css><script src=../../assets/extra.js type=text/javascript></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/extra.css></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-blue data-md-color-accent=yellow> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#example-apps-to-run-on-k8s class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-header__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Leslie's Online Notebook </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Example Apps to run on K8s </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </a> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </a> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://leslieclif.github.io/notebook/ title="Leslie's Online Notebook" class="md-nav__button md-logo" aria-label="Leslie's Online Notebook"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> Leslie's Online Notebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../developer/ class=md-nav__link> Developer Setup </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> IDE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDE data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> IDE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ide/ class=md-nav__link> IDE Tips and Tricks </a> </li> <li class=md-nav__item> <a href=../../ide/markdown/ class=md-nav__link> Markdown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../server/ class=md-nav__link> Server Details </a> </li> <li class=md-nav__item> <a href=../../server/install/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../server/mobile/ class=md-nav__link> Mobile </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Ansible <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ansible data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Ansible </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learning/ansible/ansible/ class=md-nav__link> Ansible </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../install/ class=md-nav__link> Installation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Learning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Learning data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Learning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learning/git/ class=md-nav__link> Git </a> </li> <li class=md-nav__item> <a href=../../learning/python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../learning/vagrant/ class=md-nav__link> Vagrant </a> </li> <li class=md-nav__item> <a href=../../learning/terraform/ class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=../../learning/docker/docker-notes/ class=md-nav__link> Docker </a> </li> <li class=md-nav__item> <a href=../../learning/k8s/k8s-notes/ class=md-nav__link> Kubernetes </a> </li> <li class=md-nav__item> <a href=../../learning/linux/linux/ class=md-nav__link> Linux </a> </li> <li class=md-nav__item> <a href=../../learning/linux/security/ class=md-nav__link> Linux_Security </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Devops <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Devops data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Devops </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../devops/ class=md-nav__link> Index </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#example-apps-to-run-on-k8s class=md-nav__link> Example Apps to run on K8s </a> </li> <li class=md-nav__item> <a href=#kubernetes-api class=md-nav__link> Kubernetes API </a> </li> <li class=md-nav__item> <a href=#api-via-command-line class=md-nav__link> API via Command Line </a> <nav class=md-nav aria-label="API via Command Line"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#proxy class=md-nav__link> Proxy </a> </li> <li class=md-nav__item> <a href=#api-resources class=md-nav__link> API-Resources </a> </li> <li class=md-nav__item> <a href=#explaining-resources class=md-nav__link> Explaining Resources </a> </li> <li class=md-nav__item> <a href=#describe class=md-nav__link> Describe </a> </li> <li class=md-nav__item> <a href=#cluster-components class=md-nav__link> Cluster Components </a> </li> <li class=md-nav__item> <a href=#contexts class=md-nav__link> Contexts </a> </li> <li class=md-nav__item> <a href=#labeling-and-annotating-objects class=md-nav__link> Labeling and Annotating Objects </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kubectl-label-pods-bar-colorredenvdev---------add-label-bydefaultlabelandannotatewill-not-let-you-overwrite-an-existing-label-to-do-this-you-need-to-add-the--overwriteflag-remove-a-label-you-can-use-the-label-namesyntaxkubectl-label-pods-bar-color-kubectl-get-pods---show-labelskubectl-get-pods--l-labels-------------l-adds-a-custom-column-called-labels-in-tablular-outputkubectl-get-pods---selectorenvdev-if-we-specify-two-selectors-separated-by-a-comma-only-the-objects-that-satisfy-both-will-be-returned-this-is-a-logical-and-operationkubectl-get-pods---selectorcolorredenvdevkubectl-label-deployments-alpaca-test-canarytruekubectl-get-deployments---show-labels class=md-nav__link> kubectl label pods bar color=red,env=dev # Add Label # By default, label and annotate will not let you overwrite an existing label. To do this, you need to add the `--overwrite` flag # Remove a label, you can use the -&lt;label-name&gt; syntax kubectl label pods bar color- kubectl get pods --show-labels kubectl get pods -L labels # L adds a custom column called labels in tablular output kubectl get pods --selector=&quot;env=dev&quot; # If we specify two selectors separated by a comma, only the objects that satisfy both will be returned. This is a logical AND operation: kubectl get pods --selector=&quot;color=red,env=dev&quot; kubectl label deployments alpaca-test &quot;canary=true&quot; kubectl get deployments --show-labels </a> <nav class=md-nav aria-label='kubectl label pods bar color=red,env=dev        # Add Label
# By default, label and annotate will not let you overwrite an existing label. To do this, you need to add the `--overwrite` flag
# Remove a label, you can use the -<label-name> syntax
kubectl label pods bar color-
kubectl get pods --show-labels
kubectl get pods -L labels            # L adds a custom column called labels in tablular output
kubectl get pods --selector="env=dev"
# If we specify two selectors separated by a comma, only the objects that satisfy both will be returned. This is a logical AND operation:
kubectl get pods --selector="color=red,env=dev"
kubectl label deployments alpaca-test "canary=true"
kubectl get deployments --show-labels
'> <ul class=md-nav__list> <li class=md-nav__item> <a href=#operator--------------------description class=md-nav__link> Operator Description </a> </li> <li class=md-nav__item> <a href=#debugging-commands class=md-nav__link> Debugging Commands </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#replacing-objects class=md-nav__link> Replacing Objects </a> </li> <li class=md-nav__item> <a href=#pods class=md-nav__link> Pods </a> </li> <li class=md-nav__item> <a href=#service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=#replicasets class=md-nav__link> ReplicaSets </a> <nav class=md-nav aria-label=ReplicaSets> <ul class=md-nav__list> <li class=md-nav__item> <a href=#finding-a-replicaset-from-a-pod class=md-nav__link> Finding a ReplicaSet from a Pod </a> </li> <li class=md-nav__item> <a href=#finding-a-set-of-pods-for-a-replicaset class=md-nav__link> Finding a Set of Pods for a ReplicaSet </a> </li> <li class=md-nav__item> <a href=#scaling-replicasets class=md-nav__link> Scaling ReplicaSets </a> </li> <li class=md-nav__item> <a href=#horizontal-pod-autoscalinghpa class=md-nav__link> Horizontal Pod Autoscaling (HPA) </a> </li> <li class=md-nav__item> <a href=#deleting-replicasets class=md-nav__link> Deleting ReplicaSets </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#daemonsets class=md-nav__link> DaemonSets </a> </li> <li class=md-nav__item> <a href=#jobs class=md-nav__link> Jobs </a> </li> <li class=md-nav__item> <a href=#configmaps class=md-nav__link> ConfigMaps </a> </li> <li class=md-nav__item> <a href=#secrets class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=#deployments class=md-nav__link> Deployments </a> <nav class=md-nav aria-label=Deployments> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment-strategies class=md-nav__link> Deployment strategies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ingress class=md-nav__link> Ingress </a> </li> <li class=md-nav__item> <a href=#statefulsets class=md-nav__link> StatefulSets </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Example Apps to run on K8s</h1> <h2 id=example-apps-to-run-on-k8s>Example Apps to run on K8s<a class=headerlink href=#example-apps-to-run-on-k8s title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/kubernetes-up-and-running/kuard>Kuard</a></li> <li><a href=https://kubectl.docs.kubernetes.io/references/kubectl/ >Kubectl Book</a></li> </ul> <h2 id=kubernetes-api>Kubernetes API<a class=headerlink href=#kubernetes-api title="Permanent link">&para;</a></h2> <ul> <li>The Kubernetes API is a RESTful API based on HTTP and JSON and provided by an API server. All of the components in Kubernetes communicate through the API. </li> <li><strong>Basic Objects</strong>: Pods, ReplicaSets, and Services</li> <li><strong>STORAGE</strong>: PERSISTENT VOLUMES, CONFIGMAPS, AND SECRETS</li> <li><strong>Organizing Your Cluster</strong> with Namespaces, Labels, and Annotations</li> <li><strong>Advanced Concepts</strong>: Deployments, Ingress, and StatefulSets</li> </ul> <h2 id=api-via-command-line>API via Command Line<a class=headerlink href=#api-via-command-line title="Permanent link">&para;</a></h2> <p><div class=highlight><pre><span></span><code><span class=c1># reveal all the API resources</span>
kubectl get --raw /
<span class=c1># At the top of this list is v1 and under that is namespaces, so request the namespaces</span>
kubectl get --raw /api/v1/namespaces
<span class=c1># One of the namespaces is called default, so request details on the default namespace</span>
kubectl get --raw /api/v1/namespaces/default
<span class=c1># jq is like sed for JSON data. Using jq can make the JSON output from kubectl much easier to read with syntax highlighting.</span>
kubectl get --raw /api/v1/namespaces/default <span class=p>|</span> jq .
<span class=c1># There is also a Python json.tool</span>
kubectl get -v<span class=o>=</span><span class=m>9</span> --raw /api/v1/namespaces/default <span class=p>|</span> python -m json.tool
</code></pre></div> - These are all the versions behind the API root path /apis/. In the version list, most of the lines are composed of two parts separated with a slash (/). The left token is the API Group and the right side is the version in that group. - Such as: <code>batch/v1</code> and <code>batch/v1beta</code></p> <h3 id=proxy>Proxy<a class=headerlink href=#proxy title="Permanent link">&para;</a></h3> <p>There is a proxy command that will allow you to access the cluster via localhost. This proxy will run in the background. <div class=highlight><pre><span></span><code>kubectl proxy <span class=m>8001</span> &gt; /dev/null <span class=p>&amp;</span>
<span class=c1># Hit Enter to ensure you get the shell prompt back.</span>
<span class=c1># With this proxy you can access the Kubernetes API locally at the specified port.</span>
curl localhost:8001
curl localhost:8001/api/v1/namespaces/default <span class=p>|</span> jq .
<span class=c1># if you want to stop the proxy, use the command fg to move the proxy to the foregound and then exit the proxy</span>
</code></pre></div> - The easiest way to “access a terminal” within a namespace is to launch a pod with an interactive terminal inside the desired namespace. <div class=highlight><pre><span></span><code>kubectl run curl --namespace <span class=nv>$SESSION_NAMESPACE</span> --image<span class=o>=</span>radial/busyboxplus:curl -i --tty --rm --overrides<span class=o>=</span><span class=s1>&#39;{&quot;spec&quot;: { &quot;securityContext&quot;: { &quot;runAsUser&quot;: 1000 }}}&#39;</span>
</code></pre></div></p> <h3 id=api-resources>API-Resources<a class=headerlink href=#api-resources title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Get a list of api-resources</span>
kubectl api-resources
<span class=c1># Most resources are associated with Namespaces, however, some cluster scope resources do not make sense to be associated with a Namespace. </span>
<span class=c1># List the cluster scoped resources</span>
kubectl api-resources --namespaced<span class=o>=</span><span class=nb>false</span>
<span class=c1># As you can see, resources like PersistentVolumes are scoped at the cluster level and not associated with Namespaces.</span>
<span class=c1># Most of the api-resources are grouped. </span>
<span class=c1># For instance, the two job types are grouped in the batch group.</span>
kubectl api-resources --api-group<span class=o>=</span>batch
<span class=c1># Check Permissions on the User</span>
kubectl auth can-i --list
</code></pre></div> <h3 id=explaining-resources>Explaining Resources<a class=headerlink href=#explaining-resources title="Permanent link">&para;</a></h3> <ul> <li>The Explain command is a great way to understand the defined structure of a resource or kind. <div class=highlight><pre><span></span><code>kubectl explain ns
<span class=c1># To get the full structure of this kind, use the --recursive flag</span>
kubectl explain ns --recursive
<span class=c1># Notice the status field phase. Let&#39;s display that as an output</span>
kubectl get ns -o custom-columns<span class=o>=</span>NAME:.metadata.name,PHASE:.status.phase
</code></pre></div></li> </ul> <h3 id=describe>Describe<a class=headerlink href=#describe title="Permanent link">&para;</a></h3> <ul> <li>Don't confuse the <code>Explain</code> command with the <code>Describe</code> command. </li> <li>While <strong>Explain</strong> reports on the type of the resource, <strong>Describe</strong> reports the details of the instance of a resource. <div class=highlight><pre><span></span><code>kubectl describe namespace kube-system
</code></pre></div></li> </ul> <h3 id=cluster-components>Cluster Components<a class=headerlink href=#cluster-components title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># Kubernetes proxy is responsible for routing network traffic to load-balanced services in the Kubernetes cluster. To do its job, the proxy must be present on every node in the cluster. </span>
kubectl get daemonSets --namespace<span class=o>=</span>kube-system kube-proxy
<span class=c1># Kubernetes also runs a DNS server, which provides naming and discovery for the services that are defined in the cluster. Can be replaced by coredns</span>
kubectl get deployments --namespace<span class=o>=</span>kube-system kube-dns <span class=o>[</span>coredns<span class=o>]</span>
<span class=c1># Kubernetes service that performs load-balancing for the DNS server.</span>
kubectl get services --namespace<span class=o>=</span>kube-system kube-dns 
</code></pre></div> <h3 id=contexts>Contexts<a class=headerlink href=#contexts title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># creates a new context, but it doesn’t actually start using it yet. </span>
kubectl config set-context my-context --namespace<span class=o>=</span>mystuff
<span class=c1># use this newly created context</span>
kubectl config use-context my-context
<span class=c1># Contexts can also be used to manage different clusters or different users for authenticating to those clusters using the --users or --clusters flags with the set-context command.</span>
</code></pre></div> <h3 id=labeling-and-annotating-objects>Labeling and Annotating Objects<a class=headerlink href=#labeling-and-annotating-objects title="Permanent link">&para;</a></h3> <h2 id=kubectl-label-pods-bar-colorredenvdev---------add-label-bydefaultlabelandannotatewill-not-let-you-overwrite-an-existing-label-to-do-this-you-need-to-add-the--overwriteflag-remove-a-label-you-can-use-the-label-namesyntaxkubectl-label-pods-bar-color-kubectl-get-pods---show-labelskubectl-get-pods--l-labels-------------l-adds-a-custom-column-called-labels-in-tablular-outputkubectl-get-pods---selectorenvdev-if-we-specify-two-selectors-separated-by-a-comma-only-the-objects-that-satisfy-both-will-be-returned-this-is-a-logical-and-operationkubectl-get-pods---selectorcolorredenvdevkubectl-label-deployments-alpaca-test-canarytruekubectl-get-deployments---show-labels><div class=highlight><pre><span></span><code>kubectl label pods bar <span class=nv>color</span><span class=o>=</span>red,env<span class=o>=</span>dev        <span class=c1># Add Label</span>
<span class=c1># By default, label and annotate will not let you overwrite an existing label. To do this, you need to add the `--overwrite` flag</span>
<span class=c1># Remove a label, you can use the -&lt;label-name&gt; syntax</span>
kubectl label pods bar color-
kubectl get pods --show-labels
kubectl get pods -L labels            <span class=c1># L adds a custom column called labels in tablular output</span>
kubectl get pods --selector<span class=o>=</span><span class=s2>&quot;env=dev&quot;</span>
<span class=c1># If we specify two selectors separated by a comma, only the objects that satisfy both will be returned. This is a logical AND operation:</span>
kubectl get pods --selector<span class=o>=</span><span class=s2>&quot;color=red,env=dev&quot;</span>
kubectl label deployments alpaca-test <span class=s2>&quot;canary=true&quot;</span>
kubectl get deployments --show-labels
</code></pre></div><a class=headerlink href=#kubectl-label-pods-bar-colorredenvdev---------add-label-bydefaultlabelandannotatewill-not-let-you-overwrite-an-existing-label-to-do-this-you-need-to-add-the--overwriteflag-remove-a-label-you-can-use-the-label-namesyntaxkubectl-label-pods-bar-color-kubectl-get-pods---show-labelskubectl-get-pods--l-labels-------------l-adds-a-custom-column-called-labels-in-tablular-outputkubectl-get-pods---selectorenvdev-if-we-specify-two-selectors-separated-by-a-comma-only-the-objects-that-satisfy-both-will-be-returned-this-is-a-logical-and-operationkubectl-get-pods---selectorcolorredenvdevkubectl-label-deployments-alpaca-test-canarytruekubectl-get-deployments---show-labels title="Permanent link">&para;</a></h2> <h3 id=operator--------------------description>Operator Description<a class=headerlink href=#operator--------------------description title="Permanent link">&para;</a></h3> <p>key=value key is set to value key!=value key is not set to value key in (value1, value2) key is one of value1 or value2 key notin (value1, value2) key is not one of value1 or value2 key key is set !key key is not set</p> <ul> <li>Filter output using jq <code>kubectl get pods -n kube-system calico -ojson | jq .metadata.labels</code></li> </ul> <h3 id=debugging-commands>Debugging Commands<a class=headerlink href=#debugging-commands title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>kubectl logs &lt;pod-name&gt;                  
<span class=c1># If you have multiple containers in your pod you can choose the container to view using the -c flag.</span>
<span class=c1># If you instead want to continuously stream the logs back to the terminal without exiting, you can add the -f (follow) command-line flag.</span>
<span class=c1># Adding the --previous flag will get logs from a previous instance of the container. This is useful, for example, if your containers are continuously restarting due to a problem at container startup.</span>

<span class=c1># Use the exec command to execute a command in a running container</span>
kubectl <span class=nb>exec</span> -it &lt;pod-name&gt; -- bash

<span class=c1># copy files to and from a container using the cp command</span>
kubectl cp &lt;pod-name&gt;:/path/to/remote/file /path/to/local/file
<span class=c1># You can also specify directories, or reverse the syntax to copy a file from your local machine back out into the container.</span>

<span class=c1># A secure tunnel is created from your local machine, through the Kubernetes master, to the instance of the Pod running on one of the worker nodes.</span>
kubectl port-forward nginx <span class=m>80</span>:8080
</code></pre></div> <h2 id=replacing-objects>Replacing Objects<a class=headerlink href=#replacing-objects title="Permanent link">&para;</a></h2> <ul> <li>Download Deployment or any object into a YAML file and then use the replace command</li> <li>Adding <code>--save-config</code> adds an annotation so that, when applying changes in the future, kubectl will know what the last applied configuration was for smarter merging of configs. <div class=highlight><pre><span></span><code>kubectl get deployments nginx --export -o yaml &gt; nginx-deployment.yaml
kubectl replace -f nginx-deployment.yaml --save-config
</code></pre></div></li> </ul> <h2 id=pods>Pods<a class=headerlink href=#pods title="Permanent link">&para;</a></h2> <ul> <li>In general, the right question to ask yourself when designing Pods is, “Will these containers work correctly if they land on different machines?” If the answer is “no,” a Pod is the correct grouping for the containers. If the answer is “yes,” multiple Pods is probably the correct solution. </li> <li><strong>Declarative configuration</strong> means that you write down the desired state of the world in a configuration and then submit that configuration to a service that takes actions to ensure the desired state becomes the actual state.</li> <li><strong>Imperative configuration</strong>, where you simply take a series of actions (e.g., apt-get install foo) to modify the world. </li> <li>Years of production experience have taught us that maintaining a written record of the system’s desired state leads to a more manageable, reliable system. </li> <li>Pod manifests can be written using YAML or JSON, but YAML is generally preferred because it is slightly more human-editable and has the ability to add comments. </li> <li>All Pods have a termination grace period. By default, this is 30 seconds. </li> <li><strong>Liveness</strong> health checks run application-specific logic (e.g., loading a web page) to verify that the application is not just still running, but is functioning properly. </li> <li><strong>Readiness</strong> describes when a container is ready to serve user requests. Containers that fail readiness checks are removed from service load balancers. </li> <li>What probe type (liveness/readiness) should be used for each and what handler should be used (TCP, HTTP, EXEC)? Figure out which ones to use? </li> <li>Port Check - Liveness using TCP handler</li> <li>DB Query - Readiness using an EXEC handler executing a SQL query</li> <li><strong>“request”</strong> specifies a minimum. It does not specify a maximum cap on the resources a Pod may use. </li> <li>If a container is over its memory request, the OS can’t just remove memory from the process, because it’s been allocated. Consequently, when the system runs out of memory, the <code>kubelet</code> terminates containers whose memory usage is greater than their requested memory. These containers are automatically restarted, but with less available memory on the machine for the container to consume.</li> <li><strong>"limits"</strong> specifies a maximum cap on the resources a Pod may use.</li> <li>When you establish limits on a container, the kernel is configured to ensure that consumption cannot exceed these limits. A container with a CPU limit of 0.5 cores will only ever get 0.5 cores, even if the CPU is otherwise idle. A container with a memory limit of 256 MB will not be allowed additional memory.</li> <li><strong>Labels</strong>  selectors are used to filter Kubernetes objects based on a set of labels. </li> <li><strong>Annotations</strong> provide a place to store additional metadata for Kubernetes objects with the sole purpose of assisting tools and libraries. </li> <li>Annotations can be used for the tool itself or to pass configuration information between external systems.</li> <li>There is overlap with labels, and it is a matter of taste as to when to use an annotation or a label. </li> <li>When in doubt, add information to an object as an <strong>annotation</strong> and promote it to a label if you find yourself wanting to use it in a selector.</li> <li>During rolling deployments, annotations are used to track rollout status and provide the necessary information required to roll back a deployment to a previous state. <div class=highlight><pre><span></span><code>
</code></pre></div></li> </ul> <h2 id=service>Service<a class=headerlink href=#service title="Permanent link">&para;</a></h2> <ul> <li>Real service discovery in Kubernetes starts with a Service object. <div class=highlight><pre><span></span><code>kubectl run alpaca-prod <span class=se>\</span>
  --image<span class=o>=</span>gcr.io/kuar-demo/kuard-amd64:1 <span class=se>\</span>
  --replicas<span class=o>=</span><span class=m>3</span> <span class=se>\</span>
  --port<span class=o>=</span><span class=m>8080</span> <span class=se>\</span>
  --labels<span class=o>=</span><span class=s2>&quot;ver=1,app=alpaca,env=prod&quot;</span>
kubectl expose deployment alpaca-prod
kubectl run bandicoot-prod <span class=se>\</span>
  --image<span class=o>=</span>gcr.io/kuar-demo/kuard-amd64:2 <span class=se>\</span>
  --replicas<span class=o>=</span><span class=m>2</span> <span class=se>\</span>
  --port<span class=o>=</span><span class=m>8080</span> <span class=se>\</span>
  --labels<span class=o>=</span><span class=s2>&quot;ver=2,app=bandicoot,env=prod&quot;</span>
kubectl expose deployment bandicoot-prod
kubectl get services -o wide
</code></pre></div></li> <li>After running these commands, we have three services. The ones we just created are alpaca-prod and bandicoot-prod.</li> <li>The kubernetes service is automatically created for you so that you can find and talk to the Kubernetes API from within the app.</li> <li><strong>Endpoints</strong> are a lower-level way of finding what a service is sending traffic to. <div class=highlight><pre><span></span><code>kubectl get endpoints alpaca-prod --watch
</code></pre></div></li> <li>At some point, we have to allow new traffic in! The most portable way to do this is to use a feature called <strong>NodePorts</strong>. You use the NodePort without knowing where any of the Pods for that service are running. <div class=highlight><pre><span></span><code>kubectl expose deployment alpaca-prod --type<span class=o>=</span>NodePort
kubectl describe svc alpaca-prod  <span class=c1># Assume Port 32711 is assigned</span>
<span class=c1>#  If your cluster is in the cloud someplace, you can use SSH tunneling with something like this:</span>
ssh &lt;node&gt; -L <span class=m>8080</span>:localhost:32711
<span class=c1># Now if you open your browser to http://localhost:8080 you will be connected to that service. </span>
</code></pre></div></li> </ul> <h2 id=replicasets>ReplicaSets<a class=headerlink href=#replicasets title="Permanent link">&para;</a></h2> <ul> <li>A ReplicaSet acts as a cluster-wide Pod manager, ensuring that the right types and number of Pods are running at all times.</li> <li>When we define a ReplicaSet, we define a specification for the Pods we want to create (the “cookie cutter”), and a desired number of replicas. Additionally, we need to define a way of finding Pods that the ReplicaSet should control. The actual act of managing the replicated Pods is an example of a <strong>reconciliation loop</strong>. -Though ReplicaSets create and manage Pods, they do not own the Pods they create. ReplicaSets use label queries to identify the set of Pods they should be managing. </li> <li>Because ReplicaSets are decoupled from the Pods they manage, you can simply create a ReplicaSet that will “adopt” the existing Pod, and scale out additional copies of those containers. In this way you can seamlessly move from a single imperative Pod to a replicated set of Pods managed by a ReplicaSet. </li> <li>A Pod can be misbehaving but still be part of the replicated set. You can modify the set of labels on the sick Pod. Doing so will disassociate it from the ReplicaSet (and service) so that you can debug the Pod. The ReplicaSet controller will notice that a Pod is missing and create a new copy, but because the Pod is still running, it is available to developers for interactive debugging, which is significantly more valuable than debugging from logs.</li> <li>ReplicaSets are designed to represent a single, scalable microservice inside your architecture. ReplicaSets are designed for stateless (or nearly stateless) services. </li> </ul> <h3 id=finding-a-replicaset-from-a-pod>Finding a ReplicaSet from a Pod<a class=headerlink href=#finding-a-replicaset-from-a-pod title="Permanent link">&para;</a></h3> <ul> <li>Sometimes you may wonder if a Pod is being managed by a ReplicaSet, and, if it is, which ReplicaSet.</li> <li>To enable this kind of discovery, the ReplicaSet controller adds an annotation to every Pod that it creates. - The key for the annotation is <code>kubernetes.io/created-by</code>. If you run the following, look for the kubernetes.io/created-by entry in the annotations section: <div class=highlight><pre><span></span><code>kubectl get pods &lt;pod-name&gt; -o yaml
</code></pre></div></li> <li>Note that such annotations are best-effort; they are only created when the Pod is created by the ReplicaSet, and can be removed by a Kubernetes user at any time.</li> </ul> <h3 id=finding-a-set-of-pods-for-a-replicaset>Finding a Set of Pods for a ReplicaSet<a class=headerlink href=#finding-a-set-of-pods-for-a-replicaset title="Permanent link">&para;</a></h3> <ul> <li>First, you can get the set of labels using the <code>kubectl describe</code> command. </li> <li>To find the Pods that match this selector, use the <code>--selector</code> flag or the shorthand <code>-l</code>: <div class=highlight><pre><span></span><code>kubectl get pods -l <span class=nv>app</span><span class=o>=</span>kuard,version<span class=o>=</span><span class=m>2</span>
</code></pre></div></li> <li>This is exactly the same query that the ReplicaSet executes to determine the current number of Pods.</li> </ul> <h3 id=scaling-replicasets>Scaling ReplicaSets<a class=headerlink href=#scaling-replicasets title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>kubectl scale replicasets kuard --replicas<span class=o>=</span><span class=m>4</span>
</code></pre></div> <h3 id=horizontal-pod-autoscalinghpa>Horizontal Pod Autoscaling (HPA)<a class=headerlink href=#horizontal-pod-autoscalinghpa title="Permanent link">&para;</a></h3> <ul> <li>HPA requires the presence of the heapster Pod on your cluster. heapster keeps track of metrics and provides an API for consuming metrics HPA uses when making scaling decisions. <div class=highlight><pre><span></span><code><span class=c1># Creates an autoscaler that scales between two and five replicas with a CPU threshold of 80%. </span>
kubectl autoscale rs kuard --min<span class=o>=</span><span class=m>2</span> --max<span class=o>=</span><span class=m>5</span> --cpu-percent<span class=o>=</span><span class=m>80</span>
kubectl get hpa
</code></pre></div></li> </ul> <h3 id=deleting-replicasets>Deleting ReplicaSets<a class=headerlink href=#deleting-replicasets title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=c1># This also deletes the Pods that are managed by the ReplicaSet</span>
kubectl delete rs kuard
<span class=c1># If you don’t want to delete the Pods that are being managed by the ReplicaSet you can set the --cascade flag to false</span>
kubectl delete rs kuard --cascade<span class=o>=</span><span class=nb>false</span>
</code></pre></div> <h2 id=daemonsets>DaemonSets<a class=headerlink href=#daemonsets title="Permanent link">&para;</a></h2> <ul> <li>A DaemonSet ensures a copy of a Pod is running across a set of nodes in a Kubernetes cluster. </li> <li>DaemonSets are used to deploy system daemons such as log collectors and monitoring agents, which typically must run on every node. </li> <li>However, there are some cases where you want to deploy a Pod to only a subset of nodes. In cases like these node labels can be used to tag specific nodes that meet workload requirements. <div class=highlight><pre><span></span><code><span class=c1># Using a label selector we can filter nodes based on labels. </span>
kubectl get nodes --selector <span class=nv>ssd</span><span class=o>=</span><span class=nb>true</span> 
</code></pre></div></li> <li>Node selectors can be used to limit what nodes a Pod can run on in a given Kubernetes cluster. Node selectors are defined as part of the Pod spec when creating a DaemonSet. </li> <li>The inverse is also true: if a required label is removed from a node, the Pod will be removed by the DaemonSet controller.</li> <li>Deleting a DaemonSet will also delete all the Pods being managed by that DaemonSet. Set the <code>--cascade</code> flag to false to ensure only the DaemonSet is deleted and not the Pods.</li> </ul> <h2 id=jobs>Jobs<a class=headerlink href=#jobs title="Permanent link">&para;</a></h2> <ul> <li>Jobs are designed to manage batch-like workloads where work items are processed by one or more Pods. By default each Job runs a single Pod once until successful termination.</li> <li><code>--restart=OnFailure</code> is the option that tells kubectl to create a Job object.</li> <li>Because Jobs have a finite beginning and ending, it is common for users to create many of them. This makes picking unique labels more difficult and more critical. For this reason, the Job object will automatically pick a unique label and use it to identify the pods it creates. <div class=highlight><pre><span></span><code>kubectl run -i oneshot <span class=se>\</span>
  --image<span class=o>=</span>gcr.io/kuar-demo/kuard-amd64:1 <span class=se>\</span>
  --restart<span class=o>=</span>OnFailure <span class=se>\</span>
  -- --keygen-enable <span class=se>\</span>
     --keygen-exit-on-complete <span class=se>\</span>
     --keygen-num-to-gen <span class=m>10</span>
<span class=c1># The -i option to kubectl indicates that this is an interactive command. kubectl will wait until the Job is running and then show the log output from the first (and in this case only) pod in the Job.</span>
<span class=c1># All of the options after -- are command-line arguments to the container image. These instruct our test server (kuard) to generate 10 4,096-bit SSH keys and then exit.</span>
kubectl get pod -l job-name<span class=o>=</span>oneshot -a
<span class=c1># Without -a flag kubectl hides completed Jobs. </span>
kubectl delete <span class=nb>jobs</span> oneshot
</code></pre></div></li> </ul> <h2 id=configmaps>ConfigMaps<a class=headerlink href=#configmaps title="Permanent link">&para;</a></h2> <ul> <li>Configmaps can be used as a set of variables that can be used when defining the environment or command line for your containers. The key thing is that the ConfigMap is combined with the Pod right before it is run. This means that the container image and the pod definition itself can be reused across many apps by just changing the ConfigMap that is used.</li> <li>There are three main ways to use a ConfigMap:<blockquote> <p><strong>Filesystem</strong>: You can mount a ConfigMap into a Pod. A file is created for each entry based on the key name. The contents of that file are set to the value. <strong>Environment variable</strong>: A ConfigMap can be used to dynamically set the value of an environment variable. <strong>Command-line argument</strong>: Kubernetes supports dynamically creating the command line for a container based on ConfigMap values. <div class=highlight><pre><span></span><code>cat my-config.txt
<span class=nv>parameter1</span> <span class=o>=</span> value1
<span class=nv>parameter2</span> <span class=o>=</span> value2

kubectl create configmap my-config <span class=se>\</span>
  --from-file<span class=o>=</span>my-config.txt <span class=se>\</span>
  --from-literal<span class=o>=</span>extra-param<span class=o>=</span>extra-value <span class=se>\</span>
  --from-literal<span class=o>=</span>another-param<span class=o>=</span>another-value
</code></pre></div></p> </blockquote> </li> </ul> <h2 id=secrets>Secrets<a class=headerlink href=#secrets title="Permanent link">&para;</a></h2> <ul> <li>There is certain data that is extra-sensitive. This can include passwords, security tokens, or other types of private keys. Collectively, we call this type of data “secrets.” </li> <li>Secret data can be exposed to pods using the secrets volume type. Secrets volumes are managed by the kubelet and are created at pod creation time. Secrets are stored on tmpfs volumes (aka RAM disks) and, as such, are not written to disk on nodes.</li> <li>Each data element of a secret is stored in a separate file under the target mount point specified in the volume mount. <div class=highlight><pre><span></span><code><span class=c1># The TLS key and certificate for the kuard application can be downloaded by running the following commands.</span>
curl -o kuard.crt  https://storage.googleapis.com/kuar-demo/kuard.crt
curl -o kuard.key https://storage.googleapis.com/kuar-demo/kuard.key
<span class=c1># With the kuard.crt and kuard.key files stored locally, we are ready to create a secret. </span>
kubectl create secret generic kuard-tls <span class=se>\</span>
  --from-file<span class=o>=</span>kuard.crt <span class=se>\</span>
  --from-file<span class=o>=</span>kuard.key

<span class=c1># Replacing secrets from file</span>
kubectl create secret generic kuard-tls <span class=se>\</span>
  --from-file<span class=o>=</span>kuard.crt --from-file<span class=o>=</span>kuard.key <span class=se>\</span>
  --dry-run -o yaml <span class=p>|</span> kubectl replace -f -
<span class=c1># This command line first creates a new secret with the same name as our existing secret. If we just stopped there, the Kubernetes API server would return an error complaining that we are trying to create a secret that already exists. Instead, we tell kubectl not to actually send the data to the server but instead to dump the YAML that it would have sent to the API server to stdout. We then pipe that to kubectl replace and use -f - to tell it to read from stdin. In this way we can update a secret from files on disk without having to manually base64-encode data.</span>
</code></pre></div></li> <li>Extracting secrets into a file <div class=highlight><pre><span></span><code>kubectl get secret demo-secret -o json <span class=p>|</span> jq -r .data.value <span class=p>|</span> base64 --decode &gt; ./demo-secret
<span class=c1># Output the value of secret as JSON, run JQ to parse the output</span>
<span class=c1># As the secret data is base64 encoded, decode it before writing the data to the client machine</span>
</code></pre></div></li> </ul> <h2 id=deployments>Deployments<a class=headerlink href=#deployments title="Permanent link">&para;</a></h2> <ul> <li>The Deployment object exists to manage the release of new versions. -In the output of describe there is a great deal of important information. Two of the most important pieces of information in the output are <code>OldReplicaSets</code>and <code>NewReplicaSet</code>. These fields point to the ReplicaSet objects this Deployment is currently managing. If a Deployment is in the middle of a rollout, both fields will be set to a value. If a rollout is complete, OldReplicaSets will be set to <none>.</li> <li>You can use <code>kubectl rollout history</code> to obtain the history of rollouts associated with a particular Deployment. If you have a current Deployment in progress, then you can use <code>kubectl rollout status</code> to obtain the current status of a rollout.</li> <li>You can <code>undo</code> both partially completed and fully completed rollouts. An undo of a rollout is actually simply a rollout in reverse (e.g., from v2 to v1, instead of from v1 to v2), and all of the same policies that control the rollout strategy apply to the undo strategy as well. </li> <li>Specifying a revision of <code>0</code> is a shorthand way of specifying the previous revision. Or <code>kubectl rollout undo</code></li> <li>If you ever want to manage that ReplicaSet directly, you need to delete the Deployment (remember to set <code>--cascade</code> to false, or else it will delete the ReplicaSet and Pods as well!). <div class=highlight><pre><span></span><code><span class=c1># You can see the label selector</span>
kubectl get deployments nginx <span class=se>\</span>
  -o jsonpath --template <span class=o>{</span>.spec.selector.matchLabels<span class=o>}</span>     
<span class=c1># From this you can see that the Deployment is managing a ReplicaSet with the labels run=nginx. </span>
kubectl get replicasets --selector<span class=o>=</span><span class=nv>run</span><span class=o>=</span>nginx
<span class=c1># If you are in the middle of a rollout and you want to temporarily pause it for some reason (e.g., if you start seeing weird behavior in your system and you want to investigate), you can use the pause command:</span>
kubectl rollout pause deployments nginx
<span class=c1># If, after investigation, you believe the rollout can safely proceed, you can use the resume command to start up where you left off:</span>
kubectl rollout resume deployments nginx
<span class=c1># You can see the deployment history by running:</span>
kubectl rollout <span class=nb>history</span> deployment nginx
<span class=c1># If you are interested in more details about a particular revision, you can add the --revision flag to view details about that specific revision:</span>
kubectl rollout <span class=nb>history</span> deployment nginx --revision<span class=o>=</span><span class=m>2</span>
<span class=c1># You can roll back to a specific revision in the history using the --to-revision flag:</span>
kubectl rollout undo deployments nginx --to-revision<span class=o>=</span><span class=m>3</span>
</code></pre></div></li> <li><strong>NOTE:</strong> When you do a kubectl rollout undo you are updating the production state in a way that isn’t reflected in your source control. An alternate (and perhaps preferred) way to undo a rollout is to revert your YAML file and kubectl apply the previous version. In this way your “change tracked configuration” more closely tracks what is really running in your cluster.</li> </ul> <h3 id=deployment-strategies>Deployment strategies<a class=headerlink href=#deployment-strategies title="Permanent link">&para;</a></h3> <ul> <li>Deployment strategies for <code>rollingUpdate</code> using the <code>maxUnavailable</code>parameter or the <code>maxSurge</code> parameter.</li> <li>The <strong>maxUnavailable</strong> parameter sets the maximum number of Pods that can be unavailable during a rolling update. </li> <li>It can either be set to an absolute number (e.g., 3 meaning a maximum of three Pods can be unavailable) or to a percentage (e.g., 20% meaning a maximum of 20% of the desired number of replicas can be unavailable). Generally speaking, using a percentage is a good approach for most services, since the value is correctly applicable regardless of the desired number of replicas in the Deployment.</li> <li>If you have four replicas and have set maxUnavailable to 50%, it will scale it down to two replicas. The rolling update will then replace the removed pods by scaling the new ReplicaSet up to two replicas, for a total of four replicas (two old, two new). It will then scale the old ReplicaSet down to zero replicas, for a total size of two new replicas. Finally, it will scale the new ReplicaSet up to four replicas, completing the rollout. Thus, with maxUnavailableset to 50%, our rollout completes in four steps, but with only 50% of our service capacity at times.</li> <li>However, there are situations where you don’t want to fall below 100% capacity, but you are willing to temporarily use additional resources in order to perform a rollout. In these situations, you can set the <code>maxUnavailable parameter to 0%</code>, and instead control the rollout using the <code>maxSurge</code>parameter.</li> <li>The <strong>maxSurge</strong> parameter controls how many extra resources can be created to achieve a rollout. </li> <li>To illustrate how this works, imagine we have a service with 10 replicas. We set maxUnavailable to 0 and maxSurge to 20%. The first thing the rollout will do is scale the new ReplicaSet up to 2 replicas, for a total of 12 (120%) in the service. It will then scale the old ReplicaSet down to 8 replicas, for a total of 10 (8 old, 2 new) in the service. This process proceeds until the rollout is complete. At any time, the capacity of the service is guaranteed to be at least 100% and the maximum extra resources used for the rollout are limited to an additional 20% of all resources.</li> <li>Setting <code>maxSurge to 100%</code>is equivalent to a <strong>blue/green deployment</strong>. The Deployment controller first scales the new version up to 100% of the old version. Once the new version is healthy, it immediately scales the old version down to 0%.</li> <li>Setting <code>minReadySeconds to 60</code> indicates that the Deployment must wait for 60 seconds after seeing a Pod become healthy before moving on to updating the next Pod.</li> <li>To set the timeout period, the Deployment parameter <code>progressDeadlineSeconds is set to 600</code>. This sets the progress deadline to 10 minutes. If any particular stage in the rollout fails to progress in 10 minutes, then the Deployment is marked as failed, and all attempts to move the Deployment forward are halted.</li> </ul> <h2 id=ingress>Ingress<a class=headerlink href=#ingress title="Permanent link">&para;</a></h2> <ul> <li><strong>Service</strong> objects provide a great way to do simple <strong>TCP-level</strong> load balancing, they don’t provide an application-level way to do load balancing and routing.</li> <li>The truth is that most of the applications that users deploy using containers and Kubernetes are HTTP web-based applications. These are better served by a load balancer that understands HTTP. To address these needs, the Ingress API was added to Kubernetes.</li> <li><strong>Ingress</strong> represents a <strong>path and host-based</strong> HTTP load balancer and router. When you create an Ingress object, it receives a <strong>virtual IP address</strong> just like a Service, but instead of the one-to-one relationship between a Service IP address and a set of Pods, an Ingress can use the content of an HTTP request to route requests to different Services.</li> </ul> <h2 id=statefulsets>StatefulSets<a class=headerlink href=#statefulsets title="Permanent link">&para;</a></h2> <ul> <li>Some applications, especially stateful storage workloads or sharded applications, require more differentiation between the replicas in the application. To resolve this, Kubernetes has recently introduced StatefulSets as a <strong>complement</strong> to ReplicaSets, but for more stateful workloads.</li> <li>Like ReplicaSets, <strong>StatefulSets</strong> create multiple instances of the same container image running in a Kubernetes cluster, but the manner in which containers are created and destroyed is <strong>more deterministic</strong>, as are the names of each container.</li> <li>With StatefulSets, each replica receives a monotonically increasing index (e.g., backed-0, backend-1, and so on). </li> <li>StatefulSets guarantee that replica zero will be created and become healthy before replica one is created and so forth. </li> <li>StatefulSets receive DNS names so that each replica can be accessed directly. This allows clients to easily target specific shards in a sharded service.</li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2018 - 2019 Leslie </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.ca5457b8.min.js></script> </body> </html>